\documentclass[11pt]{book}
\include{documentpre}
\usepackage{showkeys}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{definition}
\newtheorem{exercise}{Exercise}[section]
\newtheorem{example}[theorem]{Example}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{remark}{Remark}[section]
\makeatother
\title{Exercises in Hartshorne}
\author{Longer}
\tikzcdset{column sep=15pt,row sep=15pt}
\special{dvipdfmx:config z 0}
\begin{document}
\maketitle
\tableofcontents
\setlength{\abovedisplayskip}{5pt}
\setlength{\belowdisplayskip}{5pt}
\chapter{Varieties}
\section{Affine varieties}
In this section, $k$ will denote an algebraically closed field. We define affine $n$-space over $k$, denoted $\mathbb{A}^n_k$ or simply $\mathbb{A}^n$, to be the set of all $n$-tuples of elements of $k$. For a subset $S\sub k[x_1,\dots,x_n]$, the zero set of $S$ is denoted by
\[V(S)=\{p\in\A^n:\text{$f(p)=0$ for all $f\in S$}\}.\]
For any subset $X\sub\A^n$, let us define the ideal of $X$ in $k[x_1,\dots,x_n]$ by
\[I(X)=\{f\in k[x_1,\dots,x_n]:\text{$f(p)=0$ for all $p\in X$}\}.\]
For an algebraic subset $X=V(\a)\sub\A^n$, the coordinate ring of $X$ is denoted by $k[X]=k[x_1,\dots,x_n]/\a$.
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $X$ be the plane curve $y=x^2$ (i.e., $X$ is the zero set of the polynomial $y-x^2$). Show that $k[X]$ is isomorphic to a polynomial ring in one variable over $k$.
\item[(b)] Let $Y$ be the plane curve $xy=1$. Show that $k[Y]$ is not isomorphic to a polynomial ring in one variable over $k$.
\item[(c)] Let $f$ be any irreducible quadratic polynomial in $k[x,y]$, and let $Z$ be the conic defined by $f$. Show that $k[Z]$ is isomorphic to $k[X]$ or $k[Y]$. Which one is it when?
\end{itemize}
\end{exercise}
\begin{proof}
The first two are easy. Now let $f$ be a quadratic polynomial in $k[x,y]$, then $f$ can be written as
\[f(x,y)=x^2+axy+by^2+cx+dy+e.\]
Since $k$ is algebraically closed, the homogeneous term $x^2+axy+by^2$ can be factorized into $(x-\xi_1y)(x-\xi_2y)$. Now we divide into two cases.\par
If $\xi_1=\xi_2$, in other words, $a^2-4b=0$, then by a change of variable, we get a new polynomial
\[f(x,y)=x^2+\tilde{c}x+\tilde{d}y+\tilde{e}=0.\]
If we set $y=\tilde{c}x+\tilde{d}y+\tilde{e}$, then we get a polynomial of the form $x^2-\alpha y=0$, so the coordinate ring of $X$ is isomorphic to $k[x]$.\par
On the other hand, if $\xi_1\neq\xi_2$ then by a change of variable we get a new polynomial
\[f(x,y)=(x+\tilde{c})(y+\tilde{d})+\tilde{e}=0.\]
It is clear that if we set $x=x+\tilde{c}$ and $y=y+\tilde{d}$ then we get a polynomial of the form $xy-\alpha=0$, so the coordinate ring of $X$ is isomorphic to $k[x,x^{-1}]$.\par
\end{proof}
\begin{exercise}
Let $X\sub\A^3$ be the set $X=\{(t,t^2,t^3):t\in k\}$. Show that $X$ is an affine variety of dimension $1$. Find generators for the ideal $I(X)$. Show that $k[X]$ is isomorphic to a polynomial ring in one variable over $k$. We say that $X$ is given by the parametric representation $x=t$, $y=t^2$, $z=t^3$.
\end{exercise}
\begin{proof}
The set $X$ is isomorphic to $\A^1$ via the map $t\mapsto(t,t^2,t^3)$, with inverse map being the first projection. So $X$ is an affine variety of dimension $1$. This also shows that $k[X]$ is isomorphic to a polynomial ring in one variable over $k$. We claim that the ideal of $X$, $I(X)$, is $(y-x^2,z-x^3)$.\par
First note that for any $f\in k[x,y,z]$, we can write 
\[f=h_1(y-x^2)+h_2(z-x^3)+r(x)\]
for $r(x)\in k[x]$. To see this, note that for an arbitrary monomial $x^\alpha y^\beta z^\gamma$ we have
\[x^\alpha y^\beta z^\gamma=x^\alpha(x^2+(y-x^2))^\beta(x^2+(z-x^3))^\gamma=h_1(y-x^2)+h_2(z-x^3)+x^{\alpha+2\beta+3\gamma}.\]
where $h_1,h_2\in k[x,y,z]$. Now, clearly $(y-x^2,z-x^3)\sub I(X)$. To show the reverse inclusion, let $f\in I(Y)$ and write $f$ into the above form. Using the parametrization $(t,t^2,t^3)$, we see
\[0=f(t,t^2,t^3)=0+0+r(t),\]
so $r(t)=0$ and $f\in(y-x^2,z-x^3)$.
\end{proof}
\begin{exercise}
Let $X$ be the algebraic set in $\A^3$ defined by the two polynomials $x^2-yz$ and $xz-x$. Show that $X$ is a union of three irreducible components. Describe them and find their prime ideals.
\end{exercise}
\begin{proof}
Let $X\sub\A^3$ be defined by $x^2-yz=0$ and $xz-x=0$. Then
\begin{align*}
X&=V(x^2-yz,xz-x)=V(x^2-yz,x)\cup V(x^2-yz,z-1)\\
&=V(yz,x)\cup V(x^2-yz,z-1)\\
&=V(y,x)\cup V(z,x)\cup V(x^2-y,z-1).
\end{align*}
Since the above sets are all irreducible, we are done.
\end{proof}
\begin{exercise}
If we identify $\A^2$ with $\A^1\times\A^1$ in the natural way, show that the Zariski topology on $\A^2$ is not the product topology ofthe Zariski topologies on the two copies of $\A^1$.
\end{exercise}
\begin{proof}
The diagonal $\Delta$ is closed in $\A^2$ because it equals to $V(y-x)$, but $\A^1$ is not Hausdorff so $\Delta$ is not closed in $\A^1\times\A^1$.
\end{proof}
\begin{exercise}
Show that a $k$-algebra $B$ is isomorphic to the affine coordinate ring of some algebraic set in $\A^n$ for some $n$, if and only if $B$ is a finitely generated $k$-algebra with no nilpotent elements.
\end{exercise}
\begin{proof}
Both conditions are equivalent to that $B$ is isomorphic to $k[x_1,\dots,x_n]/\a$, where $\a$ is a radical ideal.
\end{proof}
\begin{exercise}
Any nonempty open subset of an irreducible topological space is dense and irreducible. If $Y$ is a subset of a topological space $X$, which is irreducible in its induced topology, then the closure $\widebar{Y}$ is also irreducible.
\end{exercise}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Show that the following conditions are equivalent for a topological space $X$:
\begin{itemize}
\item[(\rmnum{1})] $X$ is noetherian;
\item[(\rmnum{2})] every nonempty family of closed subsets has a minimal
element;
\item[(\rmnum{3})] $X$ satisfies the ascending chain condition for open subsets;
\item[(\rmnum{4})] every nonempty family of open subsets has a maximal element.
\end{itemize}
\item[(b)] A noetherian topological space is quasi-compact, i.e., every open cover has a finite subcover.
\item[(c)] Any subset of a noetherian topological space is noetherian in its induced topology.
\item[(d)] A noetherian space which is also Hausdorff must be a finite set with the discrete topology.
\end{itemize}
\end{exercise}
\begin{proof}
See Bourbaki.
\end{proof}
\begin{exercise}
Let $X$ be an affine variety of dimension $r$ in $\A^n$. Let $H$ be a hypersurface in $\A^n$, and assume that $X\nsubseteq H$. Then every irreducible component of $X\cap H$ has dimension $r-1$.
\end{exercise}
\begin{proof}
Let $X=V(\p)$ where $\p$ is a prime ideal of $k[x_1,\dots,x_n]$ with coheight $r$, and $H=V(f)$ where $f\in k[x_1,\dots,x_n]$. Since $X\nsubseteq H$, we see $f\notin \p$. Since $k[x_1,\dots,x_n]/\p$ is integral and Noetherian, by Krull's principal ideal theorem, the height of $(\bar{f})$ in $k[x_1,\dots,x_n]/\p$ equals $1$, whence the claim.
\end{proof}
\begin{exercise}
Let $\a\sub k[x_1,\dots,x_n]$ be an ideal which can be generated by $r$ elements. Then every irreducible component of $V(\a)$ has dimension $\geq n-r$.
\end{exercise}
\begin{proof}
In a Noetherian ring, every minimal prime of an ideal $\a=(x_1,\dots,x_r)$ has height smaller than $r$. 
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] If $Y$ is any subset of a topological space $X$, then $\dim(Y)\leq\dim(X)$.
\item[(b)] If $X$ is a topological space which is covered by a family of open subsets $\{U_\alpha\}$, then $\dim(X)=\sup_\alpha\dim(U_\alpha)$.
\item[(c)] Give an example of a topological space $X$ and a dense open subset $U$ with $\dim(U)<\dim(X)$.
\item[(d)] If $Y$ is a closed subset of an irreducible finite-dimensional topological space $X$, and if $\dim(Y)=\dim(X)$, then $Y=X$.
\item[(e)] Give an example of a noetherian topological space of infinite dimension. 
\end{itemize}
\end{exercise}
\begin{proof}
For (c), let $X=\{0,1\}$ with open sets $\emp$, $\{0\}$, $\{0,1\}$. Then $\{0\}$ is open and its closure is all of $X$, so $\{0\}$ is dense. Clearly $\dim(\{0\})=0$, but $\{1\}\sub\{0,1\}$ is a maximal chain for $\{0,1\}$, so $\dim(\{0,1\})=1$.\par
For (e), let $U_n=\{n,n+1,\dots\}$ with $n\in\N$. Then the set $\mathcal{T}=\{\emp,U_0,U_1,\cdots\}$ is a topology of open sets on $\N$. In this space, if $C_1$ and $C_2$ are closed sets, then it is easy to see that either $C_1\sub C_2$ or $C_2\sub C_1$, that every nonempty closed set is irreducible, and that every closed set other then $\N$ is finite. So this is an example of a Noetherian infinite dimensional topological space.
\end{proof}
\begin{exercise}
Let $X\sub\A^3$ be the curve given parametrically by $x=t^3,y=t^4,z=t^5$. Show that $I(X)$ is a prime ideal of height $2$ in $k[x,y,z]$ which cannot be generated by $2$ elements. We say $X$ is not a local complete intersection.
\end{exercise}
\begin{proof}
Since $k[X]=k[t^3,t^4,t^5]$ is integral with dimension $1$, $I(X)$ is a prime ideal of height $2$ in $k[x,y,z]$. In fact, we can write
\[I(X)=\p=(xz-y^2,yz-x^3,z^2-x^2y).\]
Suppose that $\p$ can be generated by two elements, i.e., $\p=(f_1,f_2)$. If $\m:=(x,y,z)$ is the homogeneous maximal ideal, then $\bar{f}_1$, $\bar{f}_2$ generate $\p/\m\p$ as a $k[x,y,z]/\m\cong k$-module, so $\dim_k(\p/\m\p)\leq 2$.\par
However, $\bar{x}\bar{z}-\bar{y}^2$, $\bar{y}\bar{z}-\bar{x}^3$, and $\bar{z}^2-\bar{x}^2\bar{y}$ are $k$-linearly independent in $\p/\m\p$: if
\[a(xz-y^2)+b(yz-x^3)+c(z^2-x^2y)\in\m\p\]
with $a,b,c\in k$, then $a=b=c=0$, since no element of $\m\p$ has a nonzero $y^2$ (resp. $yz$, $z^2$) term.
\end{proof}
\begin{exercise}
Give an example of an irreducible polynomial $f\in\R[x,y]$, whose zero set $V(f)$ in $\A_\R^2$ is not irreducible.
\end{exercise}
\begin{proof}
Let $f(x,y)=(x^2-1)^2+y^2=x^4-2x^2+y^2+1$. Since $\R[x,y]\sub\C[x,y]$ and both are UFDs, and since $f(x,y)$ factors into irreducible degree $2$ polynomials $(x^2-1+iy)(x^2-1-iy)$ in $\C[x,y]$, $f(x,y)$ is irreducible over $\R[x,y]$. But $V(f)=\{(1,0),(-1,0)\}=V(x-1,y)\cup V(x+1,y)$, which is reducible.
\end{proof}
\section{Projective varieties}
In this part let $k$ be an algebraically closed field.
\begin{exercise}
Prove the "homogeneous Nullstellensatz," which says if $\a\sub S$ is a homogeneous ideal, and if $f\in k[x_0,\dots,x_n]$ is a homogeneous polynomial with $\deg(f)>0$, such that $f(P)=0$ for all $P\in V(\a)$ in $\P^n$, then $f^q\in\a$ for some $q>0$.
\end{exercise}
\begin{proof}
By definition, $[a_0:\dots:a_n]\in\P^n$ is a zero of $f$ if and only if $(a_0,\dots,a_n)\in\A^{n+1}$ is a zero of $f$ considered as a map from $\A^{n+1}$ to $k$. By the affine Nullstellensatz, $f\in\sqrt{\a}$.
\end{proof}
\begin{exercise}
For a homogeneous ideal $\a\sub S=k[x_0,\dots,x_n]$, show that the following conditions are equivalent:
\begin{itemize}
\item[(\rmnum{1})] $V(\a)=\emp$;
\item[(\rmnum{2})] $\sqrt{\a}$ contains the ideal $S_+=\bigoplus_{d>0}S_d$.
\item[(\rmnum{3})] $\a$ contains $S_d$ for some $d>0$.
\end{itemize}
\end{exercise}
\begin{proof}
It is easy to see the equivalence of (\rmnum{2}) and (\rmnum{3}) and (\rmnum{2})$\Rightarrow$(\rmnum{1}). Now assume (\rmnum{3}), then $x_i^d\in\a$ for all $i=0,\dots,n$ and some $d>0$, so $V(\a)=\emp$. 
\end{proof}
\begin{exercise}
Let $S=k[x_0,\dots,x_n]$.
\begin{itemize}
\item[(a)] If $T_1\sub T_2$ are subsets of $S^h$, then $V(T_2)\sub V(T_1)$.
\item[(b)] If $Y_1\sub Y_2$ are subsets of $\P^n$, then $I(Y_2)\sub I(Y_1)$.
\item[(c)] For any two subsets $Y_1,Y_2$ of $\P^n$, $I(Y_1\cup Y_2)=I(Y_1)\cap I(Y_2)$.
\item[(d)] If $\a\sub S$ is a homogeneous ideal with $V(\a)\neq\emp$, then $I(Z(\a))=\sqrt{\a}$.
\item[(e)] For any subset $Y\sub\P^n$, $V(I(Y))=\widebar{Y}$.
\end{itemize}
\end{exercise}
\begin{exercise}
Let $S=k[x_0,\dots,x_n]$.
\begin{itemize}
\item[(a)] There is a 1-1 inclusion-reversing correspondence between algebraic sets in $\P^n$ and homogeneous radical ideals of $S$ not equal to $S_+$, given by $Y\mapsto I(Y)$ and $\a\mapsto V(\a)$.
\item[(b)] An algebraic set $Y\sub\P^n$ is irreducible if and only if $I(Y)$ is a prime ideal. 
\item[(c)] Show that $\P^n$ itself is irreducible. 
\end{itemize}
\end{exercise}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] $\P^n$ is a noetherian topological space.
\item[(b)] Every algebraic set in $\P^n$ can be written uniquely as a finite union of irreducible algebraic sets, no one containing another. These are called its irreducible components.
\end{itemize}
\end{exercise}
\begin{exercise}
If $Y$ is a projective variety with homogeneous coordinate ring $k[Y]$, show that $\dim(S(Y))=\dim(Y)+1$.
\end{exercise}
\begin{proof}
Let $Y_i=Y\cap U_i$. Since $\dim(Y)=\sup_i\dim(Y_i)$, we can choose $i$ such that $\dim(Y_i)=\dim(Y)$. We can write any element $g/x_i^d\in S(Y)_{x_i}$ of degree $0$ as the polynomial $f(x_0/x_i,\dots,x_n/x_i)$, which is exactly the element $\alpha(f)\in A(Y_i)$, and $x_0/x_i,\dots,x_n/x_i$ are the coordinates on $\A^n$. Given a polynomial $f\in A(Y_i)$, we homogenize it to $g=\beta(f)$. If $\deg(g)=d$, we associate the degree zero element $g/x_i^d\in S(Y)_{x_i}$. The two processes are reversible, giving an isomorphism of $A(Y_i)$ with the subring of $S(Y)_{x_i}$ of elements of degree $0$. Clearly $S(Y)_{x_i}=A(Y_i)[x_i,x_i^{-1}]$. The transcendence degree of $A(Y_i)[x_i,x_i^{-1}]$ is one higher than that of $A(Y_i)$ so $\dim(S(Y)_{x_i})=\dim(Y_i)+1$. Since $\dim(Y_i)=\dim(Y)$, it follows that $\dim(S(Y)_{x_i})=\dim(S(Y))$. Thus $\dim(S(Y))=\dim(Y_i)+1=\dim(Y)+1$.
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] $\dim(\P^n)=n$.
\item[(b)] If $Y\sub\P^n$ is a quasi-projective variety, then $\dim(Y)=\dim(\widebar{Y})$.
\end{itemize}
\end{exercise}
\begin{exercise}
A projective variety $Y\sub\P^n$ has dimension $n-1$ if and only if it is the zero set of a single irreducible homogeneous polynomial $f$ of positive degree. $Y$ is called a hypersurface in $\P^n$.
\end{exercise}
\begin{proof}
Let $Y\sub\P^n$ have dimension $n-1$. Then $\dim(S(Y))=\dim(Y)+1=n$. In the affine cone, this corresponds to an $n$-dimensional variety in $\A^{n+1}$. Since $k[x_0,\dots,x_n]$ is a UFD, $I(Y)$ is principal, generated by an irreducible polynomial $f$. So $Y=V(f)$ in the affine cone and thus $Y=V(f^h)$ for the form homogenized form $f^h$ corresponding to $f$. Conversely, let $f\in k[x_0,\dots,x_n]$ be a non-constant irreducible homogeneous polynomial defining an irreducible variety $V(f)$. Its ideal $(f)$ has height $1$ by the Hauptidealsatz, so viewing this variety in the affine cone $\A^{n+1}$, $V(f)$ has dimension $n-1$.
\end{proof}
\begin{exercise}[\textbf{Projective Closure of an Affine Variety}]
If $Y\sub\A^n$ is an affine variety, we identify $\A^n$ with an open set $U_0\sub\P^n$ by the homeomorphism $\varphi_0$. Then we can speak of $\widebar{Y}$, the closure of $Y$ in $\P^n$, which is called the \textbf{projective closure} of $Y$.
\begin{itemize}
\item[(a)] Show that $I(\widebar{Y})$ is the ideal generated by $\beta(I(Y))$.
\item[(b)] Let $Y\sub\A^3$ be the twisted cubic. Its projective closure $\widebar{Y}\sub\P^3$ is called the twisted cubic curve in $\P^3$. Find generators for $I(Y)$ and $I(\widebar{Y})$, and use this example to show that if $f_1,\dots,f_r$ generate $I(Y)$, then $\beta(f_1),\dots,\beta(f_r)$ do not necessarily generate $I(\widebar{Y})$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $g(x_0,\dots,x_n)\in I(\widebar{Y})\sub k[x_0,\dots,x_n]$ be a homogeneous polynomial. Then $\alpha(g)=g(1,x_1,\dots,x_n)$ vanishes on $Y\sub\A^n$, the affine piece of $\P^n$ defined by $x_0\neq 0$, so $\alpha(g)\in I(Y)$ and therefore $g\in\beta(I(Y))$. This shows $I(\widebar{Y})\sub\beta(I(Y))$, whence $Y\sub Z(\beta(I(Y)))\sub\widebar{Y}$. Since $Y$ is dense in $\widebar{Y}$ and $Z(\beta(I(Y)))$ is closed, it follows that $Z(\beta(I(Y)))=\widebar{Y}$, whence $I(\widebar{Y})=\beta(I(Y))$.\par
If $Y$ is the twisted cubic given by $\{(t,t^2,t^3)\}$, then
\[I(Y)=(y-x^2,z-x^3)\And\widebar{Y}=\{[x:y:z:w]=[s^3:s^2t:st^2:w=t^3]\}.\]
We also note that $\beta(y-x^2)=yw-x^2$ and $\beta(z-x^3)=zw^2-x^3$. If $I(\widebar{Y})=V(yw-x^2,zw^2-x^3)$, then the point $[0:0:1:1]$ would be in $\widebar{Y}$, which is a contradiction. In fact,
\[I(\widebar{Y})=(yw-x^2,zw^2-x^3,xy-zw).\]
Also, note that $xy-zw=\beta(xy-z)$, where $xy-z=x(y-x^2)-z-x^3\in I(Y)$.
\end{proof}
\begin{exercise}[\textbf{The Cone Over a Projective Variety}]
Let $Y\sub\P^n$ be a nonempty algebraic set, and let $\theta:\A^{n+1}\setminus\{0\}\to\P^n$ be the map which sends the point with affine coordinates $(a_0,\dots,a_n)$ to the point with homogeneous coordinates $[a_0:\dots:a_n]$. We define the affine cone over $Y$ to be
\[C(Y)=\theta^{-1}(Y)\cup\{0\}.\]
\begin{itemize}
\item[(a)] Show that $C(Y)$ is an algebraic set in $\A^{n+1}$, whose ideal is equal to $I(Y)$, considered as an ordinary ideal in $k[x_0,\dots,x_n]$.
\item[(b)] $C(Y)$ is irreducible if and only if $Y$ is.
\item[(c)] $\dim(C(Y))=\dim(Y)+1$.
\end{itemize}
\end{exercise}
\begin{proof}
A polynomial $f(x_0,\dots,x_n)$ vanishes over $C(Y)$ if and only if $f$ has no constand term and vanishes over $Y\sub\P^n$, so (a) follows. This also proves (b). As for (c), there is a descending chain of irreducible proper varieties corresponding to an increasing chain of prime ideals in the polynomial ring. In $C(Y)$ the origin is added to the variety, which corresponds to the prime ideal $(x_0,\dots,x_n)$ which is now added to the end of the chain of primes. So $\dim(Y)+1=\dim(C(Y))$.
\end{proof}
\begin{exercise}[\textbf{Linear Varieties in $\P^n$}]
A hypersurface defined by a linear polynomial is called a \textbf{hyperplane}.
\begin{itemize}
\item[(a)] Show that the following two conditions are equivalent for a variety $Y$ in $\P^n$:
\begin{itemize}
\item[(\rmnum{1})] $I(Y)$ can be generated by linear polynomials.
\item[(\rmnum{2})] $Y$ can be written as an intersection of hyperplanes.
In this case we say that $Y$ is a linear variety in $\P^n$. 
\end{itemize} 
\item[(b)] If $Y$ is a linear variety of dimension $r$ in $\P^n$, show that $I(Y)$ is minimally generated by $n-r$ linear polynomials.
\item[(c)] Let $Y,Z$ be linear varieties in $\P^n$, with $\dim(Y)=r$, $\dim(Z)=s$. If $r+s-n\geq 0$, then $Y\cap Z\neq\emp$. Furthermore, if $Y\cap Z\neq\emp$, then $Y\cap Z$ is a linear variety of dimension $\geq r+s-n$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $I(Y)=(f_1,\dots,f_r)$ where each $f_i$ is a linear polynomial. Let $H_i=V(f_i)$. Then the $H_i$ are hyperplanes and $Y=\bigcap_iH_i$. Conversely, let $Y=\bigcap_iH_i$ where $H_i=V(f_i)$ are hyperplanes. Then $I(Y)=(f_1,\dots,f_r)$.\par
If $Y$ is a linear variety, then $Y$ is the intersection of hyperplanes. But by Krull's principal ideal theorem, the intersection of $\P^n$ with a hyperplane will at most drop the dimension of $Y$ by $1$. So if $Y$ has dimension $r$, then $Y$ is the intersection of at least $n-r$ hyperplanes, so $I(Y)$ is minimally generated by $n-r$ linear polynomials. Finally, (c) is the projective dimension theorem.
\end{proof}
\begin{exercise}[\textbf{The $d$-Uple Embedding}]\label{d-uple embedding}
For given $n,d>0$, let $\{m_\alpha\}$ be the set of all the monomials of degree $d$ in the $n+1$ variables $x_0,\dots,x_n$ indexed by the set of multi-indices $\alpha=(i_0,\dots,i_n)$, where $i_j\geq 0$ and $|\alpha|=d$. Let $N=\binom{n+d}{d}-1$, we define a mapping $\rho_d:\P^n\to\P^N$ by
\[\rho_d:\P^n\to\P^N,\quad p=[a_0:\cdots:a_n]\mapsto[\dots:m_\alpha(a):\cdots]\]
sending the point $p$ to the point obtained by substituting the $a_i$ in the monomials $m_\alpha$. This is called the \textbf{$d$-uple embedding} of $\P^n$ in $\P^N$.
\begin{itemize}
\item[(a)] Let $\tau_d:k[\{y_\alpha\}]\to k[x_0,\dots,x_n]$ be the homomorphism defined by sending $y_\alpha$ to $m_\alpha$, and let $\a$ be the kernel of $\tau_d$. Then $\a$ is a homogeneous prime ideal, and $V(\a)$ is a projective variety in $\P^N$. Show that the image of $\rho_d$ is exactly $V(\a)$. 
\item[(b)] Show that the image of $\rho_d$ is given by
\[V_{n,d}=V(y_\alpha y_\beta-y_\gamma y_\eta:\alpha+\beta=\gamma+\eta).\]
Moreover, the above set is a minimal set of polynomials to generate $V_{n,d}$.
\item[(c)] Show that the twisted cubic curve in $\P^3$ is equal to the $3$-uple embedding of $\P^1$ in $\P^3$, for suitable choice of coordinates.
\end{itemize}
\end{exercise}
\begin{proof}
The ideal $\a$ is clearly homogeneous since the image of each $y_i$ is sent to an element of the same degree. Since the quotient ring $k[\{y_\alpha\}]/\a$ is isomorphic to a subring of $k[x_0,\dots,x_n]$, which is an integral domain, $\a$ is prime, and $V(\a)$ a projective variety.\par
The polynomial $y_\alpha$ is send to $m_\alpha$ by $\tau_d$, so $\rho_d$ is induced by $\tau_d$ via the equivalence of the corresponding categories. Moreover, it is easy to see the image of $\tau_d$ is an integral domain, so $\a$ is a homogeneous prime ideal. Let $f\in\a$, then $f(\dots,m_\alpha,\dots)=0$ by definition of $\tau_d$ and hence $f$ vanishes over the image of $\rho_d$. Conversely, if $f$ vanishes over $\im\rho_d)$, then $f(x)=0$ for every $x\in\im\rho_d$, whence $f(\dots,m_\alpha,\dots)=0$ by the definition of $\rho_d$, whence $f\in\a$ and the claims of (a) follow.\par
It is clear that $y_\alpha y_\beta-y_\gamma y_\eta$ is mapped to zero if $\alpha+\beta=\gamma+\eta$, so $(y_\alpha y_\beta-y_\gamma y_\eta)\sub\a$. To show the converse, let $p=[\dots:a_\alpha:\cdots]\in V_{n,d}$. For each $k=0,\dots,n$, let $\eta_k=(0,\dots,d,\dots,0)$, where $d$ is in the $k$-th position. Then for any multi-index $\alpha=(i_0,\dots,i_n)$, we have by induction that
\[a_\alpha^d=a_{\eta_0}^{i_0}\cdots a_{\eta_n}^{i_n}.\] 
Therefore, there exist an index $k$ such that $a_{L_k}\neq 0$, which we may assume to be $0$. With this, let $\beta=(j_0,\dots,j_n)=(d-1,0,\dots,0)$, and set $\beta_i:=(j_0,\dots,j_i+1,\dots,j_n)$. Consider the element $q=[a_{\beta_0}:\cdots:a_{\beta_n}]$. Then for any index $\alpha=(i_0,\dots,i_n)$ and $k\neq 0$, we have
\begin{align*}
a_\alpha a_\beta=a_{(i_0+1,i_1,\dots,i_k-1,\dots,i_n)}a_{(d-1,0,\dots,1,\dots,0)}=a_{(i_0+1,i_1,\dots,i_k-1,\dots,i_n)}a_{J_k},
\end{align*}
whence by induction that
\[a_\alpha a_\beta^d=a_{\beta_0}^{i_0}a_{\beta_1}^{i_1}\cdots a_{\beta_n}^{i_n}=m_\alpha(q).\]
Since $a_\beta\neq 0$, this shows $\rho_d(q)=p$, whence $\im\rho_d=V_{n,d}$. To show that $\{y_\alpha y_\beta-y_\gamma y_\eta:\alpha+\beta=\gamma+\eta\}$ is minimal to generate $\a$, it suffices to note that these polynomials are homogeneous of degree $2$ and linearly independent.\par
Finally, the $3$-uple embedding of $\P^1$ into $\P^3$ maps $[x_0,x_1]$ to $[x_0^3:x_0^2x_1:x_0x_1^2:x_1^3]$, which is the projective closure of the twisted cubic curve. The generating ideal $\a$ is given by
\begin{align*}
\a&=(y_{(3,0)}y_{(1,2)}-y_{(2,1)}^2,y_{(3,0)}y_{(0,3)}-y_{(2,1)}y_{(1,2)},y_{(2,1)}y_{(0,3)}-y_{(1,2)}^2)\\
&=(xz-y^2,xw-yz,yw-z^2)
\end{align*}
where we label $k[\{y_\alpha\}]$ by $k[x,y,z,w]=k[y_{(3,0)},y_{(2,1)},y_{(1,2)},y_{(0,3)}]$.
\end{proof}
\begin{exercise}
Let $Y$ be the image of the $2$-uple embedding of $\P^2$ in $\P^5$. This is the \textbf{Veronese surface}. If $Z\sub Y$ is a closed curve (a curve is a variety of dimension $1$), show that there exists a hypersurface $V\sub\P^5$ such that $V\cap Y=Z$.
\end{exercise}
\begin{exercise}[\textbf{The Segre Embedding}]\label{Segre embedding}
Let $\sigma_{r,s}:\P^r\times\P^s\to\P^N$ be the map defined by
\[([a_0:\dots:a_r],[b_0:\dots:b_s])\mapsto[\dots:a_ib_j:\cdots]\]
where $N=rs+r+s$. Note that $\psi$ is well-defined and injective. It is called the \textbf{Segre embedding}. Show that the image of $\sigma_{r,s}$ is a subvariety of $\P^N$, defined by
\[\Sigma_{r,s}=V(z_{ij}z_{kl}-z_{il}z_{jk}\text{ for all $i,j,k,l$}).\]
\end{exercise}
\begin{proof}
The embedding $\psi$ corresponds to the ring map
\[\tau_{r,s}:k[\{z_{ij}\}]\to k[x_0,\dots,x_r,y_0,\dots,y_s],\quad z_{ij}\mapsto x_iy_j.\]
First, it is clear that the image of $\sigma_{r,s}$ is contained in the variety $\Sigma_{r,s}$. Conversely, let $p=[\dots:c_{ij}:\cdots]\in\Sigma_{r,s}$. Choose $i,j$ such that $c_{ij}\neq 0$, and consider the point
\[q=([c_{0j}:\dots:c_{rj}],[c_{i0}:\dots:c_{is}])\in\P^r\times\P^s.\]
We see $q$ is well-defined and for any $k,l$ we have
\[c_{kj}c_{il}=c_{ij}c_{kl}\]
whence $\sigma_{r,s}(q)=p$. This shows $\im\sigma_{r,s}=\Sigma_{r,s}$, and in particular $\sigma_{r,s}$ is an embedding of $\P^r\times\P^s$ into $\P^N$.
\end{proof}
\begin{exercise}[\textbf{The Quadric Surface in $\P^3$}]
Consider the surface $Q$ (a swface is a variety of dimension $2$) in $\P^3$ defined by the equation $xw-yz=0$.
\begin{itemize}
\item[(a)] Show that $Q$ is equal to the Segre embedding of $\P^1\times\P^1$ in $\P^3$, for suitable choice of coordinates.
\item[(b)] Show that $Q$ contains two families of lines (a line is a linear variety of dimension $1$) $\{L_\alpha\}$ and $\{M_\alpha\}$, each parametrized by $\alpha\in\P^1$, with the properties that if $L_\alpha\neq L_\beta$, then $L_\alpha\cap L_\beta=\emp$; if $M_\alpha\neq M_\beta$, then $M_\alpha\cap M_\beta=\emp$, and for all $\alpha,\beta$, $L_\alpha\cap M_\beta$ consits of one point.
\item[(c)] Show that $Q$ contains other curves besides these lines, and deduce that the Zariski topology on $Q$ is not homeomorphic via $\tau_{1,1}$ to the product topology on $\P^1\times\P^1$ (where each $\P^1$ has its Zariski topology).
\end{itemize}
\end{exercise}
\begin{proof}
It is easy to see $\Sigma_{1,1}=V(xw-yz)$ where $\P^3=[x:y:z:w]$, so (a) follows. For (b), let $L_\alpha$ be the image of $\{\alpha\}\times\P^1$ under $\sigma_{1,1}$ and $M_\alpha$ be that of $\P^1\times\{\alpha\}$. Then since $\sigma_{1,1}$ is an embedding, we see the properties in (b) are satisfied. For (c), the diagonal curves $x=y$ of $Q$ is not one of these families of lines. This closed curve is a closed subset of $Q$, but not closed in $\P^1\times\P^1$.
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] The intersection of two varieties need not be a variety. For example, let $Q_1$ and $Q_2$ be the quadric surfaces in $\P^3$ given by the equations $x^2-yw=0$ and $xy-zw=0$, respectively. Show that $Q_1\cap Q_2$ is the union of a twisted cubic curve and a line.
\item[(b)] Even if the intersection of two varieties is a variety, the ideal of the intersection may not be the sum of the ideals. For example, let $C$ be the conic in $\P^2$ given by the equation $x^2-yz=0$. Let $L$ be the line given by $y=0$. Show that $C\cap L$ consists of one point $P$, but that $I(C)+I(L)\neq I(P)$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $Q_1\sub\P^3$ be defined by $x^2-yw=0$ and $Q_2\sub\P^3$ defined by $xy-zw=0$. Then in the affine piece $w=1$, $x^2-y=0$ and $xy=z$, therefore $y=x^2$ and $z=x^3$. Thus $[x:y:z:w]=[x:x^2:x^3:1]$, which is the twisted cubic. When $w=0$, we have $x=0$ and $y,z$ are free, which is the line defined by $x=w=0$.\par
Let $C$ be the conic in $\P^2$ defined by $x^2-yz=0$ and $L$ be defined by $y=0$. Then $C\cap L$ is the point $[0:0:1]$. We have $I(P)=(x,y)$ and $I(C)+I(L)=(x^2-yz)+(y)$. Note that $x\notin I(C)+I(L)$.
\end{proof}
\begin{exercise}[\textbf{Complete intersections}]
A variety $Y$ of dimension $r$ in $\P^n$ is a \textbf{strict complete intersection} if $I(Y)$ can be generated by $n-r$ elements, and $Y$ is a \textbf{set-theoretic complete intersection} if $Y$ can be written as the intersection of $n-r$ hypersurfaces.
\begin{itemize}
\item[(a)] Let $Y$ be a variety in $\P^n$, let $Y=V(\a)$; and suppose that $\a$ can be generated by $r$ elements. Then show that $\dim(Y)\geq n-r$.
\item[(b)] Show that a strict complete intersection is a set-theoretic complete intersection.
\item[(c)] The converse of (b) is false. For example let $Y$ be the twisted cubic curve in $\P^3$. Show that $I(Y)$ cannot be generated by two elements. On the other hand, find hypersurfaces $H_1,H_2$ of degrees $2,3$ respectively, such that $Y=H_1\cap H_2$. 
\end{itemize}
\end{exercise}
\begin{proof}
If $Y\sub\P^n$ is a strict complete intersection, then $I(Y)=(f_1,\dots,f_{n-r})$. Each $f_i$ defines a hypersurface $V(f_i)$ and $Y=\bigcap_iV(f_i)$, so $Y$ is a set-theoretic complete intersection.\par
Let $Y$ be the twisted cubic given by $\{[s^3:s^2t:st^2:t^3]\}$, which is the image of $3$-uple embedding of $\P^1$ to $\P^3$. We have shown in Exercise~\ref{d-uple embedding} that $I(Y)=V(xz-y^2,xw-yz,yw-z^2)$ and this is a minimal generating set, so $Y$ is not a complete intersection. On the other hand, $Y$ is the intersection of $H_1=V(xz-y^2)$ and $H_2=V(z^3+xw^2-2yzw)$, as
\begin{align*}
(xw-yz)^2&=x^2w^2-2xyzw+y^2z^2=x(z^3+xw^2-2yzw)+z^2(y^2-xz)\\
(yw-z^2)^2&=y^2w^2-2ywz^2+z^4=z(z^3+xw^2-2yzw)+w^2(y^2-xz).
\end{align*}
Therefore $Y=H_1\cap H_2$.
\end{proof}
\section{Morphisms}
\begin{exercise}\label{variety morphism preimage of V prop}
Let $\varphi:X\to Y$ be a morphism of varieties and $\varphi^*:k[Y]\to k[X]$ be the associated ring homomorphism. Let $\a\sub k[X]$ and $\b\sub k[Y]$ be ideals. Show that
\[\varphi^{-1}(V(\b))=V(\b^e),\quad \widebar{\varphi(V(\a))}=V(\a^c).\]
In particular, $\varphi$ is continuous.
\end{exercise}
\begin{proof}
First, note that $x\in\varphi^{-1}(V(\b))$ if and only if $g(\varphi(x))=0$ for all $g\in\b$, which is equivalent to $\varphi^*(g)(x)=0$ for all $g\in\b$, so $\varphi^{-1}(V(\b))=V(\varphi^*(\b))=V(\b^e)$. Now the second claim is equivalent to $V(I(\varphi(V(\a))))=V(\a^c)$. On the other hand,
\begin{align*}
I(\varphi(V(\a)))&=\{g\in k[Y]:\text{$g(\varphi(x))=0$ for all $x\in V(\a)$}\}\\
&=\{g\in k[Y]:\text{$\varphi^*(g)(x)=0$ for all $x\in V(\a)$}\}\\
&=\{g\in k[Y]:\text{$\varphi^*(g)\in I(V(\a))$}\}=(\varphi^*)^{-1}(\sqrt{\a})=\sqrt{(\varphi^*)^{-1}(\a)},
\end{align*}
so applying $V$ we get the desired result.
\end{proof}
\begin{exercise}\label{conic in A^2 and P^2 prop}
\mbox{}
\begin{itemize}
\item[(a)] Show that any conic in $\A^2$ is isomorphic either to $\A^1$ or $\A^1\setminus\{0\}$.
\item[(b)] Show that $\A^1$ is not isomorphic to any proper open subset of itself.
\item[(c)] Any conic in $\P^2$ is isomorphic to $\P^1$.
\item[(d)] We will see later that any two curves are homeomorphic. But show now that $\A^2$ is not even homeomorphic to $\P^2$.
\item[(e)] If an affine variety is isomorphic to a projective variety, then it consists of only one point.    
\end{itemize}
\end{exercise}
\begin{proof}
Since for any conic $Z$ in $\A^2$, either $k[Z]=k[x]$ or $k[Z]=k[x,x^{-1}]$, the first claim follows. Any proper open subset of $\A^1$ is of the form $X=\A^1\setminus\{p_1,\dots,p_n\}$. The coordinate ring of $X$ is $k[X]=k[x,(x-p_1)^{-1},\dots,(x-p_n)^{-1}]$. This coordinate ring is not is not isomorphic to $k[x]$ since any isomorphism $\varphi:k[X]\to k[x]$ must take $x-p_i$ into $k$, since $x-p_i$ is a unit, and hence takes $x$ into $k$, which shows $\varphi$ is not surjective, contradiction.\par
Assume that $\char(k)\neq 2$. For any conic $X$ in $\P^2$, we can write $X=V(f)$ where
\[f(x,y,z)=\bm{x}^TA\bm{x}\]
where $\bm{x}=(x,y,z)^T$ and $A$ is symmetric. Since any symmetric matrix is diagonalizable, we can assume that $f(x,y,z)=x^2+y^2+z^2$ (since $f$ is irreducible, we see $A$ has full rank.). In particular, any two smooth projective plane conics are isomorphic, so to study conics, we can just pick one. Picking $f(x,y,z)=xz-y^2$, which is the image of $\P^1$ under the $2$-uple embedding $\rho_2:\P^1\to\P^2$ and thus isomorphic to $\P^1$.\par
In $\P^2$, any two lines intersect. So any homeomorphism from $\A^2$ to $\P^2$ would not have an inverse function defined at the point of intersection of the image two parallel lines in $\A^1$.\par
Let $X$ be an irreducible affine variety, $Y$ be a projective variety, and let $X\cong Y$. Then their rings of regular functions are isomorphic, and since $Y$ is projective, $\mathcal{O}_Y=k$, so $\mathcal{O}_X=k$ and then $X$ must be a point.
\end{proof}
\begin{exercise}
A morphism whose underlying map on the topological spaces is a homeomorphism need not be an isomorphism.
\begin{itemize}
\item[(a)] For example, let $\varphi:\P^1\to\P^2$ be defined by $t\mapsto(t^2,t^3)$. Show that $\varphi$ defines a bijective bicontinuous morphism of $\A^1$ onto the curve $y^2=x^3$, but that $\varphi$ is not an isomorphism.
\item[(b)] For another example, let the characteristic of the base field $k$ be $p>0$, and define a map $\varphi:\A^1\to\A^1$ by $t\mapsto t^p$. Show that $\varphi$ is bijective and bicontinuous but not an isomorphism. This is called the Frobenius morphism.
\end{itemize}
\end{exercise}
\begin{proof}
The map $\varphi:\P^1\to\P^2$ defined by $t\mapsto(t^2,t^3)$ is a parametrization of the curve $C$ defined by $y^2-x^3=0$. It is clearly bijective, and is continuous since it is defined by polynomials. It is closed since closed subsets of $\P^1$ are finite subsets, whose image under $\varphi$ is closed. However, the inverse function would have to be $(x,y)\mapsto y/x$, which is not defined at $0$.\par
Let $\char(k)=p$ and define $\varphi$ to be the Frobenius morphism. Since $k$ is algebraically closed, we see $\varphi$ is bijective. It is clear that $\varphi$ is continuous since it is given by a polynomial. The map is closed by the same arguments since we are dealing with curves in this case. But $\varphi$ is not an isomorphism however since the corresponding map on coordinate rings is not surjective.
\end{proof}
\begin{exercise}\label{morphism induced on local ring prop}
\mbox{}
\begin{itemize}
\item[(a)] Let $\varphi:X\to Y$ be a morphism. Then for each $p\in X$, $\varphi$ induces a homomorphism of local rings $\varphi_p^*:\mathcal{O}_{Y,\varphi(p)}\to\mathcal{O}_{X,p}$.
\item[(b)] Show that a morphism $\varphi$ is an isomorphism if and only if $\varphi$ is a homeomorphism, and the induced map $\varphi^*_p$ on local rings is an isomorphism, for all $p\in X$.
\item[(c)] Show that if $\varphi(X)$ is dense in $Y$, then the map $\varphi_p^*$ is injective for all $p\in X$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $\varphi:X\to Y$ be a morphism, then for any regular function $g$ defined on $V\sub Y$, the function $g\circ\varphi:\varphi^{-1}(V)\to k$ is regular. This defines a map $\varphi^*_p$ on local rings, which is easily seen to be a homomorphism. More precisely, $\varphi^*_p$ is given by $(V,g)\mapsto(\varphi^{-1}(V),g\circ\varphi)$.\par
Now assume that $\varphi$ is a homeomorphism and $\varphi_p^*$ is an isomorphism for all $p\in X$. Let $\psi:Y\to X$ be the inverse map of $\varphi$, it suffices to show $\psi$ is a morphism. Now since $\psi$ inverts $\varphi$, for any regular function $g:V\to k$ over $Y$, we have
\[g\circ\varphi\circ\psi=g\]
whence $\varphi_p^*=(\psi_p^*)^{-1}$. Therefore, for any regular function $f:U\to k$ on $X$, choose $p\in U$, we then have
\[(\psi^{-1}(U),f\circ\psi)=\psi_p^*(U,f)\quad\text{in}\quad \mathcal{O}_{Y,\psi^{-1}(p)}.\]
In particular, we see $f\circ\psi$ coincides with a regular function near $\psi^{-1}(p)$, so it is regular at $\psi^{-1}(p)$. Since $p$ is arbitrary, we conclude that $f\circ\psi$ is regular, so $\psi$ is a morphism and thus an isomorphism.\par
Finally, assume that $\varphi(X)$ is dense. Let $p\in X$ and $g:V\to k$ be a regular function on $Y$ such that $\varphi(p)\in V$. If $\varphi_p^*(g)=0$, then $g\circ\varphi$ vanishes on a neighborhood $U$ of $p$, so $g$ vanishes on $\varphi(U)$. Since $\varphi$ is continuous and $U$ is dense in $X$, we then have
\[\varphi(X)=\varphi(\widebar{U})\sub\widebar{\varphi(U)}\sub V(g).\]
If $g\neq 0$, then $\varphi(X)\sub V(g)\cap Y\nsubseteq Y$, contradicting to $\varphi(X)$ being dense in $Y$.
\end{proof}
\begin{exercise}
Show that the $d$-uple embedding of $\P^n$ is an isomorphism onto its image.
\end{exercise}
\begin{proof}
We have constructed the inverse map in Exercise~\ref{d-uple embedding}, which is clearly a morphism.
\end{proof}
\begin{exercise}
By abuse of language, we will say that a variety "is affine" if it is isomorphic to an affine variety. If $H\sub\P^n$ is any hypersurface, show that $\P^n\setminus H$ is affine.
\end{exercise}
\begin{proof}
Consider the $d$-uple embedding $\rho_d:\P^n\to\P^N$, which corresponding to the map $\tau_d:k[\{y_\alpha\}]\to k[x_0,\dots,x_n]$. If $H=V(f)$ where $f$ is a homogeneous polynomial of degree $d$, then by Exercise~\ref{variety morphism preimage of V prop} we have $\rho_d(H)=V(\tau_d^{-1}(f))$ since $\rho_d$ is an isomorphism. But $\tau_d^{-1}(f)$ is a linear polynomial, so $\rho_d(H)$ is a hyperplane in $\P^N$. Since $\P^N\setminus H$ is affine, $\P^n\setminus H$ is also affine (as a closed irreducible subset).
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Show that any two curves in $\P^2$ have a nonempty intersection.
\item[(b)] More generally, show that if $Y\sub\P^n$ is a projective variety of dimension $\geq 1$, and if $H$ is a hypersurface, then $Y\cap H\neq\emp$.
\end{itemize}
\end{exercise}
\begin{exercise}
Let $H_i$ and $H_j$ be the hyperplanes in $\P^n$ defined by $x_i=0$ and $x_j=0$, with $i\neq j$. Show that any regular function on $\P^n\setminus(H_i\cap H_j)$ is constant.
\end{exercise}
\begin{proof}
Let $U_i=\P^n\setminus H_i$ and $U_j=\P^n\setminus H_j$, then $\P^n\setminus(H_i\cap H_j)=U_i\cup U_j$. If $f$ is a regular function on $U_i\cup U_j$, then the restriction to $U_i$ is $f_i/x_i^{n_i}$, and to $U_j$ is $f_j/x_j^{n_j}$. Since the restrictions coincide on $U_i\cap U_j$, we see that $f_ix_j^{n_j}=f_jx_i^{j_i}$. Now, from the uniqueness of the decomposition into prime factors in the polynomial ring, we see $n_i=n_j=0$ and $f_i=f_j=f$, so $f$ has degree $0$ and is a constant. 
\end{proof}
\begin{exercise}
The homogeneous coordinate ring of a projective variety is not invariant under isomorphism. For example, let $X=\P^1$, and let $Y$ be the $2$-uple embedding of $\P^1$ in $\P^2$. Then $X\cong Y$. But show that $S(X)\ncong S(Y)$.
\end{exercise}
\begin{proof}
The homogeneous coordinate ring of $\P^1$ is $k[\P^1]=k[x,y]$. If $Y$ is the image of $\P^1$ under the $2$-uple embedding, then $Y$ is the hypersurface defined by $xy=z^2$, so $k[Y]=k[x,y,z]/(xy-z^2)$. We have $k[x,y,z]/(xy-z^2)\ncong k[x,y]$ since the space of elements of degree $1$ is $3$ dimensional in $k[Y]$.
\end{proof}
\begin{exercise}[\textbf{Subvarieties}]
A subset of a topological space is \textbf{locally closed} if it is an open subset of its closure, or, equivalently, if it is the intersection of an open set with a closed set.\par
If $X$ is a quasi-affine or quasi-projective variety and $Y$ is an irreducible locally closed subset, then $Y$ is also a quasi-affine (respectively, quasi-projective) variety, by virtue of being a locally closed subset of the same affine or projective space. We call this the induced structure on $Y$, and we call $Y$ a \textbf{subvariety} of $X$.\par
Now let $\varphi:X\to Y$ be a morphism, let $X'\sub X$ and $Y'\sub Y$ be irreducible locally closed subsets such that $\varphi(X')\sub Y'$. Show that $\varphi|_{X'}:X'\to Y'$ is a morphism.
\end{exercise}
\begin{proof}
Let $Y\sub X$. If $Y$ is open in $\widebar{Y}$, then $Y=U\cap\widebar{Y}$ where $U$ is open in $X$. Conversely, if $Y=U\cap F$ where $U$ is open in $X$ and $F$ is closed in $X$, then $\widebar{Y}\sub\widebar{U}\cap F$ and
\[Y=U\cap F\sub\widebar{Y}\cap U\sub \widebar{U}\cap F\cap U=U\cap F=Y\]
whence $Y=\widebar{Y}\cap U$ is open in $\widebar{Y}$.
\end{proof}
\begin{exercise}
Let $X$ be any variety and let $p\in X$. Show there is a 1-1 correspondence between the prime ideals of the local ring $\mathcal{O}_{X,p}$ and the closed subvarieties of $X$ containing $p$.
\end{exercise}
\begin{proof}
Let $X$ be any variety and let $p\in X$. Irreducible varieties containing $p$ correspond to prime ideals of $k[X]$ contained in the maximal ideal $\m_p$, which in turn correspond to the prime ideas of the ring $k[X]_{\m_p}$, which is just $\mathcal{O}_{X,p}$, the local ring at $p$.
\end{proof}
\begin{exercise}
If $p$ is a point on a variety $X$, then $\dim(\mathcal{O}_{X,p})=\dim(X)$.
\end{exercise}
\begin{proof}
If $p$ is a point on a variety $X$, then there is an affine neighborhood $U$ with $\dim(U)=\dim(X)$. Since $\mathcal{O}_{U,p}=\mathcal{O}_{X,p}$, we see $\dim(X)=\dim(U)=\dim(\mathcal{O}_{X,p})=\dim(\mathcal{O}_{U,p})$.
\end{proof}
\begin{exercise}[\textbf{The Local Ring of a Subvariety}]
Let $Y\sub X$ be a subvariety. Let $\mathcal{O}_{X,Y}$ be the set of equivalence classes $(U,f)$ where $U\sub X$ is open, $U\cap Y\neq\emp$, and $f$ is a regular function on $U$. We say $(U,f)$ is equivalent to $(V,g)$ if $f=g$ on $U\cap V$. Show that $\mathcal{O}_{X,Y}$ is a local ring, with residue field $K(Y)$ and dimension $\dim(X)-\dim(Y)$. It is the local ring of $Y$ on $X$. Note if $Y=\{p\}$ is a point we get $\mathcal{O}_{X,p}$, and if $Y=X$ we get $K(X)$. Note also that if $Y$ is not a point, then $K(Y)$ is not algebraically closed, so in this way we get local rings whose residue fields are not algebraically closed.
\end{exercise}
\begin{proof}
It is clear that $\mathcal{O}_{X,Y}$ is a ring. To see that it is local, let
\[\m_{X,Y}=\{(U,f):\text{$f(p)=0$ for all $p\in U\cap Y$}\}.\]
Then $\m_{X,Y}$ is a maximal ideal and every $(U,f)\notin\m_{X,Y}$ is invertible in $\mathcal{O}_{X,Y}$: since if $f(p)\neq 0$ for some $p\in U\cap Y$, then there is an open set $V$ of $X$ containing $p$ such that $f$ has no zero on $V\cap Y$. Then $(V,1/f)$ is well-defined and an inverse of $(U,f)$ in $\mathcal{O}_{X,Y}$. Therefore $\mathcal{O}_{X,Y}$ is a local ring.\par
The residue field of $\mathcal{O}_{X,Y}$ is $\mathcal{O}_{X,Y}/\m_{X,Y}$, whose elements are given by pairs $(U,f)$ such that $f$ is not zero on $U\cap Y$. Therefore $\mathcal{O}_{X,Y}/\m_{X,Y}\cong K(Y)$.\par
Finally, to compute the dimension of $\mathcal{O}_{X,Y}$, we may reduce to the case $X$ is affine. Then the height of $\m_{X,X}$ in $\mathcal{O}_{X,Y}$ is equal to $\height(\a)$, where $\a=\{f\in k[X]:f|_Y=0\}=I(Y)/I(X)$. Therefore
\[\dim(\mathcal{O}_{X,Y})=\height(\m_{X,Y})=\height(I(Y)/I(X))=(n-\dim(Y))-(n-\dim(X))=\dim(X)-\dim(Y).\]
This completes the proof.
\end{proof}
\begin{exercise}[\textbf{Projection from a Point}]
Let $\P^n$ be a hyperplane in $\P^{n+1}$ and let $p\in\P^{n+1}\setminus\P^n$. Define a mapping $\varphi:\P^{n+1}\setminus\{p\}\to\P^n$ by letting $\varphi(q)$ be the intersection of the unique line containing $p$ and $q$ with $\P^n$.
\begin{itemize}
\item[(a)] Show that $\varphi$ is a morphism.
\item[(b)] Let $Y\sub\P^3$ be the twisted cubic curve which is the image of the $3$-uple embedding of $\P^1$. If $[s:t]$ are the homogeneous coordinates on $\P^1$, we say that $Y$ is the curve given parametrically by $[x:y:z:w]=[s^3:s^2t:st^2:t^3]$. Let $p=[0:0:1:0]$, and let $\P^2$ be the hyperplane $z=0$. Show that the projection of $Y$ from $p$ is a cuspidal cubic curve in the plane, and find its equation. 
\end{itemize}
\end{exercise}
\begin{proof}
By a change of coordinates let $\P^n$ be the hypersurface defined $x_0=0$ and let $p=[1:0:\dots:0]$. If $x=[x_0:\dots:x_n]\in\P^{n+1}\setminus\{p\}$, then $x_i\neq 0$ for some $i\neq 0$. Therefore the line containing $p$ and $x$ is the set $\{[ax_0+b:ax_1:\dots:ax_n]:a,b\in k\}$, which meets $\P^n$ in $[0:x_1:\dots:x_n]$. Thus $\varphi$ is a morphism in a neighborhood $x_i\neq 0$, so is a morphism.\par
The projection of $[s^3:s^2t:st^2:t^3]$ to $\P^2$ along $[0:0:1:0]$ is given by $[s^3:s^2t:0:t^3]$, which is on the variety $y^3-x^2w=0$. Therefore the image of $\varphi$ is $V(y^3-x^2w,z)$. This is isomorphism to the projective closure of the cuspidal cubic in $\P^2$. If $x_0\neq 0$, this is the cuspidal cubic, with the cusp at $(0,0)$ in affine coordinates or $[1:0:0]$ in projective coordinates.
\end{proof}
\begin{exercise}[\textbf{Products of Affine Varieties}]
Let $X\sub\A^n$ and $Y\sub\A^m$ be affine varieties.
\begin{itemize}
\item[(a)] Show that $X\times Y\sub\A^{n+m}$ with its induced topology is irreducible. The affine variety $X\times Y$ is called the product of $X$ and $Y$. Note that its topology is in general not equal to the product topology.
\item[(b)] Show that $k[X\times Y]\cong k[X]\otimes_kk[Y]$.
\item[(c)] Show that $X\times Y$ is a product in the category of varieties, i.e., show
\begin{itemize}
\item[(\rmnum{1})] The projections $X\times Y\to X$ and $X\times Y\to Y$ are morphisms.
\item[(\rmnum{2})] Given a variety $Z$ and the morphisms $Z\to X$, $Z\to Y$, there is a unique morphism $Z\to X\times Y$ making a commutative diagram
\[\begin{tikzcd}
Z\ar[rdd,bend right=25pt]\ar[rrd, bend left=20pt]\ar[rd,dashed]&&\\
&X\times Y\ar[d]\ar[r]&Y\\
&X&
\end{tikzcd}\]
\end{itemize}
\item[(c)] Show that $\dim(X\times Y)=\dim(X)+\dim(Y)$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $X\times Y\sub\A^{n+m}$. Assume that $X\times Y=Z_1\cup Z_2$ for $Z_1,Z_2$ proper and closed in $X\times Y$. For each $x\in X$, since $Y$ is irreducible, the subspace $\{x\}\times Y$ is irreducible, and hence contained in $Z_1$ or $Z_2$. Thus if $X_i=\{x\in X:\{x\}\times Y\sub Z_i\}$, then we have $X=X_1\cup X_2$. To see $X_i$ is closed, we have
\begin{align*}
X_i&=\{x\in\A^n:\forall f\in I(Z_1),\forall b\in Y,f(x,b)=0\}\\
&=\{x\in\A^n:\forall f\in I(Z_1),\forall b\in Y,f^b(x)=0\}\\
&=\bigcap_{b\in Y}V(I(Z_1)^b)
\end{align*}
where we define $f^b(x)=f(x,b)$. Since $X_i$ is closed and $X$ is irreducible, $X=X_1$ or $X=X_2$, so $X\times Y=Z_1$ or $Z_2$, contradiction, so $X\times Y$ is irreducible.\par
Define a homomorphism $\varphi:k[X]\otimes_kk[Y]\to k[X\times Y]$ by
\[\sum_{ij}(f_i\otimes g_j)(x,y)\mapsto\sum_{ij}f_i(x)g_j(y).\]
The right hand side is regular on $X\times Y$, and it is clear that $\varphi$ is onto since the coordinate functions are contained in the image of $\varphi$. To prove that $\varphi$ is one to one, let $\{f_i\}$ be a basis for the $k$-vector space $k[X]$ and $\{g_j\}$ a basis for $k[Y]$. Then if $\sum_{ij}a_{ij}f_ig_j=0$ in $k[X\times Y]$, then
\[\sum_{ij}a_{ij}f_i(x)g_j(y)\in I(X\times Y).\]
For each $x_0\in X$, consider $\sum_{i}a_{ij}f_i(x_0)g_j(y)$. This function is zero on $Y$ by hypothesis, whence $\sum_ia_{ij}f_i(x_0)=0$ in $k[Y]$ for each $j$ since $\{g_j\}$ are linearly independent in $k[Y]$. We conclude that $\sum_ia_{ij}f_i(x)=0$ in $k[X]$ for each $i$, and since $\{f_i\}$ are linearly independent in $k[X]$, this shows $a_{ij}=0$ for all $i,j$. Thus $\varphi$ is injective.\par
Also, the projection maps are clearly morphisms and given a variety $Z$ with morphisms $\varphi:Z\to X$ and $\psi:Z\to Y$, there is an induced map $\varphi\times\psi:Z\to X\times Y$. Thus $X\times Y$ is the product of $X$ and $Y$ in the category of varieties. Finally, since $\dim(k[X]\otimes_kk[Y])=\dim(k[X])+\dim(k[Y])$, we see $\dim(X\times Y)=\dim(X)+\dim(Y)$.
\end{proof}
\begin{exercise}[\textbf{Products of Quasi-Projective Varieties}]
Use the Segre embedding to identify $\P^n\times\P^m$ with its image and hence give it a structure of projective variety. Now for any two quasi-projective varieties $X\sub\P^n$ and $Y\sub\P^m$, consider $X\times Y\sub\P^n\times\P^m$.
\begin{itemize}
\item[(a)] Show that $X\times Y$ is a quasi-projective variety.
\item[(b)] If $X,Y$ are both projective, show that $X\times Y$ is projective.
\item[(c)] Show that $X\times Y$ is a product in the category of varieties. 
\end{itemize}
\end{exercise}
\begin{proof}
Since $\P^n\times\P^m$ is embedded into $\P^N$, it is a projective variety. Now $X\times Y$ is identied with $(X\times\P^m)\cap(\P^n\times Y)$, hence is quasi-projective ($X\times\P^m$ and $\P^n\times Y$ are quasi-projective since projections are regular maps). Similarly, if $X$ and $Y$ are projective, then $X\times Y$ is projective. The variety $X\times Y$ is a product in the category of varieties since restriction to open covers gives well defined projections and similarly, we can restrict to these open covers to get the universal property.
\end{proof}
\begin{exercise}[\textbf{Normal Varieties}]
A variety $Y$ is normal at a point $p\in Y$ if $\mathcal{O}_{Y,p}$ is an integrally closed ring. $Y$ is normal if it is normal at every point.
\begin{itemize}
\item[(a)] Show that every conic in $\P^2$ is normal.
\item[(b)] Show that the quadric surfaces $Q_1,Q_2$ in $\P^3$ given by equations $Q_1:xy-zw$ and $Q_2:xy=z^2$ are normal.
\item[(c)] Show that the cuspidal cubic $y^2=x^3$ in $\A^2$ is not normal.
\item[(d)] If $Y$ is affine, then $Y$ is normal if and only if $k[Y]$ is integrally closed. 
\item[(e)] Let $Y$ be an affine variety. Show that there is a normal affine variety $\tilde{Y}$, and a morphism $\pi:\tilde{Y}\to Y$, with the property that whenever $Z$ is a normal variety, and $\varphi:Z\to Y$ is a dominant morphism (i.e., $\varphi(Z)$ is dense in $Y$), then there is a unique morphism $\tilde{\varphi}:Z\to\tilde{Y}$ such that $\varphi=\pi\circ\tilde{\varphi}$. The variety $\tilde{Y}$ is called the normalization of $Y$.
\end{itemize}
\end{exercise}
\begin{proof}
By Exercise~\ref{conic in A^2 and P^2 prop}, every conic in $\P^2$ is isomorphic to $\P^1$, and every local ring of $\P^1$ is a localization of $k[x_0,x_1]$, which is integrally closed since $k[x_0,x_1]$ is integrally closed. Thus every conic in $\P^2$ is normal.\par
For an affine variety $X$, $X$ is normal if and only if $k[X]_\m$ is maximal for any maximal ideal of $\m$, if and only if $k[X]$ is normal (since it is an integral domain).\par
For the projective variety $Q_1$, we consider the affine part $\{w\neq 0\}$, where $Q_1$ is locally the affine variety $V(z-xy)$. The coordinate ring of this variety is $k[x,y,z]/(z-xy)=k[x,y]$, which is integrally closed. Thus $Q_1$ is normal.\par
For the surface $Q_2$, when $z\neq 0$ it is locally isomomorphic to the affine variety $V(xy-1)$, with coordinate ring $k[x,x^{-1}]$, which is integrally closed since it is the localization of $k[x]$. When $x\neq 0$ or $y\neq 0$, $Q_2$ is locally isomomorphic to the affine variety $V(x-z^2)$, with coordinate ring $k[z]$, which is integrally closed. Thus $Q_2$ is also normal.\par
For the cuspidal cubic $C:y^2=x^3$, its coordinate ring is $k[C]=k[x,y]/(y^2-x^3)=k[t^2,t^3]$. The integral closure of $k[C]$ is $k[t]$, so it is not integrally closed, whence $C$ is not normal. More precisely, since $k[t^2,t^3]\to k[t]$ is an integral extension, every maxiaml ideal $\n$ of $k[t^2,t^3]$ is of the form
\[\n_a=\m_a\cap k[t^2,t^3]=\{g=f(t^2,t^3):f(a^2,a^3)=0\},\]
where $\m_a=(t-a)$ is the maximal ideal of $k[t]$ at point $a\in k$. Consider the induced map on localizations:
\[k[t^2,t^3]_{\n_a}\to k[t]_{\n_a}.\]
We know $k[t]_{\n_a}$ is the integral closure of $k[t^2,t^3]_{\n_a}$. If $a\neq 0$, then $t^2\notin\n_c$, so $t^2/1$ is invertible in $k[t^2,t^3]_{\n_a}$. since $t/1=t^3/t^2$, this implies $t/1\in k[t^2,t^3]_{\n_a}$, so $k[t^2,t^3]_{\n_a}=k[t]_{\n_a}$.\par
On the other hand, if $a=0$, then $t/1$ is not in $k[t^2,t^3]_{\n_a}$: assume otherwise, then $t/1=f(t^2,t^3)/g(t^2,t^3)$ where $g(0,0)\neq 0$. Then since $f(0,0)=0$, the degree of $t$ in $f(t^2,t^3)$ must be bigger than $2$, which is a contradiction.\par
Finally, let $Y$ be an affine variety and $A=k[Y]$ its coordinate ring. Let $\widebar{A}$ be the integral closure of $A$, which corresponds to an affine variety $\tilde{Y}$. By the equivalence of varieties, any dominant map $\varphi:Z\to Y$ corresponds to an injective homomorphism $k[Y]\to k[Z]$ (Exercise~\ref{morphism induced on local ring prop}), which factors through $k[\tilde{Y}]$ if $k[Z]$ is normal. This proves (e).
\end{proof}
\begin{exercise}[\textbf{Projectively Normal Varieties}]
A projective variety $Y\sub\P^n$ is projectively normal (with respect to the given embedding) if its homogeneous coordinate ring $S(Y)$ is integrally closed.
\begin{itemize}
\item[(a)] If $Y$ is projectively normal, then $Y$ is normal.
\item[(b)] There are normal varieties in projective space which are not projectively normal. For example, let $Y$ be the twisted quartic curve in $\P^3$ given parametrically by $[x:y:z:w]=[s^4:s^3t:st^3:t^4]$. Then $Y$ is normal but not projectively normal.
\item[(c)] Show that the twisted quartic curve $Y$ above is isomorphic to $\P^1$, which is projectively normal. Thus projective normality depends on the embedding.
\end{itemize}
\end{exercise}
\begin{proof}
If $Y$ is projectively normal, then $S(Y)$ is integrally closed. The twisted quartic curve $[s^4:s^3t:st^3:t^4]$ is isomomorphic to $\P^1$, so it is normal.
\end{proof}
\begin{exercise}
Let $Y$ be a variety of dimension $\geq 2$, and let $p\in Y$ be a normal point. Let $f$ be a regular function on $Y\setminus\{p\}$.
\begin{itemize}
\item[(a)] Show that $f$ extends to a regular function on $Y$.
\item[(b)] Show this would be false for $\dim(Y)=1$.
\end{itemize}
\end{exercise}
\begin{proof}
BY restricting $f$ to an affine open subset containing $p$, we may assume that $Y$ is affine. Then the local ring $\mathcal{O}_{Y,p}$ is isomomorphic to $k[Y]_{\m_p}$, which is integrally closed by hypothesis. Then since $k[Y]_{\m_p}$ is Noetherian, it is a Krull domain and we then have
\[k[Y]_{\m_p}=\bigcap_{\mathcal{Q}\sub k[Y]_{\m_p}\atop\height(\mathcal{Q})=1}(k[Y]_{\m_p})_{\mathcal{Q}}=\bigcap_{\q\sub\m_p\atop \height(\q)=1}k[Y]_{\q}.\]
Now $f$ is regular at $Y\setminus\{p\}$, so this map must be of the form $g/h$, where $g$ and $h$ lie in $k[Y]$ and $h\neq 0$. It remains to show that $h$ is not in any height $1$ prime $\q\sub\m_p$, because then $g/h$ will lie in $k[Y]_{\m_p}$ so $f$ will be regular at $p$. If $h$ were in such a prime $\q$, then $h$ would vanish on $V(\q)$, which is a variety with codimension $1$ in $Y$. We can find a point $q\neq p$ in $V(\q)$ because $\dim(Y)\geq 2$. But then $f$ is regular at $q$ so $h$ cannot vanish at $q$. This proves the claim, as desired.
\end{proof}
\section{Rational map}
\begin{exercise}
If $f$ and $g$ are regular functions on open subsets $U$ and $V$ of a variety $X$, and if $f=g$ on $U\cap V$, show that the function which is $f$ on $U$ and $g$ on $V$ is a regular function on $U\cup V$. Conclude that if $f$ is a rational function on $X$, then there is a largest open subset $U$ of $X$ on which $f$ is represented by a regular function. We say that $f$ is defined at the points of $U$.
\end{exercise}
\begin{exercise}
If $\varphi$ is a rational map of $X$ to $Y$, show there is a largest open set on which $\varphi$ is represented by a morphism. We say the rational map is defined at the points of that open set.
\end{exercise}
\begin{exercise}
A rational map is an equivalent class $(U,\varphi_U)$ where $\varphi_U$ is a morphism from $X$ to $Y$. Since any two morphisms in this class coincides over their intersection, this gives a maximal defined morphism which representing $\varphi$.
\end{exercise}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $f$ be the rational function on $\P^2$ given by $f(x_0,x_1,x_2)=x_1/x_0$. Find the set of points where $f$ is defined and describe the corresponding regular function.
\item[(b)] Now think of this function as a rational map from $\P^2$ to $\A^1$. Embed $\A^1$ in $\P^1$ and let $\varphi:\P^2\to\P^1$ be the resulting rational map. Find the set of points where $\varphi$ is defined, and describe the corresponding morphism.
\end{itemize}
\end{exercise}
\begin{proof}
Let $f:\P^2\to k$ be defined by $[x_0:x_1:x_2]\mapsto x_1/x_0$. This is a rational function defined where $x_0\neq 0$. The corresponding regular function $f:\A^2\to\A^1$ is $(x_1,x_2)\mapsto x_1$.\par
Viewing $\varphi$ now as a map from $\P^2\to\P^1$, it is easy to see that $\varphi$ is defined when its image is nonzero. The projection map is $[x_0:x_1:x_2]\mapsto[x_0,x_1]$ and is defined everywhere except at the point $[0:0:1]$.
\end{proof}
\begin{exercise}
A variety $Y$ is rational if it is birationally equivalent to $\P^n$ for some $n$ (or, equivalently, if $K(Y)$ is a pure transcendental extension of $k$).
\begin{itemize}
\item[(a)] Any conic in $\P^2$ is a rational curve.
\item[(b)] The cuspidal cubic $y^2=x^3$ is a rational curve.
\item[(c)] Let $Y$ be the nodal cubic curve $y^2z=x^2(x+z)$ in $\P^2$. Show that the projection $\pi$ from the point $p=[0:0:1]$ to the line $z=0$ induces a birational map from $Y$ to $\P^1$. Thus $Y$ is a rational curve. 
\end{itemize}
\end{exercise}
\begin{proof}
Any conic in $\P^2$ is isomomorphic to $\P^1$, hence rational. Also, the cuspidal cubic $y^2=x^3$ has function field $k(t)$, so is rational.\par
The projection is given by $[x:y:z]\mapsto[x:y]$. Let $U\sub Y$ be the open subset where $z\neq 0$, then we have a rational map $\varphi:[x:y:1]\mapsto[x,y]$, which maps $U$ into the variety $C:y^2=x^2(x+1)$, the nodal curve. Since $(x,y)\neq 0$, the image of $\varphi$ is contained in $C\setminus\{0\}$. We know that $C\setminus\{0\}$ is birationally equivalent to $\P^1$ via the blow up of $\A^2$, whence $Y$ is birational equivalent to $\P^1$. 
\end{proof}
\begin{exercise}[\textbf{Plane Cremona Tramiformations}]
A birational map of $\P^2$ into itself is called a plane Cremona transformation. We give an example, called a quadratic transformation. It is the rational map $\varphi:\P^2\to\P^2$ given by
\[[a_0:a_1:a_2]\mapsto[a_1a_2:a_0a_2:a_0a_1]\]
when no two of $a_0,a_1,a_2$ are $0$.
\begin{itemize}
\item[(a)] Show that $\varphi$ is birational, and is its own inverse.
\item[(b)] Find open sets $U,V\sub\P^2$ such that $\varphi:U\to V$ is an isomorphism.
\item[(c)] Find the open sets where $\varphi$ and $\varphi^{-1}$ are defined, and describe the corresponding morphisms.
\end{itemize}
\end{exercise}
\begin{proof}
It is easy to see $\varphi$ is rational, and we have
\[\varphi^2([a_0:a_1:a_2])=\varphi([a_1a_2:a_0a_2:a_0a_1])=[a_0^2a_1a_2:a_0a_1^2a_2:a_0a_1a_2^2]\]
which equals to $[a_0:a_1:a_2]$ when $a_0,a_1,a_2$ are all nonzero. Thus $\varphi$ is birational, and is an isomorphism on $\{xyz\neq 0\}$. 
\end{proof}
\begin{exercise}
Let $X$ and $Y$ be two varieties. Suppose there are points $p\in X$ and $q\in Y$ such that the local rings $\mathcal{O}_{X,p}$ and $\mathcal{O}_{Y,q}$ are isomorphic as $k$-algebras. Then show that there are open sets $p\in U\sub X$ and $q\in V\sub Y$ and an isomorphism of $U$ to $V$ which sends $p$ to $q$.
\end{exercise}
\begin{proof}
Let $\tau:\mathcal{O}_{Y,q}\to\mathcal{O}_{X,p}$ be the isomorphism. Then we get an isomorphism $\tau:K(Y)\to K(X)$, which induces a birational map $\varphi:X\to Y$. Moreover, by the definition of $\varphi$, $\varphi^*$ maps $\mathcal{O}_{Y,q}$ to $\mathcal{O}_{X,p}$, so $\varphi(p)=q$.
\end{proof}
\begin{exercise}
Let $X$ be a projective variety of dimension $r$ in $\P^n$, with $n\geq r+2$. Show that for suitable choice of $p\notin X$ and a linear subspace $\P^{n-1}\sub\P^n$. the projection from $p$ to $\P^{n-1}$ induces a birational morphism of $X$ onto its image $Y\sub\P^{n-1}$. 
\end{exercise}
\begin{proof}
After permuting coordinates, we may assume without loss of generality that $X\cap U_0\neq\emp$. Then, the images of the rational functions $x_i/x_0$ generate $K(X)$ over $k$. Since $k$ is algebraically closed, we see the extension $K(X)/k$ is separably generated. Since $\dim(X)=r$, after possible permutation of coordinates, we have that $x_1/x_0,\dots,x_r/x_0$ form a separating transcendence basis for $K(X)$ over $k$ to give the chain
\[k\sub k(x_1/x_0,\dots,x_r/x_0)\sub K(X).\]
By the theorem of the primitive element, we see that $K(X)$ is generated by $\alpha=\sum_{i=r+1}^{n}c_ix_i/x_0$, where $c_i\in k$ for every $i$. After a linear change of coordinates, we may assume that $\alpha=x_{r+1}/x_0$. Now consider the map
\[\P^n\setminus\{p\}\to\P^{n-1},\quad [x_0:\dots:x_n]\mapsto[x_0:\dots:x_{n-1}:0].\]
This is the projection away from the point $p=[0:\dots:0:1]$ to the hyperplane $V(x_n)$. Restricting the codomain to $V(x_n)\cong\P^{n-1}$, we obtain the rational map
\[\pi:\P^n\setminus\{p\}\to\P^{n-1},\quad [x_0:\dots:x_n]\mapsto[x_0:\dots:x_{n-1}].\]
Let $Y$ denote the image of $X$ through this map $\pi$. Then $K(Y)$ is generated by the rational functions $x_i/x_0$ for $1\leq i\leq r+1$. The map on function fields corresponding to $\pi$ is
\[K(Y)\to K(X),\quad x_i/x_0\mapsto x_i/x_0.\]
Thus we see $K(Y)=K(X)$, whence $\pi$ is birational on $X$ and $Y$.
\end{proof}
\section{Nonsingular varieties}
\begin{exercise}
Let $X\sub\A^2$ be a curve defined by the equation $f(x,y)=0$. Let $p=(a,b)$ be a point of $\A^2$. Make a linear change of coordinates so that $p$ becomes the point $(0,0)$. Then write $f$ as a sum $f=f_0+f_1+\cdots+f_d$ where $f_i$ is a homogeneous polynomial of degree $i$ in $x$ and $y$. Then we define the multiplicity of $p$ on $X$, denoted $m_p(X)$, to be the least $r$ such that $f_r\neq 0$. (Note that $p\in X$ if and only if $m_p(X)=0$.) The linear factors of $f_r$ are called the \textbf{tangent directions} at $p$. Show that $m_p(X)=1$ of and only if $p$ is a nonsingular point of $X$.
\end{exercise}
\begin{proof}
The ring $\mathcal{O}_{X,p}$ is a local ring with maximal ideal $\m_p$. The multiplicity of $\m_p$ in $\mathcal{O}_{X,p}$ is exactly $m_p(X)$. By the Jacobi criterion, $p$ is nonsingular if and only if $(\partial f/\partial x,\partial f/\partial y)$ has rank $1$, which means $r=1$ and thus $m_p(X)=1$.
\end{proof}
\begin{exercise}
If $X,Y\sub\A^2$ are two distinct curves, given by equations $f=0$, $g=0$, and if $p\in X\cap Y$, we define the intersection multiplicity $(X\cdot Y)_p$ of $X$ and $Y$ at $p$ to be 
\[(X\cap Y)_p=\dim_k(\mathcal{O}_{\A^2,p}/(f,g)).\]
\begin{itemize}
\item[(a)] Show that $(X\cdot Y)_p$ is finite, and $(X\cdot Y)_p\geq m_p(X)m_p(Y)$.
\item[(b)] If $p\in X$, show that for almost all lines $L$ through $p$ (i.e., all but a finite number), $(L\cdot X)_p=m_p(Y)$.
\item[(c)] If $X$ is a curve of degree $d$ in $\P^2$, and if $L$ is a line in $\P^2$, $L\neq X$, show that $(L\cdot X)=d$. Here we define $(L\cdot X)=\sum(L\cdot X)_p$ taken over all points $p\in L\cap X$, where $(L\cdot X)_p$ is defined using a suitable affine cover of $\P^2$.
\end{itemize}
\end{exercise}
\begin{proof}
We may assume that $p=(0,0)$, and that all the components of $X$ and $Y$ pass through $p$. Let $\mathcal{O}=\mathcal{O}_{\A^2,p}$. If $X$ and $Y$ have no common components, then $V(f,g)$ consits of discrete point, whence $\dim(\mathcal{O}/(f,g))=0$ and therefore $\dim_k(\mathcal{O}/(f,g))$ is finite. If $X$ and $Y$ have a common component, then $\dim(\mathcal{O}/(f,g))\geq 1$, so $\dim_k(\mathcal{O}/(f,g))=+\infty$.\par
Let $\m=(x,y)$, $m=m_p(X)$ and $n=m_p(Y)$ (so that $f\in\m^m\setminus\m^{m+1}$ and $g\in\m^{n}\setminus\m^{n+1}$). Consider the following diagram of vector spaces and linear maps:
\[\begin{tikzcd}
k[x,y]/\m^n\times k[x,y]/\m^m\ar[r,"\psi"]&k[x,y]/\m^{n+m}\ar[r,"\varphi"]&k[x,y]/(\m^{m+n},f,g)\ar[r]\ar[d,"\alpha"]&0\\
&\mathcal{O}/(f,g)\ar[r,"\pi"]&\mathcal{O}/(f,g,\m^{m+n})\ar[r]&0
\end{tikzcd}\]
where $\varphi$, $\pi$ and $\alpha$ are the natural ring homomorphisms, and $\psi$ is defined by letting $\psi(\bar{p},\bar{q})=\widebar{pf+qg}$. Now $\varphi$ and $\pi$ are clearly surjective, and, since $V(\m^{n+m},f,g)=\{p\}$, $\alpha$ is an isomorphism. It is easy to check that the top row is exact. It follows that
\[\dim(k[x,y]/\m^n)+\dim(k[x,y]/\m^n)\geq\dim(\ker\varphi)\]
with equality if and only if $\psi$ is one-to-one, and that
\[\dim(k[x,y]/(\m^{m+n},f,g))=\dim(k[x,y]/\m^{m+n})-\dim(\ker\varphi).\]
Putting all this together, we get the following string of inequalities:
\begin{align*}
(X\cdot Y)_p&=\dim_k(\mathcal{O}/(f,g))\geq\dim_k(\mathcal{O}/(\m^{m+n},f,g))\\
&=\dim(k[x,y]/\m^{m+n})-\dim(\ker\varphi)\\
&\geq \dim(k[x,y]/\m^{m+n})-\dim(k[x,y]/\m^n)-\dim(k[x,y]/\m^n)=mn
\end{align*}
This shows that $(X\cdot Y)_p\geq m_p(X)m_p(Y)$ and that  if and only if both inequalities in the above string are equalities. The first such inequality is an equality if $\pi$ is an isomorphism, i.e., if $\m^{m+n}\sub (f,g)\mathcal{O}$. The second is an equality if and only if $\psi$ is one-to-one. We now show the following lemma:
\begin{lemma}
\mbox{}
\begin{itemize}
\item[(a)] If $X$ and $Y$ have no common tangents at $p$, then $\m^{t}\sub(f,g)\mathcal{O}$ for $t\geq n+m-1$.
\item[(b)] The map $\psi$ is one-to-one if and only if $f$ and $g$ have distinct tangents at $p$.
\end{itemize}
\end{lemma}
For (a), let $L_1,\dots,L_m$ be the tangents to $f$ and $M_1,\dots,M_n$ the tangents to $g$ (both at $p$). Let
\[a_{ij}=L_1\cdots L_i M_1\cdots M_j \for i,j\geq 0.\]
where we set $L_i=L_m$ if $i\geq m$ and $M_j=M_n$ if $j\geq n$. The set $\{a_{ij}:i+j=t\}$ forms a basis for the vector space of all forms of degree $t$ in $k[X,Y]$, so it suffices to show $a_{ij}\in(f,g)\mathcal{O}$ for $i+j\geq m+n-1$. But $i+j\geq m+n-1$ implies that either $i\geq m$ or $j\geq n$. Say $i\geq m$, so
\[a_{ij}=L_1\cdots L_m(L_{m+1}\cdots L_i M_1\cdots M_j)=a_{m0}b,\]
where $b$ is a form of degree $i+j-m$. Write $f=a_{m0}+\tilde{f}$, where all terms of $\tilde{f}$ are of degree $\geq m+1$. Then $a_{ij}=bf-b\tilde{f}$, where each term of $b\tilde{f}$ has degree $\geq i+j+1$. We will be finished, then, if we can show that $\m^t\sub(f,g)\mathcal{O}$ for all sufficiently large $t$.\par
This fact is surely a consequence of the Nullstellensatz: Let $V(f,g)=\{p,q_1,\dots,q_s\}$, and choose a polynomial $h$ so that $h(q_i)=0$ but $h(p)\neq 0$. Then $hx$ and $hy$ are in $I(V(f,g))$, so $(hx)^N,(hy)^N\in(f,g)\sub k[x,y]$ for some $N$. Since $h^N$ is a unit in $\mathcal{O}$, $x^N$ and $y^N$ are in $(f,g)\mathcal{O}$, and therefore $\m^{2N}\sub(f,g)\mathcal{O}$, as desired.\par
Finally, to prove (b), suppose the tangents are distinct, and that
\[\psi(\bar{p},\bar{q})=\widebar{pf+qg}=0\]
i.e., $pf+qg$ consists entirely of terms of degree $\geq m+n$. Suppose $r<m$ or $s<n$. Let $p_r$ be the homogeneous part of lowest degreee $r$ in $p$, and $g_s$ the homogeneous part of lowest degree $s$ of $g$, so that
\[pf+qg=p_rf_m+q_sg_n+\cdots.\]
Then we must have $r+m=s+n$ and $p_rf_m+q_sg_n=0$. But $f_m$ and $g_n$ have no common factors, so $f_m$ divides $q_s$ and $g_n$ divides $p_r$. Therefore $s\geq m$, $r\geq n$, so $(\bar{p},\bar{q})=(0,0)$. Conversely, if $L$ were a common tangent to $f$ and $g$ at $p$, write $f_m=L\tilde{f}_{m-1}$ and $g_n=L\tilde{g}_{n-1}$. Then $\psi(\widebar{\tilde{g}_{n-1}},-\widebar{\tilde{f}_{m-1}})=0$, so $\psi$ is not one-to-one. This completes the proof of the lemma.\par
If $X$ is a curve of degree $d$ and $L$ is a line such that $L\neq X$ and $L$ intersects with $X$, we want to show $\sum_p(L\cdot X)_p=d$. By an affine change, we may assume that $L=V(x)$. Then since $X$ and $L$ have no common components, by Proposition~\ref{polynomial ring Artin char}
\[\sum_{p\in X\cap L}(L\cdot X)_p=\sum_p\dim_k(k[x,y]_{\m_p}/(f,x)_{\m_p})=\dim_k(k[x,y]/(f,x))\]
and we know that the homogeneous part of degree $d$ in $f$ is not in $(x)$. Since $k[x,y]/(f,x)\cong k[y]/(\bar{f})$, we see $\dim_k(k[x,y]/(f,x))=d$.
\end{proof}
\begin{proposition}\label{polynomial ring Artin char}
Let $\a$ be an ideal in $k[x_1,\dots,x_n]$ ($k$ algebraically closed), and suppose $X=V(\a)=\{p_1,\dots,p_s\}$ is finite. Let $\m_i=\m_{p_i}$ and $k[X]=k[x_1,\dots,x_n]/\a$. Then there is a natural isomorphism of $k[X]$ with $\prod_{i=1}^{s}k[X]_{\m_i}$.
\end{proposition}
\begin{proof}
By hypothesis $k[X]$ is Artin, so there exist $k>0$ such that $0=\bigcap_i\m_i^k$, which is a primary decomposition of $0$. Then $A_{\m_i}$ can be identified with $A/\m_i^k$, and we have an isomomorphism $k[X]\to\prod_iA/\m_i^k=\prod_iA_{\m_i}$.
\end{proof}
\begin{exercise}
For every degree $d>0$, and every $p=0$ or a prime number, give the equation of a nonsingular curve of degree $d$ in $\P^2$ over a field $k$ of characteristic $p$.
\end{exercise}
\begin{proof}
If $p=0$ or $p$ does not divide $d$, then $x^d+y^d+z^d=0$ defines a nonsingular hyperplane of degree $d$. If $p$ divides $d$, then $xy^{d-1}+yz^{d-1}+xz^{d-1}=0$ works.
\end{proof}
\begin{exercise}[\textbf{Blowing Up Curve Singularities.}]
\mbox{}
\begin{itemize}
\item[(a)] Let $Y$ be the cusp or node of (Ex. 5.1). Show that the curve $\tilde{Y}$ obtained by blowing up $Y$ at $p=(0,0)$ is nonsingular.
\item[(b)] We define a node (also called ordinary double point) to be a double point (i.e., a point of multiplicity $2$) of a plane curve with distinct tangent directions. If $p$ is a node on a plane curve $Y$, show that $\varphi^{-1}(p)$ consists of two distinct nonsingular points on the blown-up curve $Y$. We say that "blowing up $p$ resolves the singularity at $p$".
\item[(c)] Let $p\in Y$ be the tacnode. If $\varphi:\tilde{Y}\to Y$ is the blowing-up at $p$, show that $\varphi^{-1}(p)$ is a node. Using (b) we see that the tacnode can be resolved by two successive blowings-up.
\item[(d)] Let $Y$ be the plane curve $y^3=x^5$, which has a "higher order cusp" at $0$. Show that $0$ is a triple point; that blowing up $0$ gives rise to a double point (what kind?) and that one further blowing up resolves the singularity.
\end{itemize}
\end{exercise}
\begin{proof}
Let $Y$ be defined by $x^6+y^6-xy$ (node). Blow-up $Y$ at $(0,0)$. Let $[s:t]$ be the homogeneous coordinates on $\P^1$. Then $\Gamma\sub\A^2\times\P^1$ is defined by $xt=ys$. Call the exceptional curve $E$. In the affine piece $s=1$, we get $y=xt$ and
\[x^6+y^6-xy=x^6+x^6t^6-x^2t=x^2(x^4+x^4t^6-t)=0.\]
This curve has two irreducible components. One is defined by $x=y=0$ and $t$ free, which is the exceptional line. Thus the curve $\tilde{Y}$ is defined by $x^4+x^4t^6-t=0$ and $y=xt$, which meets $E$ at $(0,0,0)$. Replacing $y=xt$, we get $\tilde{Y}$ is defined by $x^4+y^4t^2-t=0$. An easy check shows the partial derivatives never vanish, so $\tilde{Y}$ is non-singular.\par
Points on the exceptional curve correspond to tangent lines. Since a node has $2$ distinct tangent lines, we expect the blow-up of the curve to intersect the exceptional divisor twice. By a change of coordinates, $Y$ is defined by $xy+f(x,y)=0$ where $f(x,y)$ has only terms of degree greater than $2$. Let $p=(0,0)$. Blow-up $\A^2$ at $p$: $\Gamma\sub\A^2\times\P^1$ is defined by $xt=ys$. In the affine piece $s=1$, $y=xt$, so
\[xy+f(x,y)=x^2t+f(x,xt)=x^2(t+g(x,xt))=0.\]
Therefore we get $2$ irreducible components. One is the exceptional curve $E$ defined by $x=0$, $y=0$, $t$ free. $\tilde{Y}$ is defined by $t+g(x,y)=0$ and $y=xt$, which meets $E$ at $(0,0,0)\sub\A^3_{s\neq 0}$. Similar arguments in the affine piece $s=1$ show that $\tilde{Y}\cap E=(0,0,0)\sub\A^3_{s\neq 0}$. An easy check on the Jacobian shows that these points are nonsingular. Thus $\varphi^{-1}(p)\cap E=\{(0,0,1,0),(0,0,0,1)\}$.\par
Let $Y$ be the plane curve $y^3=x^5$, which has a higher order cusp at $0$. Since the lowest term is of degree $3$, $(0,0)$ is clearly a triple point. The blowup $\Gamma\sub\A^2\times\P^1$ is defined by $xt=ys$. In the affine piece $s=1$, $y=xt$; $y^3=x^5$ gives $x^3(x^2-t^3)=0$. We get two irreducible components: the exceptional curve $E$ is defined by $x=y=0$; $t$ free. $\tilde{Y}$ is defined by $x^2=t^3$, which has a cusp. By part (a), blowing up a cusp gives a nonsingular strict transform. Therefore $2$ blow-ups resolve the singularity.
\end{proof}
\begin{exercise}
Let $Y\sub\P^2$ be a nonsingular plane curve of degree $>1$, defined by the equation $f(x,y,z)=0$. Let $X\sub\A^3$ be the affine variety defined by $f$ (this is the cone over $Y$). Let $p$ be the point $(0,0,0)$, which is the vertex of the cone. Let $\varphi:\tilde{X}\to X$ be the blowing-up of $X$ at $p$.
\begin{itemize}
\item[(a)] Show that $X$ has just one singular point, namely $p$.
\item[(b)] Show that $X$ is nonsingular (cover it with open affines).
\item[(c)] Show that $\varphi^{-1}(p)$ is isomorphic to $Y$.
\end{itemize}
\end{exercise}
\begin{proof}
Since $f$ has degree $>1$, its derivatives at $(0,0,0)$ vanishes, so $p=(0,0,0)$ is a singular point of $X$. Since $Y$ is nonsingular, we see $X$ has just one singular point (see next exercise).\par
Blow up $X$ at $p=(0,0,0)$ to get $\tilde{X}\sub\A^3\times\P^2$, where the coordinates on $\P^2$ are $(u,v,w)$ where $xv=uy$, $xw=uz$, $yw=vz$. Look at the affine part $u=1$. Then $y=xv$ and $z=xw$, so the equation $f(x,y,z)=0$ becomes
\[f(x,xv,xw)=x^df(1,v,w)=0.\]
Thus we obtain two irreducible components, one defined by $x=y=z=0$, $v,w$ arbitrary arbitrary, which is $E$, and the other defined by
\[f(1,v,w)=0,\quad y=xv,\quad z=xw.\]
This is $\tilde{X}$. Therefore the dimension of $\tilde{X}$ is $2$, and by Jacobi criterion, since $Y$ has no singularity, we see $\tilde{X}$ has no singularity in the affine part $\{u\neq 0\}$. Similarly we can show that $X$ is nonsingular.\par
The intersection of $\tilde{X}$ with $E$ is given by $x=y=z=0$ and $f(1,v,w)=0$, which corresponds to $Y$ in the affine part $\{u\neq 0\}$. Thus $\varphi^{-1}(p)$ corresponds to $Y$.  
\end{proof}
\begin{exercise}
Let $Y\sub\P^n$ be a projective variety of dimension $r$. Let $f_1,\dots,f_r$ be homogeneous polynomials generating the ideal of $Y$. Let $p\in Y$ with homogeneous coordinates $p=[a_0:\dots:a_n]$. Show that $p$ is nonsingular on $Y$ if and only if the rank of the matrix $(\partial f_i/\partial x_j)$ is $n-r$.
\end{exercise}
\begin{proof}
First, since the partials are homogeneous polynomials, the rank of $J=(\partial f_i/\partial x_j)$ is independent of the homogeneous coordinate choosen for $p$ (the rank of $J$ is determined by the nonzeroness of a minor). By Euler's theorem, $\sum_ix_i(\partial f/\partial x_i)=df$ for every homogeneous polynomial of degree $d$. Thus if we pass to the affine Jacobi, the deleted row of $J$ is a multiple of the other rows (we have $f(p)=0$), so this does not change the rank of $J$. The claim then follows from the affine case.
\end{proof}
\begin{exercise}
Let $f\in k[x,y,z]$ be a homogeneous polynomial, let $Y=v(f)\sub\P^2$ be the algebraic set defined by $f$, and suppose that for every $p\in Y$, at least one of $(\partial f/\partial x)(p)$, $(\partial f/\partial y)(p)$, $(\partial f/\partial z)(p)$ is nonzero. Show that $f$ is irreducible (and hence that $Y$ is a nonsingular variety).
\end{exercise}
\begin{proof}
Assume that $f=gh$ is an nontrivial decomposition of $f$. Then $V(f)=V(g)\cup V(h)$. Since $V(f)$ and $V(h)$ are curves in $\P^2$, they must intersect, say at $p_0\in\P^2$. Then by definition, we must have $g(p_0)=0$ and $h(p_0)=0$, whence
\[f_x(p_0)=(g_xh+gh_x)(p_0)=0,\quad f_y(p_0)=(g_yh+gh_y)(p_0)=0,\quad f_z(p_0)=(g_zh+gh_z)(p_0)=0.\]
This is a contradiction.
\end{proof}
\begin{exercise}
For a point $p$ on a variety $X$, let $\m_p$ be the maximal ideal of the local ring $\mathcal{O}_{X,p}$. We define the \textbf{Zariski tangent space} $T_p(X)$ of $X$ at $p$ to be the dual $k$-vector space of $\m/\m^2$.
\begin{itemize}
\item[(a)] For any point $p\in X$, $\dim(T_p(X))\geq\dim(X)$, with equality if and only if $p$ is nonsingular.
\item[(b)] For any morphism $\varphi:X\to Y$, there is a natural induced $k$-linear map $T_p(\varphi):T_p(X)\to T_{\varphi(p)}(Y)$.
\item[(c)] If $\varphi$ is the vertical projection of the parabola $x=y^2$ onto the $x$-axis, show that the induced map $T_0(\varphi)$ of tangent spaces at the origin is the zero map. 
\end{itemize}
\end{exercise}
\begin{proof}
We have $[\m_p/\m_p^2:\kappa(p)]\geq\dim(\mathcal{O}_{X,p})$, with equality iff $\mathcal{O}_{X,p}$ is regular. This proves (a). Now let $\varphi:X\to Y$ be a morphism. Then we have an induced homomorphism $\varphi_p^*:\mathcal{O}_{Y,\varphi(p)}\to\mathcal{O}_{X,p}$. By the definition of $\varphi_p^*$ (it is the composition with $\varphi$), we see it is local, so induces a $k$-linera map $\m_{\varphi(p)}/\m_{\varphi(p)}^2\to\m_p/\m_p^2$. Taking duals, we get (b).\par
If $\varphi$ is the map $(x,y)\mapsto x$, then $\varphi^*$ is the homomorphism $k[x]\to k[y^2,y]=k[y]$ given by $x\mapsto y^2$. Localizing, we get the local homomorphism $\varphi_0^*:k[x]_{(x)}\to k[y]_{(y)}$. Note that the induced linear map on $\m_0/\m_0^2$ is zero, so its dual is also zero.
\end{proof}
\begin{exercise}[\textbf{The Elliptic Quartic Curve in $\P^3$}]
Let $Y$ be the algebraic set in $\P^3$ defined by the equations $x^2-xz-yw=0$ and $yz-xw-zw=0$. Let $p$ be the point $[x:y:z:w]=[0:0:0:1]$, and let $\varphi$ denote the projection from $p$ to the plane $w=0$. Show that $\varphi$ induces an isomorphism of $Y\setminus\{p\}$ with the plane cubic curve $x^3-xz^2-y^2z=0$ minus the point $(1,0,-1)$. Then show that $Y$ is an irreducible nonsingular curve. It is called the elliptic quartic curve in $\P^3$. Since it is defined by two equations: it is another example of a complete intersection.
\end{exercise}
\begin{proof}
From the two equations $x^2-xz-yw=0$ and $yz-xw-zw=0$ we can cancel $w$ and get $x^3-xz^2-y^2z=0$. This show $\im\varphi$ is contained in the curve $x^3-xz^2-y^2z=0$. Conversely, if $(x,y,z)$ is in this curve and $x+z\neq 0$, then by defining $w=yz/(x+z)$ we see $[x:y:z:w]$ is in $Y$.
\end{proof}
\begin{exercise}[\textbf{Quadric Hypersurfaces}]
Assume $\char(k)\neq 2$, and let $f$ be a homogeneous polynomial of degree $2$ in $x_0,\dots,x_n$.
\begin{itemize}
\item[(a)] Show that after a suitable linear change of variables, $f$ can be brought into the form $f=x_0^2+\cdots+x_r^2$ for some $0\leq r\leq n$.
\item[(b)] Show that $f$ is irreducible if and only $r\geq 2$.
\item[(c)] Assume $r\geq 2$, and let $Q$ be the quadric hypersurface in $\P^n$ defined by $f$. Show that the singular locus $Z=\mathrm{Sing}(Q)$ of $Q$ is a linear variety of dimension $n-r-1$. In particular, $Q$ is nonsingular if and only if $r=n$.
\item[(d)] In case $r<n$, show that $Q$ is a cone with axis $Z$ over a nonsingular quadric hypersurface $Q'\sub\P^r$. (If $Y$ is a closed subset of $\P^r$, and if $Z$ is a linear subspace of dimension $n-r-1$ in $\P^n$, we embed $\P^r$ in $\P^n$ so that $\P^r\cap Z=\emp$, and define the \textbf{cone over $Y$ with axis $Z$} to be the union of all lines joining a point of $Y$ to a point of $Z$.) 
\end{itemize}
\end{exercise}
\begin{proof}
Part (a) and (b) are clear. Now let $r\geq 2$. The set $\mathrm{Sing}(Q)$ is then the common zero locus of the partial derivatives of $f$, each of which has degree $1$ since $f$ is a conic and the characteristic of $k$ is not $2$. Thus the variety defined by them is linear. Now
\[\dim(Z)=\dim(S(Z))-1=\dim(k[x_0,\dots,x_n]/(x_0,\dots,x_r))-1=n-r-1.\]
This shows $Q$ is singular is and only if $n=r$.\par
For $r<n$, define $Q'$ to be $V(f)\sub\P^r$ and embed $\P^r\sub\P^n$ as the first $r$ coordinates. Then the rest is clear since in $\P^2$ for instance the line joining $[a:b:0]$ and $[0:0:c]$ is $\{[sa:ab:tc]:s,t\in k\}$.
\end{proof}
\begin{exercise}[\textbf{Analytically Isomorphic Singularities}]
\mbox{}
\begin{itemize}
\item[(a)] If $p\in Y$ and $q\in Z$ are analytically isomorphic plane curve singularities, show that the multiplicities $m_p(Y)$ and $m_q(Z)$ are the same.
\item[(b)] Generalize the example in the text to show that if $f=f_r+f_{r+1}+\cdots\in k[[x,y]]$, and if the leading form $f_r$ of $f$ factors as $f_r=g_sh_t$ where $g_s,h_t$ are homogeneous of degrees $s$ and $t$ respectively, and have no common linear factor, then there are formal power series
\[g=g_s+g_{s+1}+\cdots,\quad h=h_t+h_{t+1}+\cdots\]
in $k[[x,y]]$ such that $f=gh$. 
\item[(c)] Let $Y$ be defined by the equation $f(x,y)=0$ in $\A^2$, and let $p=(0,0)$ be a point of multiplicity $r$ on $Y$. We say that $p$ is an \textbf{ordinary $r$-fold point} if $f_r$ is a product of $r$ \textit{distinct} linear factors. Show that any two ordinary double points are analytically isomorphic. Ditto for ordinary triple points. But show that there is a one-parameter family of mutually nonisomorphic ordinary $4$-fold points.
\item[(d)] Assume $\char(k)\neq 2$. Show that any double point of a plane curve is analytically isomorphic to the singularity at $(0,0)$ of the curve $y^2=x^r$, for a uniquely determined $r\geq 2$. If $r=2$ it is a node. If $r=3$ we call it a cusp; if $r=4$ a tacnode.
\end{itemize}
\end{exercise}
\begin{proof}
Recall that $\m^n/\m^{n+1}\cong\hat{\m}^n/\hat{\m}^{n+1}$, so the multiplicity of a local ring is invariant under completion. This proves (a). Part (b) is Hensel's lemma.\par
Let $Y$ be defined by $f(x,y)=0$ in $\A^2$. Let $p=(0,0)$ be a point of multiplicity $r$ on $Y$. Write $f=f_r+\cdots$. Let $q$ be another point of multiplicity $r$, for $r=2,3$. From Linear Algebra, if $f=(\alpha+\beta y)(\alpha'x+\beta'y)+\cdots$ centered at $p$ and $f=(\gamma x+\delta y)(\gamma' x+\delta' y)+\cdots$ centered at $q$, then $\alpha+\beta y$, $\alpha'x+\beta'y$, $\gamma x+\delta y$, and $\gamma' x+\delta' y$ are all lines in $\P^1$, and in $\P^1$ (or $\A^2$), any $2$ or $3$ pairs of lines can be moved to each other by a linear transformation. However, for $4$ or more lines, this can not be done in $\P^1$ or $\A^2$. Therefore the one parameter family is the fourth line that cannot be mapped via a linear transformation after equating the other three lines.
\end{proof}
\section{Nonsingular curves}
\begin{exercise}\label{nonsingular rational curve not P^1 prop}
Recall that a curve is \textbf{rational} if it is birationally equivalent to $\P^1$. Let $Y$ be a nonsingular rational curve which is not isomorphic to $\P^1$.
\begin{itemize}
\item[(a)] Show that $Y$ is isomorphic to an open subset of $\A^1$.
\item[(b)] Show that $Y$ is affine.
\item[(c)] Show that $k[Y]$ is a unique factorization domain.
\end{itemize}
\end{exercise}
\begin{proof}
Let $Y$ be a nonsingular rational curve which is not isomorphic to $\P^1$. We know $Y$ is isomorphic to an abstract nonsingular curve. Therefore $Y$ is a subset of the complete abstract nonsingular curve $Z$ of its function field. But $Z$ is birational to $\P^1$, so in fact $Z\cong\P^1$, so $Y\sub\P^1$. Since $Y$ is not complete, it must be inside some $\A^1$. Since $Y$ is affine, then $k[Y]$ is isomomorphic to $k[x,(x-a_1)^{-1},\dots,(x-a_n)^{-1}]$. This is a UFD.
\end{proof}
\begin{exercise}[\textbf{An Elliptic Curve}]
Let $Y$ be the curve $y^2=x^3-x$ in $\A^2$, and assume that the characteristic of the base field $k$ is $\neq 2$. In this exercise we will show that $Y$ is not a rational curve, and hence $K(Y)$ is not a pure transcendental extension of $k$.
\begin{itemize}
\item[(a)] Show that $Y$ is nonsingular, and deduce that $k[Y]=k[x,y]/(y^2-x^3+x)$ is an integrally closed domain.
\item[(b)] Let $k[x]$ be the subring of $K=K(Y)$ generated by the image of $x$ in $k[Y]$. Show that $k[x]$ is a polynomial ring, and that $k[Y]$ is the integral closure of $k[x]$ in $K$.
\item[(c)] Show that there is an automorphism $\sigma:k[Y]\to k[Y]$ which sends $y$ to $-y$ and leaves $x$ fixed. For any $a\in k[Y]$, define the norm of $a$ to be $N(a)=a\cdot\sigma(a)$. Show that $N(a)\in k[x]$, $N(1)=1$, and $N(ab)=N(a)\cdot N(b)$ for any $a,b\in A$.
\item[(d)] Using the norm, show that the units in $k[Y]$ are precisely the nonzero elements of $k$. Show that $x$ and $y$ are irreducible elements of $k[Y]$. Show that $k[Y]$ is not a unique factorization domain.
\item[(e)] Prove that $Y$ is not a rational curve.
\end{itemize}
\end{exercise}
\begin{proof}
It is easy to see $f(x,y)=x+y^2-x^3$ is irreducible, and $Y$ is nonsingular since $f_x=1$. It follows that $k[Y]$ is integrally closed since its localizations are DVR, hence integrally closed. Now consider $k[x]$. Since $x\notin k$, it is transcendental over $k$, so $k[x]$ is a polynomial ring. Since the element $y\in k[Y]$ is the root of the polynomial $T^2-x^3+x$, we see $k[Y]$ is integral over $k[x]$, whence the integral closure of $k[x]$ in $K$.\par
The element $y$ can be viewed as $\sqrt{x-x^3}$, so we have an automorphim $\sigma:K\to K$ which sends $y$ to $-y$, and it restricts to $k[Y]$. Since $K/k[x]$ has degree $2$, $\{1,\sigma\}$ is the only automorphims of $K$ over $k[x]$, and we see $N_{K/k[x]}(a)=a\cdot\sigma(a)$ for $a\in K$. Using the norm, we see the unit of $k[Y]$ are exactly $k$, and $x$, $y$ are irreducible since $N(x)=x^2$ and $N(y)=-y^2=x-x^3$. Also, Then $y^2=x(x-1)(x+1)$ shows $k[Y]$ is not a UFD. By Exercise~\ref{nonsingular rational curve not P^1 prop}, this shows $Y$ is not a rational curve.
\end{proof}
\begin{exercise}
Let $Y$ be a nonsingular projective curve. Show that every nonconstant rational function $f$ on $Y$ defines a surjective morphism $\varphi:Y\to\P^1$, and that for every $p\in\P^1$, $\varphi^{-1}(p)$ is a finite set of points.
\end{exercise}
\begin{proof}
Consider the map of function fields $K(\P^1)\cong k(t)\to K(Y)$ by $t\mapsto f$. This is a $k$-homomorphism between two function fields of dimension one, so it gives us a dominant (in particular, nonconstant) morphism $\varphi:Y\to\P^1$ which is given by $y\mapsto[1:f(y)]$ where $f(y)\neq\infty$. If $\varphi(Y)$ misses a point, then by taking the copy of $\A^1$ which is the complement of that point, we can find a nonconstant regular function on $\A^1$ which pulls back to a nonconstant regular function on $Y$. This is impossible since $K(Y)\cong S(Y)_{((0))}$, so $\varphi(Y)=\P^1$ and $\varphi$ is surjective.\par
Note that since any point $p$ in $\P^1$ is closed, $\varphi^{-1}(p)$ is a closed set since morphisms are continuous. On the other hand, the fiber over any point must be a proper subset of $Y$, since $\varphi$ is nonconstant. Since all proper closed subsets of a curve are finite, we are done.
\end{proof}
\begin{exercise}
Let $X$ be a nonsingular projective curve. Suppose that $X$ is a (locally closed) subvariety of a variety $Y$. Show that $X$ is in fact a closed subset of $Y$.
\end{exercise}
\begin{exercise}[\textbf{Automorphisms of $\P^1$.}]
Think of $\P^1$ as $\A^1\cup\{\infty\}$. Then we define a fractional linear transformation of $\P^1$ by sending $x\mapsto(ax+b)/(cx+d)$, for $a,b,c,d\in k$, $ad-bc\neq 0$.
\begin{itemize}
\item[(a)] Show that a fractional linear transformation induces an automorphism of $\P^1$ (i.e., an isomorphism of $\P^1$ with itself). We denote the group of all these fractional linear transformations by $\PGL(1)$.
\item[(b)] Show that $\Aut(\P^1)\cong\Aut(k(x))$.
\item[(c)] Now show that every automorphism of $k(x)$ is a fractional linear transformation, and deduce that $\PGL(1)\to\Aut(\P^1)$ is an isomorphism.  
\end{itemize}
\end{exercise}
\begin{proof}
We only show that $\Aut(\P^1)\cong\Aut(k(x))$. Clearly an automorphim induced an automorphim on $k(x)$. Conversely, an automorphim on $k(x)$ induces a birational map of $\P^1$ to $\P^1$. Since $\P^1$ is a nonsingular projective curve, this induces a dominant isomorphism on $\P^1$.
\end{proof}
\begin{exercise}
Let $P=\{p_1,\dots,p_r\}$ and $Q=\{q_1,\dots,q_s\}$ be distinct points of $\A^1$. If $\A^1\setminus P$ is isomorphic to $\A^1\setminus Q$, show that $r=s$. Is the converse true?
\end{exercise}
\begin{proof}
Since $P$ and $Q$ are closed sets, an isomorphim from $\A^1\setminus P$ to isomorphic to $\A^1\setminus Q$ corresponds to a birational map from $\P^1$ to $\P^1$, whence an isomomorphism of $\P^1$. Then we must have $r=s$ since $P$ is mapped bijectively to $Q$. The converse is not true for $r>3$ since any set of at most $3$ points in $\P^1$ can be mapped to any other set of the same size under $\Aut(\P^1)$. Any isomorphism between $\P^1$ and $\P^1$ fixes at most $2$ points, so if $r>3$, the map must be the identity isomorphism. If $P$ and $Q$ only have $3$ elements in common, with other elements different, then $\A^1\setminus P\ncong\A^1\setminus Q$.
\end{proof}
\section{Intersections in Projective spaces}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Find the degree of the $d$-uple embedding of $\P^n$ in $\P^N$.
\item[(b)] Find the degree of the Segre embedding of $\P^r\times\P^s$ in $\P^N$.
\end{itemize}
\end{exercise}
\begin{proof}
The homogeneous coordinate ring of the image of the $d$-uple embedding is isomomorphic as a graded algebra with the subalgebra of $k[x_0,\dots,x_n]$ generated by monomials of degree $d$. Thus
\[P_Y(\ell)=\binom{n+d\ell}{n}\]
so the degree is $d^n$. Similarly, the homogeneous coordinate ring of the image of the $d$-uple embedding is isomomorphic as a graded algebra with the subalgebra of $k[x_0,\dots,x_r,y_0,\dots,y_s]$ generated by $\{x_iy_j\}$. Thus
\[P_Z(\ell)=\binom{\ell+r}{r}\binom{\ell+s}{s}\]
whence the degree is $(r+s)!/r!s!=\binom{r+s}{r}$.
\end{proof}
\begin{exercise}
Let $Y$ be a variety of dimension $r$ in $\P^n$, with Hilbert polynomial $P_Y$. We define the arithmetic genus of $Y$ to be $p_a(Y)=(-1)^r(P_Y(0)-1)$. This is an important invariant which is independent of the projective embedding of $Y$.
\begin{itemize}
\item[(a)] Show that $p_a(\P^n)=0$. 
\item[(b)] If $Y$ is a plane curve of degree $d$, show that $p_a(Y)=(d-1)(d-2)/2$.
\item[(c)] More generally, if $H$ is a hypersurface of degree $d$ in $\P^n$, then $p_a(H)=\binom{d-1}{n}$.
\item[(d)] If $Y$ is a complete intersection of surfaces of degrees $a,b$ in $\P^3$, then $p_a(Y)=ab(a+b-4)/2-1$.
\item[(e)] Let $Y^r\sub\P^n$, $Z^s\sub\P^m$ be projective varieties, and embed $Y\times Z$ to $\P^N$ by the Segre embedding. Show that
\[p_a(Y\times Z)=p_a(Y)p_b(Z)+(-1)^sp_a(Y)+(-1)^rp_a(Z).\] 
\end{itemize}
\end{exercise}
\begin{proof}
The Hilbert polynomial of $\P^n$ is $\chi(\mathscr{O}_{\P^n}(k))=\binom{n+k}{n}$, so $p_a(\P^n)=0$. Now let $H$ be a hypersurface of degree $d$ in $\P^n$, then
\[P_Y(\ell)=\binom{\ell+n}{n}-\binom{\ell-d+n}{n}=\frac{(\ell+n)(\ell+n-1)\cdots(\ell+1)-(\ell-d+n)\cdots(\ell-d+1)}{n!}.\]
Therefore
\begin{align*}
P_Y(0)-1&=\frac{n!-(-d+n)(-d+n-1)\cdots(-d+1)}{n!}-1\\
&=(-1)^{n-1}\frac{(d-1)(d-2)\cdots(d-(n-1))}{n!}\\
&=(-1)^{n-1}\binom{d-1}{n}.
\end{align*}
Thus $p_a(H)=\binom{d-1}{n}$.\par
Let $Y=X_1\cap X_2$, with $X_i=V(f_i)$. Then $X_1\cup X_2=V(f_1f_2)$, so $\deg(X_1\cup X_2)=a+b$. From the exact sequence
\[\begin{tikzcd}
0\ar[r]&S/(f_1f_2)\ar[r]&S/(f_1)\oplus S/(f_2)\ar[r]& S/(f_1,f_2)\ar[r]&0
\end{tikzcd}\]
We get $P_{Y}=P_{X_1}+P_{X_2}-P_{X_1\cup X_2}$. Then since $\dim(Y)=1$, we have
\begin{align*}
p_a(Y)=-\Big[\binom{a-1}{3}+\binom{b-1}{3}-\binom{a+b-1}{3}\Big]=\frac{ab(a+b)-4ab}{2}+1=\frac{ab(a+b-4)}{2}+1.
\end{align*}
Finally, consider (e). Then the coordinate ring of $X\times Y$ is the tensor product of that of $X$ and $Y$, so $P_{X\times Y}=P_XP_Y$ and
\begin{align*}
p_a(X\times Y)&=(-1)^{r+s}[P_X(0)P_Y(0)-1]\\
&=(-1)^{r+s}[(P_X(0)-1)(P_Y(0)-1)+(P_X(0)-1)+(P_Y(0)-1)]\\
&=(-1)^{r+s}((-1)^{r+s}p_a(X)p_a(Y)+(-1)^{r}p_a(X)+(-1)^sp_a(Y))\\
&=p_a(X)p_a(Y)+(-1)^sp_a(X)+(-1)^rp_a(Y).
\end{align*}
This completes the proof. 
\end{proof}
\begin{exercise}[\textbf{The Dual Curve}]
Let $Y\sub\P^2$ be a curve. We regard the set of lines in $\P^2$ as another projective space, $(\P^2)^*$, by taking $[a_0:a_1:a_2]$ as homogeneous coordinates of the line $L:a_0x_0+a_1x_1+a_2x_2=0$. For each nonsingular point $p\in Y$, show that there is a unique line $T_p(Y)$ whose intersection multiplicity with $Y$ at $p$ is $>1$. This is the \textbf{tangent line} to $Y$ at $p$. Show that the mapping $p\mapsto T_p(Y)$ defines a morphism of $\mathrm{Reg}(Y)$ (the set of nonsingular points of $Y$) into $(\P^2)^*$. The closure of the image of this morphism is called the \textbf{dual curve} $Y^*\sub(\P^2)^*$ of $Y$.
\end{exercise}
\begin{proof}
For simplicity let $Y$ be defined by $f(x,y)=0$ on the affine piece $z\neq 0 $. Then if $p\in Y$ is regular, the partials $f_x(p)$ and $f_y(p)$ are not all zero, so we get a linear form $f_x(p)x+f_y(p)y$, which gives a line in $\A^2\sub\P^2$. This corresponds the point $[f_x(p):f_y(p):1]$ in the dual space $(\P^2)^*$. Thus we get the first claim. The maps $f_x$ and $f_y$ are clearly morphisms.
\end{proof}
\begin{exercise}
Given a curve $Y$ of degree $d$ in $\P^2$, show that there is a nonempty open subset $U$ of $(\P^2)^*$ in its Zariski topology such that for each $L\in U$, $L$ meets $Y$ in exactly $d$ points. This result shows that we could have defined the degree of $Y$ to be the number $d$ such that almost all lines in $\P^2$ meet $Y$ in $d$ points, where "almost all" refers to a nonempty open set of the set of lines, when this set is identified with the dual projective space $(\P^2)^*$.
\end{exercise}
\begin{proof}
If $L$ is the tangent line to $Y$ of some point $p\in\mathrm{Reg}(Y)\cap L$ or $L$ pass a singular point of $L$, then $L$ meets $Y$ in less than $d$ points since then $i(Y,L;p)>1$ and we have B\'ezout's theorem. Such lines consits the dual curve $Y^*$ in $(\P^2)^*$ union the image of a finite set in $(\P^2)^*$, so the open subset $(\P^2)^*\setminus Y^*$ satisfies the requirement.
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Show that an irreducible curve $Y$ of degree $d>1$ in $\P^2$ cannot have a point of multiplicity $\geq d$.
\item[(b)] If $Y$ is an irreducible curve of degree $d>1$ having a point of multiplicity $d-1$, then $Y$ is a rational curve. 
\end{itemize}
\end{exercise}
\begin{proof}
If $Y$ is locally defined by an irreducible polynomial $f(x,y)\in k[x,y]$ near a point $p$, then $f$ has degree $d$, and the multiplicity is defined by
\[m_p(Y)=\max\{t\in\N:\text{$\partial^\alpha f/\partial x^\alpha(p)=0$ for $|\alpha|<t$}\}=\max\{t\in\N:f\in\m_p^t\}.\]
Since $f$ is irreducible, $f$ is not a homogeneous polynomial of degree $d$, whence $f\notin\m^d$. This shows $m_p(Y)<d$.\par
If $Y$ has a point of multiplicity $d-1$, then $Y$ is defined by $f(x,y)+g(x,y)$, where $\deg(f)=d-1$ and $\deg(g)=d$. Let $t=y/x$, then on the curve we have $y=-f(t,1)/g(t,1)$ and $x=yt$. This is just the projection from a point and gives a birational map to $\A^1$.
\end{proof}
\begin{exercise}[\textbf{Linear Varieties}]
Show that an algebraic set $Y$ of pure dimension $r$ (i.e., every irreducible component of $Y$ has dimension $r$) has degree $1$ if and only if $Y$ is a linear variety.
\end{exercise}
\begin{proof}
Let $\dim(Y)=1$. Then since $\deg(Y)=1$ we see $Y$ is irreducible. Pick any two points on $Y$ and pass a hyperplane through them. Then by B\'ezout's theorem, we must have $Y\sub H$. Since this is true for any hyperplane through these points, $Y$ is the line through these two points. Now suppose the assumption is true for dimension $r$ varieties and let $\dim(Y)=r+1$. Let $p,q\in Y$ and $H$ a hyperplane through $p$ and $q$ not containing $Y$. Then by B\'ezout's again, $Y\cap H$ has degree $1$, so is linear, so $Y$ contains the line through $p$ and $q$. So $Y$ is linear.
\end{proof}
\chapter{Schemes}
\section{Sheaves}
\begin{exercise}
Let $A$ be an abelian group, and define the constant presheaf associated to $A$ on the topological space $X$ to be the presheaf $U\mapsto A$ for all $U\neq\emp$, with restriction maps the identity. Show that the constant sheaf defined in the text is the sheaf associated to this presheaf.
\end{exercise}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] For any morphism of sheaves $\varphi:\mathscr{F}\to\mathscr{G}$, show that for each point $p\in X$, $(\ker\varphi)_p=\ker(\varphi_p)$ and $(\im\varphi)_p=\im(\varphi_p)$.
\item[(b)] Show that $\varphi$ is injective (respectively, surjective) if and only if the induced map on the stalks $\varphi_p$ is injective (respectively, surjective) for all $p$.
\item[(c)] Show that a sequence of sheaves and morphisms is exact if and only if for each $p\in X$ the corresponding sequence of stalks is exact as a sequence of abelian groups. 
\end{itemize}
\end{exercise}
\begin{proof}
Let $\varphi:\mathscr{F}\to\mathscr{G}$ be a morphism of sheaves. We have the commutative diagram:
\[\begin{tikzcd}
\mathscr{F}(U)\ar[d]\ar[r,"\varphi_U"]&\mathscr{G}(U)\ar[d]\\
\mathscr{F}_x\ar[r,"\varphi_x"]&\mathscr{G}_x
\end{tikzcd}\]
Let $s\in\ker\varphi_U$, then its image $\bar{s}$ is mapped to zero by $\varphi_x$, so $\bar{s}\in\ker\varphi_x$. Conversely, if $\bar{s}\in\ker\varphi_x$ and $\bar{s}=(U,s)$ where $s\in\mathscr{F}(U)$, then the image of $t=\varphi(s)\in\mathscr{G}(U)$ is zero in $\mathscr{G}_x$. Therefore in some neighborhood, say $V\sub U$, $t|_V=0$. We then have the commutative diagram
\[\begin{tikzcd}
\mathscr{F}(V)\ar[d]\ar[r,"\varphi_V"]&\mathscr{G}(V)\ar[d]\\
\mathscr{F}_x\ar[r,"\varphi_x"]&\mathscr{G}_x
\end{tikzcd}\]
where now $\varphi_V(s|_V)=0$. This shows $\bar{s}\in(\ker\varphi)_x$. The case for image is similar.
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $\varphi:\mathscr{F}\to\mathscr{G}$ be a morphism of sheaves on $X$. Show that $\varphi$ is surjective if and only if the following condition holds: for every open set $U\sub X$, and for every $s\in\mathscr{F}(U)$, there is a covering $\{U_i\}$ of $U$ and there are elements $t_i\in\mathscr{F}(U_i)$ such that $\varphi(t_i)=s|_{U_i}$ for all $i$.
\item[(b)] Give an example of a surjective morphism of sheaves $\varphi:\mathscr{F}\to\mathscr{G}$ and an open set $U$ such that $\varphi_U:\mathscr{F}(U)\to\mathscr{G}(U)$ is not surjective.
\end{itemize}
\end{exercise}
\begin{proof}
The first is clear by the definition of stalks. For (b), the principal example here is $\varphi:\mathscr{O}_\C\to\mathscr{O}_{\C}^*$ defined by $f\mapsto e^{2\pi if}$. The stalks are surjective because since by choosing a small enough neighborhood, every nonzero-holomorphic function has a logarithm. So $\varphi$ is surjective. But for $U=\C^*$, $\varphi_{\C^*}$ is not surjective since $z$ is a non-zero holomorphic function on $\C^*$ but does not have a global logarithm.
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $\varphi:\mathscr{F}\to\mathscr{G}$ be a morphism of presheaves such that $\varphi_U$ is injective for each $U$. Show that the induced map $\varphi^{\hash}:\mathscr{F}^{\hash}\to\mathscr{G}^{\hash}$ of associated sheaves is injective.
\item[(b)] Use part (a) to show that if $\varphi:\mathscr{F}\to\mathscr{G}$ is a morphism of sheaves, then $\im\varphi$ can be naturally identified with a subsheaf of $\mathscr{G}$, as mentioned in the text.
\end{itemize}
\end{exercise}
\begin{proof}
Since sheafification does not change stalk, we see $\varphi^{\hash}$ is injective on stalks, hence injective. Now let $\varphi:\mathscr{F}\to\mathscr{G}$ be a morphism of sheaves. Then we have $\mathrm{im}_p\varphi$, which is defined by
\[(\mathrm{im}_p\varphi)(U)=\im\varphi_U.\]
The sheafification of $\mathrm{im}_p\varphi$ is $\im\varphi$. Consider the canonical inclusion $\psi:\mathrm{im}_p\varphi\to\mathscr{G}$. Since this is injective and $\mathscr{G}$ is a sheaf, this gives an injective morphism $\im\varphi\to\mathscr{G}$, so $\im\varphi$ is a subsheaf of $\mathscr{G}$.
\end{proof}
\begin{exercise}
Show that a morphism of sheaves is an isomorphism if and only if it is both injective and surjective.
\end{exercise}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $\mathscr{F}'$ be a subsheaf of a sheaf $\mathscr{F}$. Show that the natural map of $\mathscr{F}$ to the quotient sheaf $\mathscr{F}/\mathscr{F}'$ is surjective, and has kernel $\mathscr{F}'$. Thus there is an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}'\ar[r]&\mathscr{F}\ar[r]&\mathscr{F}/\mathscr{F}'\ar[r]&0
\end{tikzcd}\] 
\item[(b)] Conversely, if $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$ is an exact sequence, show that $\mathscr{F}'$ is isomorphic to a subsheaf of $\mathscr{F}$, and that $\mathscr{F}''$ is isomorphic to the quotient of $\mathscr{F}$ by this subsheaf.
\end{itemize}
\end{exercise}
\begin{exercise}
Let $\varphi:\mathscr{F}\to\mathscr{G}$ be a morphism of sheaves.
\begin{itemize}
\item[(a)] Show that $\im\varphi\cong\mathscr{F}/\ker\varphi$.
\item[(b)] Show that $\coker\varphi\cong\mathscr{G}/\im\varphi$.
\end{itemize}
\end{exercise}
\begin{exercise}
For any open subset $U\sub X$, show that the functor $\Gamma(U,\cdot)$ from sheaves on $X$ to abelian groups is a left exact functor. The functor $\Gamma(U,\cdot)$ need not be exact.
\end{exercise}
\begin{proof}
Let
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}\ar[r,"\varphi"]&\mathscr{G}\ar[r,"\psi"]&\mathscr{H}\ar[r]&0
\end{tikzcd}\]
be a short exact sequence of sheaves. Then for any open $U\sub X$, since $\varphi$ is injective, $\ker\varphi=0$, so in particular $ker\varphi_U=0$ and the sequence
\[\begin{tikzcd}
0\ar[r]&\Gamma(U,\mathscr{F})\ar[r,"\varphi_U"]&\Gamma(U,\mathscr{G})\ar[r,"\psi_U"]&\Gamma(U,\mathscr{H})\ar[r]&0
\end{tikzcd}\]
is exact.
\end{proof}
\begin{exercise}[\textbf{Flasque Sheaves}]
A sheaf $\mathscr{F}$ on a topological space $X$ is flasque if for every inclusion $V\sub U$ of open sets, the restriction map $\mathscr{F}(U)\to\mathscr{F}(V)$ is surjective.
\begin{itemize}
\item[(a)] Show that a constant sheaf on an irreducible topological space is flasque.
\item[(b)] If $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ is an exact sequence of sheaves, and if $\mathscr{F}$ is flasque, then for any open set $U$, the sequence $0\to\mathscr{F}(U)\to\mathscr{G}(U)\to\mathscr{H}(U)\to 0$ of abelian groups is also exact.
\item[(c)] If $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ is an exact sequence of sheaves, and if $\mathscr{F}$ and $\mathscr{G}$ are flasque, then $\mathscr{H}$ is flasque.
\item[(d)] If $f:X\to Y$ is a continuous map, and if $\mathscr{F}$ is a flasque sheaf on $X$, then $f_*\mathscr{F}$ is a flasque sheaf on $Y$.
\item[(e)] Let $\mathscr{F}$ be any sheaf on $X$. We define a new sheaf $\mathscr{G}$, called the \textbf{sheaf of discontinuous sections} of $\mathscr{F}$ as follows. For each open set $U\sub X$, $\mathscr{G}(U)$ is the set of maps $s:U\to\bigcup_{p\in U}\mathscr{F}_p$ such that $s_p\in\mathscr{F}_p$ for each $p$. Show that $\mathscr{G}$ is a flasque sheaf, and that there is a natural injective morphism of $\mathscr{F}$ to $\mathscr{G}$.
\end{itemize}
\end{exercise}
\begin{proof}
A constant sheaf over an irreducible topological space consists constant functions, so is flasque. We also note that assertion (d) is immediate.\par
Now let $0\to\mathscr{F}_1\to\mathscr{F}_2\to\mathscr{F}_3\to 0$ be an exact sequence of sheaves, where $\mathscr{F}_1$ is flasque. Given any open set $U$, we must prove that
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}_1(U)\ar[r,"\varphi"]&\mathscr{F}_2(U)\ar[r,"\psi"]&\mathscr{F}_3(U)\ar[r]&0
\end{tikzcd}\]
is exact. The sole problem is to prove that $\mathscr{F}_2(U)\to\mathscr{F}_3(U)$ is surjective. By restricting we only need to prove the case for $X$. Let $t$ be a global section of $\mathscr{F}_3$, then by the surjectivity of $\psi$, locally $t$ may be lifted to sections of $\mathscr{F}$. Let $\mathcal{T}$ be the family of all pairs $(U,\sigma)$ where $U$ is an open in $X$, and $\sigma$ is a section of $\mathscr{F}$ over $U$ whose image in $\mathscr{F}_3(U)$ equal $t|_{U}$. Partially order $\mathcal{T}$ in the obvious way and observe that $\mathcal{T}$ is inductive. Zorn's lemma provides us with a maximal lifting of $t$ to a section $\sigma\in\mathscr{F}(U_0)$.\par
Were $U_0$ not $X$, there would exist $x\in X-U_0$, a neighborhood $V$ of $x$, and a section $\tau$ of $\mathscr{F}$ over $V$ which is a local lifting of $t|_V$. The sections $\sigma|_{V\cap U_0}$ and $\tau|_{V\cap U_0}$ have the same image in $\mathscr{F}_3(U_0\cap V)$ under the map $\psi$, so their difference maps to $0$. Since $\im\varphi=\ker\psi$, there is a section $s$ of $\mathscr{F}_1(U_0\cap V)$ such that
\[\sigma|_{U_0\cap V}=\tau|_{V\cap U_0}+\varphi(s).\]
Since $\mathscr{F}_1$ is flasque, the section $s$ is the restriction of a section $s_0\in\mathscr{F}_1(V)$. Upon replacing $\tau$ by $\tau+\varphi(t_0)$ (which does not affect the image in $\mathscr{F}_3(V)$), we may assume that $\sigma|_{V\cap U_0}=\tau|_{V\cap U_0}$; that is, $\tau$ and $\sigma$ agree on the overlap. Then we may extend $\sigma$ to $U_0\cup V$, contradicting the maximality of $(U_0,\sigma)$; hence, $U_0=X$.\par
Let $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ be an exact sequence of sheaves, and assume that $\mathscr{F}$ and $\mathscr{G}$ are flasque. Then for $V\sub U$, there is a commutative diagram
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}(U)\ar[r]\ar[d]&\mathscr{G}(U)\ar[r]\ar[d]&\mathscr{H}(U)\ar[r]\ar[d]&0\\
0\ar[r]&\mathscr{F}(U)\ar[r]&\mathscr{G}(U)\ar[r]&\mathscr{H}(U)\ar[r]&0
\end{tikzcd}\]
\end{proof}
\begin{exercise}[\textbf{Some Examples of Sheaves on Varieties}]
Let $X$ be a variety over an algebraically closed field $k$. Let $\mathscr{O}_X$ be the sheaf of regular functions on $X$.
\begin{itemize}
\item[(a)] Let $Y$ be a closed subset of $X$. For each open set $U\sub X$, let $\mathscr{I}_Y(U)$ be the ideal in the ring $\mathscr{O}_X(U)$ consisting of those regular functions which vanish at all points of $Y\cap U$. Show that the presheaf $U\mapsto\mathscr{I}_Y(U)$ is a sheaf. It is called the \textbf{sheaf of ideals} $\mathscr{I}_Y$ of $Y$, and it is a subsheaf of the sheaf of rings $\mathscr{O}_X$.
\item[(b)] If $Y$ is a closed subvariety, then the quotient sheaf $\mathscr{O}_X/\mathscr{I}_Y$ is isomorphic to $i_*(\mathscr{O}_Y)$, where $i:Y\to X$ is the inclusion, and $\mathscr{O}_Y$ is the sheaf of regular functions on $Y$.
\item[(c)] Now let $X=\P^1$, and let $Y$ be the union of two distinct points $p,q\in X$. Then there is an exact sequence of sheaves on $X$, where $\mathscr{F}=i_*\mathscr{O}_{X,p}\oplus i_*\mathscr{O}_{X,q}$,
\[\begin{tikzcd}
0\ar[r]&\mathscr{I}_Y\ar[r]&\mathscr{O}_X\ar[r]&\mathscr{F}\ar[r]&0
\end{tikzcd}\] 
Show however that the induced map on global sections $\Gamma(X,\mathscr{O}_X)\to\Gamma(X,\mathscr{F})$ is not surjective. This shows that the global section functor $\Gamma(X,\cdot)$ is not exact.
\item[(d)] Again let $X=\P^1$, and let $\mathscr{O}_X$ be the sheaf of regular functions. Let $\mathscr{K}$ be the constant sheaf on $X$ associated to the function field $K$ of $X$. Show that there is a natural injection $\mathscr{O}_X\to\mathscr{K}$. Show that the quotient sheaf $\mathscr{K}/\mathscr{O}_X$ is isomorphic to the direct sum of sheaves $\bigoplus_{p\in X}i_p(I_p)$, where $I_p$ is the group $K/\mathscr{O}_{X,p}$, and $i_p(I_p)$ denotes the skyscraper sheaf given by $I_p$ at the point $p$.
\item[(e)] Finally show that in the case of (d) the sequence
\[\begin{tikzcd}
0\ar[r]&\Gamma(X,\mathscr{O}_X)\ar[r]&\Gamma(X,\mathscr{K})\ar[r]&\Gamma(X,\mathscr{K}/\mathscr{O}_X)\ar[r]&0
\end{tikzcd}\]
is exact.
\end{itemize}
\end{exercise}
\begin{proof}
Let $Y\sub X$. Then for each $U\sub X$ open, the set $\mathscr{I}_Y(U)$ is an ideal of $\mathscr{O}_X(U)$, so $\mathscr{I}_Y$ is a presheaf. Since $\mathscr{I}_Y$ is a subpresheaf of a sheaf of functions and vanishing on $Y$ is a local property, it is not hard to see it is a sheaf.\par
The sheaf $i_*(\mathscr{O}_Y)$ is given by $i_*(\mathscr{O}_Y)(U)=\mathscr{O}_Y(U\cap Y)$, and its stalk is given by $i_*(\mathscr{O}_Y)_x=\mathscr{O}_{Y,x}$ if $y\in Y$ and $0$ if $y\notin Y$. With this, it is easy to see the following sequence is exact:
\[\begin{tikzcd}
0\ar[r]&\mathscr{I}_Y\ar[r]&\mathscr{O}_X\ar[r]&i_*(\mathscr{O}_Y)\ar[r]&0
\end{tikzcd}\]
so the claim in (b) follows. Part (c) follows from this, since the sheaf of regular functions on $\{p,q\}$ are exactly $i_*\mathscr{O}_{X,p}\oplus i_*\mathscr{O}_{X,q}$. Moreover, the induced map on global sections $\Gamma(X,\mathscr{O}_X)\to\Gamma(X,\mathscr{F})$ is not surjective, since regular functions on $\P^1$ are constants.\par
There is a natural injection from $\mathscr{O}_X(U)$ to $\mathscr{K}(U)$ given by $f:U\to k$ maps to $(U,f)$. This map is injective since it is injective on stalks. Moreover, on the level of stalks, $\mathscr{O}_{X,p}$ is just mapped into $K$ for each $p$. Thus we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{O}_{X,p}\ar[r]&K\ar[r]&K/\mathscr{O}_{X,p}\ar[r]&0
\end{tikzcd}\]
Thus we get the exact sequence of sheaves, as in (d). Finally consider the sequence on global sections. Note that $\Gamma(X,\mathscr{K}/\mathscr{O}_X)=\bigoplus_{p\in X}K/\mathscr{O}_{X,p}$, so the sequence is
\[\begin{tikzcd}
0\ar[r]&k\ar[r]&k(x)\ar[r]&k(x)/k[x^{-1}]_{(x^{-1})}\oplus\bigoplus_{\alpha\in k}k(x)/k[x]_{(x-\alpha)}\ar[r]&0
\end{tikzcd}\]
Fix $p\in X$ and let $\bar{f}\in K/\mathscr{O}_{X,p}$ be a nonzero entry. Using a partial fraction decomposition we can write
\[f\equiv\sum_{i=1}^{n}\frac{a_i}{\pi^{n_i}}\mod\mathscr{O}_{X,p}.\]
with $a_i\in k[x]$, $n_i>0$ and $\pi$ is a uniformizor of $\mathscr{O}_{X,p}$. Now let
\[g=\sum_{i=1}^{n}\frac{a_i}{(x-\alpha)^{n_i}}\]
where $\alpha$ is the point corresponding to $p$. Then $g$ has no poles for $q\neq p$, so $g\in k(x)$ maps to the element that has $\bar{f}$ in the $p$-component, and zeroes elsewhere. Since these elements generate $\bigoplus_{p\in X}K/\mathscr{O}_{X,p}$, we get the claim.
\end{proof}
\section{Scheme}
\begin{exercise}
Let $A$ be a ring, let $X=\Spec(A)$, let $f\in A$ and let $D(f)\sub X$ be the open complement of $V(f)$. Show that the locally ringed space $(D(f),\mathscr{O}_X|_{D(f)})$ is isomorphic to $\Spec(A_f)$.
\end{exercise}
\begin{proof}
By the properties of localization, we have a homeomorphism $\varphi:D(f)\to\Spec(A_f)$. Moreover, $\Gamma(\mathscr{O}_X|_{D(f)})=A_f$ and $\mathscr{O}_X|_{D(f)}\cong\mathscr{O}_{A_f}$ since they are isomorphic on principal opens.
\end{proof}
\begin{exercise}
Let $(X,\mathscr{O}_X)$ be a scheme, and let $U\sub X$ be any open subset. Show that $(U,\mathscr{O}_X|_U)$ is a scheme. We call this the induced scheme structure on the open set $U$, and we refer to $(U,\mathscr{O}_X|_{U})$ as an \textbf{open subscheme} of $X$.
\end{exercise}
\begin{exercise}[\textbf{Reduced schemes}]
A scheme $(X,\mathscr{O}_X)$ is reduced if for every open set $U\sub X$, the ring $\mathscr{O}_X(U)$ has no nilpotent elements.
\begin{itemize}
\item[(a)] Show that $(X,\mathscr{O}_X)$ is reduced if and only if for every $p\in X$, the local ring $\mathscr{O}_{X,p}$ has no nilpotent elements.
\item[(b)] Let $(X,\mathscr{O}_X)$ be a scheme. Let $(\mathscr{O}_X)_{\text{red}}$ be the sheaf associated to the presheaf $U\mapsto(\mathscr{O}_X(U))_{\text{red}}$, where for any ring $A$, we denote by $A_{\text{red}}$ the quotient of $A$ by its ideal of nilpotent elements. Show that $(X,(\mathscr{O}_{X})_{\text{red}})$ is a scheme. We call it the reduced scheme associated to $X$, and denote it by $X_{\text{red}}$. Show that there is a morphism of schemes $X_{\text{red}}\to X$, which is a homeomorphism on the underlying topological spaces.
\item[(c)] Let $f:X\to Y$ be a morphism of schemes, and assume that $X$ is reduced. Show that there is a unique morphism $g:X\to Y_{\text{red}}$ such that $f$ is obtained by composing $g$ with the natural map $Y_{\text{red}}\to Y$. 
\end{itemize}
\end{exercise}
\begin{proof}
First assume that $X$ is reduced. Let $U=\Spec(A)$ be a affine open in $X$ and $x\in U$. Then $U$ is reduced by assumption, and in particular $A$ is a reduced ring. Then for each $\p\in\Spec(A)$, the local ring $\mathscr{O}_{U,\p}$ is just $A_\p$. By the properties of localization, the ring $A_\p$ is then reduced.\par
Conversely, assume that every local ring $\mathscr{O}_{X,p}$ is reduced. By the definition of $\mathscr{O}_X(U)$ as elements of $\prod_{x\in U}\mathscr{O}_{X,x}$, we then see $\mathscr{O}_X(U)$ is reduced. Thus $X$ is reduced.\par
Let $X$ be a scheme. Then for each open subset $U$ we have a morphism $\mathscr{O}_X\to(\mathscr{O}_X)_{\text{red}}$, which gives a morphism of locally ringed spaces $X_{\red}\to X$. To see $X_{\red}$ is a scheme, we just note that, if $U=\Spec(A)$ is an affine open in $X$, then $(U,(\mathscr{O}_U)_{\red})$ is isomorphic to $\Spec(A_{\red})$: for example, for $f\in A\setminus\n(A)$ we have
\[(A_f)_{\red}=A_f/\n(A_f)=A_f/\n(A)_f=(A/\n(A))_f=(A_{\red})_f.\]
Note that $\Spec(A_{\red})$ and $\Spec(A)$ have the same underlying set, so $X_{\red}$ and $X$ have the same underlying space.\par
Now consider a morphism of schemes $f:X\to Y$, with $X$ reduced. Then for each $V\sub Y$ open we have a homomorphism $f^{\hash}_V:\mathscr{O}_Y(V)\to\mathscr{O}_X(f^{-1}(V))$, which induces a homomorphism $(\mathscr{O}_Y(V))_{\red}\to\mathscr{O}_X(f^{-1}(V))$ since the later is reduced. Then we get a morphism $(\mathscr{O}_Y)_{\red}\to f_*\mathscr{O}_X$, which gives a morphism $X\to Y_{\red}$. It is clear that $f$ factors through this morphism. 
\end{proof}
\begin{exercise}
Let $A$ be a ring and let $(X,\mathscr{O}_X)$ be a scheme. Given a morphism $f:X\to\Spec(A)$, we have an associated map on sheaves $f^{\hash}:\mathscr{O}_{\Spec(A)}\to f_*\mathscr{O}_X$. Taking global sections we obtain a homomorphism $A\to\Gamma(X,\mathscr{O}_X)$. Thus there is a natural map
\[\Hom_{\mathsf{Sch}}(X,\Spec(A))\to\Hom_{\mathsf{Ring}}(A,\Gamma(X,\mathscr{O}_X)).\]
Show that this map is bijective.
\end{exercise}
\begin{proof}
\begin{proposition}\label{scheme map to affine point image char}
Let $f:X\to Y$ be a morphism of locally ringed spaces and assume that $Y$ is an affine scheme. Given a point $x\in X$, consider the ring maps
\[\begin{tikzcd}
\Gamma(Y,\mathscr{O}_Y)\ar[r,"f^{\hash}"]&\Gamma(X,\mathscr{O}_X)\ar[r]&\mathscr{O}_{X,x}
\end{tikzcd}\]
Let $\p\in\Gamma(Y,\mathscr{O}_Y)$ denote the inverse image of $\m_x$ and $y\in Y$ be the corresponding point. Then $f(x)=y$.
\end{proposition}
\begin{proof}
Since $f^{\hash}$ is a morphism of sheaves, we have the following commutative diagram
\[\begin{tikzcd}
\Gamma(X,\mathscr{O}_X)\ar[r]&\mathscr{O}_{X,x}\\
\Gamma(Y,\mathscr{O}_Y)\ar[r]\ar[u,"f^{\hash}"]&\mathscr{O}_{Y,f(x)}\ar[u,,"f^{\hash}_x"]
\end{tikzcd}\]
The induced homomorphism $f^{\hash}_x$ on local rings is local, so $\m_{f(x)}$ is the inverse image of $\m_x$, which proves the result.
\end{proof}
\begin{lemma}\label{locally ringed global section zero set prop}
Let $X$ be a locally ringed space and $f\in\Gamma(X,\mathscr{O}_X)$. Then the set
\[D(f)=\{x\in X\mid f_x\notin\m_x\}\]
is open and $f|_{D(f)}$ has an inverse. We denote the complement of $D(f)$ by $V(f)$.
\end{lemma}
\begin{proof}
Suppose that $U\sub X$ and $V\sub X$ are two open subsets such that $f|_U$ has an inverse $g$ and $f|_V$ has an inverse $h$. Then clearly $g|_{U\cap V}=h|_{U\cap V}$. Thus it suffices to show that $f$ is invertible in an open neighbourhood of any $x\in D(f)$. This is clear because $f\notin\m_x$ implies that $f\in\mathscr{O}_{X,x}$ has an inverse $g\in\mathscr{O}_{X,x}$ which means there is some open neighbourhood $x\in U\sub X$ so that $g\in\mathscr{O}_{X}(U)$ and $g\cdot f|_U=1$.
\end{proof}
\begin{proposition}\label{locally ringed morphism to affine bijection}
Let $X$ be a locally ringed space and $Y$ an affine scheme. Then the map
\[\Mor(X,Y)\to\Hom_{\mathsf{Ring}}(\Gamma(Y,\mathscr{O}_Y),\Gamma(X,\mathscr{O}_X))\]
which maps $(f,f^{\hash})$ to the global sections of $f^{\hash}$ is bijective.
\end{proposition}
\begin{proof}
Since $Y$ is affine we have $(Y,\mathscr{O}_Y)\cong(\Spec(A),\mathscr{O}_{\Spec(A)})$ for some ring $A$. During the proof we will use facts about $Y$ and its structure sheaf which are direct consequences of things we know about the spectrum of a ring.\par
Motivated by Proposition~\ref{scheme map to affine point image char}, we construct the inverse map as follows. Let
\[\psi:\Gamma(Y,\mathscr{O}_Y)\to\Gamma(X,\mathscr{O}_X)\]
be a ring homomorphism. First, we define a corresponding map of spaces $\varPsi:X\to Y$ by the rule of Proposition~\ref{scheme map to affine point image char}: that is, given $x\in X$, we define $\varPsi(x)$ to be the point of $Y$ corresponding to the prime in $\Gamma(Y,\mathscr{O}_Y)$ which is the inverse image of $\m_x$ under the composition
\[\begin{tikzcd}
\Gamma(Y,\mathscr{O}_Y)\ar[r,"\psi"]&\Gamma(X,\mathscr{O}_X)\ar[r]&\mathscr{O}_{X,x}
\end{tikzcd}\]
We claim that $\varPsi:X\to Y$ is continuous. For this, since $Y$ is affine, it suffices to show that $\varPsi^{-1}(D(g))$ is open for any $g\in\Gamma(Y,\mathscr{O}_Y)$. By the construction of $\varPsi$, this inverse image is given by (recall that $\varPsi(x)$ can also be viewed as a prime ideal of $\Gamma(Y,\mathscr{O}_Y)$):
\begin{align*}
\varPsi^{-1}(D(g))&=\{x\in X:\varPsi(x)\in D(g)\}=\{x\in X:g\notin\varPsi(x)\}\\
&=\{x\in X:\psi(g)_x\notin\m_{x}\}=D(\psi(g)).
\end{align*}
The set $D(\psi(g))$ is open by Lemma~\ref{locally ringed global section zero set prop}, so $\varPsi$ is indeed continuous.\par
We still need to construct a morphism $\varPsi^{\hash}:\mathscr{O}_Y\to\varPsi_*\mathscr{O}_X$. To do this, we specify the map $\varPsi^{\hash}_{D(g)}$ in the following diagram
\[\Gamma(Y,\mathscr{O}_Y)_g=\Gamma(D(g),\mathscr{O}_Y)\stackrel{\varPsi^{\hash}_{D(g)}}{\longrightarrow}\Gamma(D(g),\varPsi_*\mathscr{O}_X)=\Gamma(D(\psi(g)),\mathscr{O}_X).\]
Now note that by Lemma~\ref{locally ringed global section zero set prop}, the restriction of $\psi(g)$ on $D(\psi(g))$ has an inverse, so the map
\[\begin{tikzcd}
\Gamma(Y,\mathscr{O}_Y)\ar[r,"\psi"]&\Gamma(X,\mathscr{O}_X)\ar[r]&\Gamma(D(\psi(g)),\mathscr{O}_X)
\end{tikzcd}
\]
factors through $\Gamma(Y,\mathscr{O}_Y)_g$, by the universal property of localization. This process is compatible with localization since the restriction map on the affine schemes are defined in terms of the universal properties of localization, and is thus a morphism of locally ringed spaces. We then get the desired maps $\varPsi^{\hash}_{D(g)}$ on $D(g)$, which give rise to a morphism of sheaves.\par
Finally, we have to show that the constructions $(\varPsi,\varPsi^{\hash})\mapsto\psi$ and the construction $\psi\mapsto(\varPsi,\varPsi^{\hash})$ are inverse to each other. Clearly, we have $\psi\mapsto(\varPsi,\psi)\mapsto\psi$, since the map $\varPsi^{\hash}_{D(1)}$ is just $\psi$. So we are left to show that, given a ring homomorphism $\psi:\Gamma(Y,\mathscr{O}_Y)\to\Gamma(X,\mathscr{O}_X)$, there is at most one pair $(\varPsi,\psi)$ giving rise to it. The uniqueness of $\varPsi$ was shown in Proposition~\ref{scheme map to affine point image char}, and given the uniqueness of $\varPsi$, the uniqueness of the map $\varPsi^{\hash}$ is clear from the commutativity of the following diagram
\[\begin{tikzcd}
&\Gamma(Y,\mathscr{O}_Y)\ar[d]\ar[r,"\psi"]&\Gamma(Y,\varPsi_*\mathscr{O}_X)\ar[d]&\\
\Gamma(Y,\mathscr{O}_Y)_g\ar[r,equal]&\Gamma(D(g),\mathscr{O}_Y)\ar[r,"\varPsi^{\hash}_{D(g)}"]&\Gamma(D(g),\varPsi_*\mathscr{O}_X)\ar[r,equal]&\Gamma(D(\psi(g)),\mathscr{O}_X)
\end{tikzcd}\]
This completes the proof of the theorem.
\end{proof}
\end{proof}
\begin{exercise}
Describe $\Spec(\Z)$, and show that it is a final object for the category of schemes, i.e., each scheme $X$ admits a unique morphism to $\Spec(\Z)$.
\end{exercise}
\begin{proof}
The spectum of $\Z$ has a generic point $0$, and other points $\p$ are closed. Now given a scheme $X$, we have a ring homomorphism $\Z\to\Gamma(X,\mathscr{O}_X)$, which gives a morphism $X\to\Spec(\Z)$ by the previous exercise.
\end{proof}
\begin{exercise}
Describe the spectrum of the zero ring, and show that it is an initial object for the category of schemes. (According to our conventions, all ring homomorphisms must take $1$ to $1$. Since $0=1$ in the zero ring, we see that each ring $A$ admits a unique homomorphism to the zero ring, but that there is no homomorphism from the zero ring to $A$ unless $0=1$ in $A$.)
\end{exercise}
\begin{exercise}
Let $X$ be a scheme. For any $x\in X$, let $\mathscr{O}_{X,x}$ be the local ring at $x$, and $\m_x$ its maximal ideal. We define the \textbf{residue field} of $x$ on $X$ to be the field $\kappa(x)=\mathscr{O}_{X,x}/\m_x$. Now let $K$ be any field. Show that to give a morphism of $\Spec(K)$ to $X$ it is equivalent to give a point $x\in X$ and an inclusion map $\kappa(x)\to K$.
\end{exercise}
\begin{proof}
Since $\Spec(K)$ is a singleton, given a morphism $f:\Spec(K)\to X$, we get a point $x\in X$ and a morphism $\mathscr{O}_X\to f_*\mathscr{O}_{\Spec(K)}$. Taking stalks, only the map $f^{\hash}_x:\mathscr{O}_{X,x}\to K$ is nonzero. This gives an inclusion $\kappa(x)\to K$. Conversely, if we have a point $x\in X$ and an inclusion $\kappa(x)\to K$, we can define $f:\Spec(K)\to X$ by $f(\ast)=x$ and $f^{\hash}_U:\mathscr{O}_{X}(U)\to\mathscr{O}_{\Spec(K)}(f^{-1}(U))$ is given by (where $x\in U$ since otherwise $\mathscr{O}_{\Spec(K)}(f^{-1}(U))=0$)
\[\mathscr{O}_{X}(U)\to \mathscr{O}_{X,x}\to\kappa(x)\to K=\mathscr{O}_{\Spec(K)}(f^{-1}(U)).\]
This proves the claim.
\end{proof}
\begin{exercise}
Let $X$ be a scheme. For any point $x\in X$, we define the Zariski tangent space $T_xX$ to $X$ at $x$ to be the dual of the $\kappa(x)$-vector space $\m_x/\m_x^2$. Now assume that $X$ is a scheme over a field $k$, and let $k[t]/t^2$ be the ring of dual numbers over $k$. Show that to give a $k$-morphism of $\Spec(k[t]/t^2)$ to $X$ is equivalent to giving a point $x\in X$, \textbf{rational over} $k$ (i.e., such that $\kappa(x)=k$), and an element of $T_xX$.
\end{exercise}
\begin{proof}
Let $f:\Spec(k[t]/(t^2))\to X$ be a $k$-morphism. Let $x=\im f$, then we get $k$-linear homomorphism on rings
\[\mathscr{O}_{X,x}\to k[t]/(t^2)\to k\]
Since, as a vector space, $\mathscr{O}_{X,x}=k+\m_x$, a $k$-linear homomorphism $\mathscr{O}_{X,x}\to k[t]/(t^2)$ is determined by its effect on $\m_x$, where it defines a linear form $\alpha:\m_x\to (t)\cong k$. Since $t^2=0$, we must have $\alpha(\m_x^2)=0$, that is, $\alpha$ is a linear function on $\m_x/\m_x^2$. Conversely, any such functional $\alpha$, extended to be $0$ on $\m_x^2$, determines a homomorphism $\mathscr{O}_{X,x}\to k[t]/(t^2)$, taking $\m_x$ into $(t)$, that is, a local homomorphism. A linear function on the space $\m_x/\m_x^2$ is an element of the tangent space at $x$ to $X$. Thus we have verified the  result.
\end{proof}
\begin{exercise}
If $X$ is a topological space, and $Z$ an irreducible closed subset of $X$, a generic point for $Z$ is a point $\xi$ such that $Z=\widebar{\{\xi\}}$. If $X$ is a scheme, show that every (nonempty) irreducible closed subset has a unique generic point.
\end{exercise}
\begin{proof}
Let $X$ be a scheme, $Z\sub X$ closed and irreducible. If $U\sub Z$ is open and $\xi\in U$ such that $\widebar{\{\xi\}}=U$, then $\widebar{\{\xi\}}=Z$ in $X$ since $Z$ is irreducible. So we can assume that $X=\Spec(A)$ is affine and $Z=\Spec(A/\a)$ for some ideal $\a$ of $A$. Now we can further assume that $Z=X=\Spec(A)$ is irreducible. It follows that there can only be one minimal prime ideal belonging to the nilradical $\n(A)$, whose closure is then all of $X$. Uniqueness is clear from the uniqueness of the nilradical.
\end{proof}
\begin{exercise}
Describe $\Spec(\R[x])$. How does its topological space compare to the set $\R$? To $\C$?
\end{exercise}
\begin{proof}
The ring $\R[x]$ is a PID, so all irreducible elements correspond to prime ideals. Thus $\Spec(\R[x])$ has a point for every irreducible polynomial and the generic point corresponds to $(0)$. Closed points correspond to maximal ideals, which are of the form $(x-a)$, where $a\in\R$ as well as $(x+\zeta)(x+\bar{\zeta})$ for $\zeta\in\C$. The residue field at the real numbers is $\R$ and at the complex numbers is $\C$. The only non-trivial proper closed sets are finite sets.
\end{proof}
\begin{exercise}
Let $k=\F_p$ be the finite field with $p$ elements. Describe $\Spec(k[x])$. What are the residue fields of its points? How many points are there with a given residue field?
\end{exercise}
\begin{proof}
The set $\Spec(k[x])=\{(0)\}\cup\{(f)\}$, where $f$ is an irreducible monic polynomial and $(0)$ is the generic point. The residue field of a point corresponding to a polynomial of degree $d$ is $\F_{p^d}$. Given a residue field, the number of points can be determined by using the M\"obius Inversion formula.
\end{proof}
\begin{exercise}[\textbf{Glueing lemma}]
Generalize the glueing procedure described in the text as follows. Let $(X_i)_{i\in I}$ be a family of schemes (possible infinite). For each $i$ of $j$, suppose given an open subset $U_{ij}\sub X_i$, and let it have the induced scheme structure. Suppose also given for each $i$ of $j$ an isomorphism of schemes $\varphi_{ij}:U_{ij}\to U_{ji}$ such that
\begin{itemize}
\item[(1)] for each $i,j$, $\varphi_{ji}=\varphi_{ij}^{-1}$, and
\item[(2)] for each $i,j,k$, $\varphi_{ij}(U_{ij}\cap U_{ik})=U_{ji}\cap U_{jk}$ and $\varphi_{ik}=\varphi_{jk}\circ\varphi_{ij}$ on $U_{ij}\cap U_{ik}$.
\end{itemize}
Then show that there is a scheme $X$, together with morphisms $\psi_i:X_i\to X$ for each $i$, such that 
\begin{itemize}
\item[(1)] $\psi_i$ is an isomorphism of $X_i$ onto an open subscheme of $X$; 
\item[(2)] the $\psi_i(X_i)$ cover $X$;
\item[(3)] $\psi_i(U_{ij})=\psi_i(X_i)\cap\psi_j(X_j)$;
\item[(4)] $\psi_i=\psi_j\circ\varphi_{ij}$ on $U_{ij}$.
\end{itemize}
We say that $X$ is obtained by glueing the schemes $X_i$ along the isomorphisms $\varphi_{ij}$. An interesting special case is when the family $X_i$ is arbitrary, but the $U_{ij}$ and $\varphi_{ij}$ are all empty. Then the scheme $X$ is called the disjoint union of the $X_i$, and is denoted $\coprod X_i$.
\end{exercise}
\begin{exercise}
A topological space is quasi-compact if every open cover has a finite subcover.
\begin{itemize}
\item[(a)] Show that a topological space is noetherian if and only if every open subset is quasi-compact.
\item[(b)] If $X$ is an affine scheme, show that $sp(X)$ is quasi-compact, but not in general noetherian. We say a scheme $X$ is quasi-compact if $sp(X)$ is.
\item[(c)] If $A$ is a noetherian ring, show that $sp(\Spec(A))$ is a noetherian topological space.
\item[(d)] Give an example to show that $sp(\Spec(A))$ can be noetherian even when $A$ is not.
\end{itemize}
\end{exercise}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $S$ be a graded ring. Show that $\Proj(S)=\emp$ if and only if every element of $S_+$ is nilpotent.
\item[(b)] Let $\varphi:S\to T$ be a graded homomorphism of graded rings (preserving degrees). Let $U=\{\p\in\Proj(T):\p\nsupseteq\varphi(S_+)\}$. Show that $U$ is an open subset of $\Proj(T)$, and show that $\varphi$ determines a natural morphism $f:U\to\Proj(S)$.
\item[(c)] The morphism $f$ can be an isomorphism even when $\varphi$ is not. For example, suppose that $\varphi_d:S_d\to T_d$ is an isomorphism for all $d\geq d_0$, where $d_0$ is an integer. Then show that $U=\Proj(T)$ and the morphism $f:\Proj(T)\to\Proj(S)$ is an isomorphism.
\item[(d)] Let $V$ be a projective variety with homogeneous coordinate ring $S$. Show that $t(V)\cong \Proj(S)$.
\end{itemize}
\end{exercise}
\begin{proof}
We note that $\Proj(S)=\emp$ iff every prime ideal of $\p$ contains $S_+$, iff $S_+$ is contained in the nilradical. Now let $\varphi:S\to T$ be a graded homomorphism of graded rings. For a prime $\p\in U$, $\p\nsupseteq \varphi(S_+)$, so $\p^c\nsubseteq S_+$ hence is in $\Proj(S)$. Thus we get a map $f:U\to\Proj(S)$. Since $U^c=V(\varphi(S_+))$, we see $U$ is open in $\Proj(T)$.\par
If $\varphi_d$ is an isomomorphism for $d\geq d_0$, then $V(\varphi(S_+))=\emp$, whence $U=\Proj(T)$. Let $\p\in\Proj(S)$ and define $\q$ to be the radical of the homogeneous ideal generated by $\varphi(\p)$. (Note that the radical of homogeneous ideals are again homogeneous). First we show that $\varphi^{-1}(\q)=\p$. The inclusion $\p\sub\varphi^{-1}(\q)$ is clear, so suppose we have $x\in\varphi^{-1}(\q)$. Then $\varphi(x)^n\in\varphi(\p)$ for some $n$ so $\varphi(a^n)=\sum_ib_i\varphi(s_i)$ for some $b_i\in T$ and $s_i\in\p$. By the hypotheses on $\varphi_d$, there exist $m>0$ such that $\varphi(a^{nm})\in\varphi(\p)$, so $a\in\p$. This shows $\varphi^{-1}(\q)=\p$. To show that $\q$ is prime, suppose that $xy\in\q$ for some $x,y\in T$. Then using the same reasoning as before, we see that $\varphi(xy)^{nm}\in\varphi(\p)$. Using the isomorphism $\varphi_d$, this means that $xy\in\p$, hence $x\in\p$ or $y\in\p$. This shows $\q$ is prime.\par
Suppose that $\p,\q\in\Proj(T)$ have the same image under $f:\Proj(T)\to\Proj(S)$. Then $\varphi^{-1}(\p)=\varphi^{-1}(\q)$. Consider $t\in\p$: we have $t^{d}\in\p$ and since $\varphi_d$ is an isomorphism for $d\geq d_0$, it follows that there is a unique $s\in S$ with $\varphi(s)=t^{d_0}$. The element $s$ is in $\varphi^{-1}(\p)=\varphi^{-1}(\q)$, so $\varphi(s)=t^{d_0}\in\q$. Since $\q$ is prime, $t\in\q$ and $\p\sub\q$. Similarly $\q\sub\p$, so the equality follows.\par
Now we check this morphism is isomomorphism on principal opens. Note that $D_+(s)=D_+(s^d)$ so we can assume that the degree of $s$ is $\geq d_0$. With this assumption, $f^{-1}D_+(s)=D_+(t)\sub\Proj(T)$, where $t$ is the element of $T$ corresponding to $s$ under the isomorphism $\varphi_{\deg(s)}$ (since a homogeneous prime ideal $\q$ in $T$ gets sent to $D_+(s)$ iff $s$ is not in the preimage iff $t\notin\q$). So we have to show that the morphism $S_{(s)}\to T_{(t)}$ is an isomorphism. If $f/s^n$ gets sent to zero then $0=t^m\varphi(f)=\varphi(s^m)\varphi(f)$ for some $m$. Choose $m>0$ so we do not have to handle the case $\deg(f)=0$ separately, and so $s^mf\in\ker\varphi$. Taking a high enough power of $s^mf$ puts it in one of the $S_d$ for which $S_d\to T_d$ is an isomorphism and so $s^mf=0$ and therefore $f/s^n=0$ and our morphism is injective. Now suppose that $f/t^n\in T_{(t)}$. This is equal in $T_{(t)}$ to $t^{d_0}f/t^{n+d_0}$ and now $t^{d_0}f$ has degree high enough to have a preimage in $S$. So our morphism is surjective.
\end{proof}
\begin{exercise}
\mbox{}
\begin{itemize}
\item[(a)] Let $V$ be a variety over the algebraically closed field $k$. Show that a point $p\in t(V)$ is a closed point if and only if its residue field is $k$.
\item[(b)] If $f:X\to Y$ is a morphism of schemes over $k$, and if $p\in X$ is a point with residue field $k$, then $f(p)\in Y$ also has residue field $k$.
\item[(c)] Now show that if $V,W$ are any two varieties over $k$, then the natural map 
\[\Hom_{\mathsf{Var}}(V,W)\to\Hom_{\mathsf{Sch}/k}(t(V),t(W))\]
is bijective.
\end{itemize}
\end{exercise}
\begin{exercise}\label{Scheme X_f global section prop}
Let $X$ be a scheme, let $f\in\Gamma(X,\mathscr{O}_X)$, and define $X_f$ to be the subset of points $x\in X$ such that the stalk $f_x$ of $f$ at $x$ is not contained in the maximal ideal $\m_x$ of the local ring $\mathscr{O}_{X,x}$.
\begin{itemize}
\item[(a)] If $U=\Spec(B)$ is an open affine subscheme of $X$, and if $\bar{f}\in B$ is the restriction of $f$, show that $U\cap X_f=\Spec(B_f)$. Conclude that $X_f$ is an open subset of $X$.
\item[(b)] Assume that $X$ is quasi-compact. Let $A=\Gamma(X,\mathscr{O}_X)$, and let $a\in A$ be an element whose restriction to $X_f$ is $0$. Show that for some $n>0$ such that $f^na=0$.
\item[(c)] Now assume that $X$ has a finite cover by open affines $U_i$ such that each intersection $U_i\cap U_j$ is quasi-compact. (This hypothesis is satisfied, for example, if $sp(X)$ is noetherian.) Let $b\in\Gamma(X_f,\mathscr{O}_{X_f})$. Show that for some $n>0$, $f^nb$ is
the restriction of an element of $A$.
\item[(d)] With the hypothesis of (c), conclude that $\Gamma(X_f,\mathscr{O}_{X_f})=A_f$.
\end{itemize}
\end{exercise}
\begin{proof}
If $U=\Spec(B)$ is an affine open of $X$, then for any point $x\in U$, the stalk $f_x$ of $f$ at $x$ is equal to that of $\bar{f}$. This means $f_x\notin\m_x$ if and only if $\bar{f}_x\notin\m_x$. But the set $x\in U$ such that $\bar{f}_x\notin\m_x$ is just $U_f=\Spec(B_f)$, so we conclude that $X_f\cap U=U_f=\Spec(B_f)$.\par
Let $X$ be quasi-compact. Let $a\in A$ such that $a|_{X_f}=0$. Let $U_i=\Spec(A_i)$ be a affine cover of $X$, which can be taken to be finite since $X$ is quasi-compact. The restriction of $a$ to $U_i\cap X_f=\Spec((A_i)_f)$ is zero for each $i$ and so $f^{n_i}a=0$ in $A_i$ for some $n_i$. Choose an $n>n_i$ for all $i$, then $f^na=0$ in each $\Spec(A_i)$. Since $X=\bigcup\Spec(A_i)$ and since $\mathscr{O}_X$ is a sheaf, $f^na=0$ on $X$.\par
Assume the condition in (c) and let $b\in\Gamma(X_f,\mathscr{O}_{X_f})$. Then $(f^{n_i}b-a_i)|_{U_i\cap X_f}=0$ where $a_i\in A_i=\Gamma(U_i,\mathscr{O}_{U_i})$, and we can choose $n>n_i$ for all $i$ since $U_i$ are finite in number. That is,
\[(f^nb-a_i)|_{U_i\cap X_f}=0.\]
Then $a_i-a_j$ is zero on $U_{ij}\cap X_f$, so by part (b) there exist integers $n_{ij}>0$ such that $f^{n_{ij}}(a_i-a_j)=0$. Again we can choose $m>0$ such that $m>n_{ij}$, and then $f^m(a_i-a_j)=0$. Then we get $(f^{m+n}b-f^ma_i)|_{U_i\cap X_f}=0$ for each $i$, and the elements $f^ma_i$ coincides on overlaping, so they lift to $a\in A$. Thus $f^{m+n}b-a$ is zero on each $U_i\cap X_f$, so $f^{m+n}b$ is the restriction of $a$ on $X_f$. Now combining the assertions of (b) and (c), we conclude that the map $A_f\to\Gamma(X_f,\mathscr{O}_{X_f})$ is bijective.
\end{proof}
\begin{exercise}[\textbf{A Criterion for Affineness}]
\mbox{}
\begin{itemize}
\item[(a)] Let $f:X\to Y$ be a morphism of schemes, and suppose that $Y$ can be covered by open subsets $U_i$ such that for each $i$, the induced map $f^{-1}(U_i)\to U_i$ is an isomorphism. Then $f$ is an isomorphism.
\item[(b)] A scheme $X$ is affine if and only if there is a finite set of elements $f_1,\dots,f_r\in A=\Gamma(X,\mathscr{O}_X)$, such that the open subsets $X_{f_i}$ are affine, and $f_1,\dots,f_r$ generate the unit ideal in $A$.
\end{itemize}
\end{exercise}
\begin{proof}
For (a), since $f^{-1}(U_i)\to U_i$ is an isomorphism, we see $f^{\hash}$ is an isomorphism of sheaves, and $f$ is bijective. By the local nature of continuity, we see $f$ is also bicontinuous, hence $f$ is an isomorphism.\par
For (b), we see one direction is clear. Now given $f_1,\dots,f_r$ with the given condition. Then for any $x\in X$, we can not have $(f_i)_x\in\m_x$ for all $i$, since then $1_x\in\m_x$ which is a contradiction. This shows $X$ is covered by the affine opens $X_{f_i}=\Spec(A_{f_i})$. Since we have a ring map $A\to\Gamma(X,\mathscr{O}_X)$, we get a morphism of schemes $f:X\to\Spec(A)$. Let $U_i=\Spec(A_{f_i})$, then by the definition of $f$, we have
\[\Psi^{-1}(U_i)=\{x\in X:\Psi(x)\in U_i=D(f_i)\}=\{x\in X:f_i\notin\m_{f(x)}\}=\{x\in X:(f_i)_x\notin\m_x\}=X_{f_i}.\]
To see that $\Psi_i:f^{-1}(U_i)\to U_i$ is an isomorphism, we use the previous exercise: each $X_{f_i}$ is affine, so by part (a) Exercise~\ref{Scheme X_f global section prop}, the intersection $X_{f_i}\cap X_{f_j}$ is given by
\[X_{f_i}\cap X_{f_j}=\Spec(\Gamma(X_{f_i},\mathscr{O}_{X_{f_i}})_{f_j})\]
hence affine and quasi-compact. By part (d) Exercise~\ref{Scheme X_f global section prop}, we have $\Gamma(X_{f_i},\mathscr{O}_{f_i})=A_{f_i}$. Now the morphisms $\Psi$ and $\psi_i$ corresponds to $A\to\Gamma(X,\mathscr{O}_X)$ and $A_{f_i}\to\Gamma(X_{f_i},\mathscr{O}_{X_{f_i}})$ such that
\[\begin{tikzcd}
A\ar[d]\ar[r,"\id"]&\Gamma(X,\mathscr{O}_X)=A\ar[d]\\
A_{f_i}\ar[r,"\psi_i"]&\Gamma(X_{f_i},\mathscr{O}_{X_{f_i}})\cong A_{f_i}
\end{tikzcd}\]
By the proerty of localization, we conclude that the composition of $\psi_i$ with the isomorphism $\Gamma(X_{f_i},\mathscr{O}_{X_{f_i}})\cong A_{f_i}$ is the canonical identity map $A_{f_i}\to A_{f_i}$, so $\psi_i$ is an isomorphism. Since $X_{f_i}$ and $U_i$ are affine, this shows $\Psi_i$ is an isomorphism.
\end{proof}
\begin{exercise}
In this exercise, we compare some properties of a ring homomorphism to the induced morphism of the spectra of the rings.
\begin{itemize}
\item[(a)] Let $A$ be a ring, $X=\Spec(A)$, and $f\in A$. Show that $f$ is nilpotent if and only if $D(f)$ is empty.
\item[(b)] Let $\varphi:A\to B$ be a homomorphism of rings, and let $f:Y=\Spec(B)\to X=\Spec(A)$ be the induced morphism of affine schemes. Show that $\varphi$ is injective if and only if the map of sheaves $f^{\hash}:\mathscr{O}_X\to f_*\mathscr{O}_Y$ is injective. Show furthermore in that case $f$ is dominant, i.e., $f(Y)$ is dense in $X$.
\item[(c)] With the same notation, show that if $\varphi$ is surjective, then $f$ is a homeomorphism of $Y$ onto a closed subset of $X$, and $f^{\hash}:\mathscr{O}_X\to f_*\mathscr{O}_Y$ is surjective.
\item[(d)] Prove the converse to (c), namely, if $f:Y\to X$ is a homeomorphism onto a closed subset, and $f^{\hash}:\mathscr{O}_X\to f_*\mathscr{O}_Y$ is surjective, then $\varphi$ is surjective.  
\end{itemize}
\end{exercise}
\begin{proof}
Part (a) is clear. If $f^{\hash}$ is injective then $\varphi:A\to B$ is injective. Conversely, let $A\to B$ be injective. Let $\p\in\Spec(A)$ and consider $f^{\hash}_\p:A_\p\to(f_*\mathscr{O}_X)_\p$. Note that $(f_*\mathscr{O}_X)_\p=B_\p=B\otimes A_\p$. So now the injectivity of
the map on stalks $f^{\hash}_{\p}:A_\p\to B_\p$ follows from the injectivity of $A\to B$.\par 
If $\varphi$ is surjective, then $f$ is a homeomorphism on $\Spec(A/\a)$ where $\a=\ker\varphi$. If $f^{\hash}$ is surjective, then it is surjective on each stalk. So for an element $b\in B$, for each point $\p_i\in\Spec(A)$, there is an open neighborhood which we can take to be a principal open set $D(f_i)$ of $\Spec(A)$ such that the germ of $b$ is the image of some $a_i/f_i^{n_i}\in A_{f_i}$. That $f^{m_i}(a_i-f_i^{n_i}b)=0$ in $B$. Since all affine schemes are quasicompact, we can find a finite set of the $D(f_i)$ that cover $\Spec(A)$, so we can assume all the $n_i$ and $m_i$ are the same, say $n$. Since $D(f_i)$ is a cover, the $f_i$ generate $A$ and therefore so do the $f_i^{2n}$, so we can write $1=\sum_ig_if_i^{2n}$ for some $g_i\in A$. We now have $b=\sum g_if_i^{2n}b=\sum_ig_ia_if^n\in\im\varphi$. So $\varphi$ is surjective.
\end{proof}
\begin{exercise}
Let $A$ be a ring. Show that the following conditions are equivalent:
\begin{itemize}
\item[(\rmnum{1})] $\Spec(A)$ is disconnected;
\item[(\rmnum{2})] there exist nonzero elements $e_1,e_2\in A$ such that $e_1e_2=0$, $e_1^2=e_1$, $e_2^2=e_2$, $e_1+e_2=1$ (these elements are called orthogonal idempotents);
\item[(\rmnum{3})] $A$ is isomorphic to a direct product $A_1\times A_2$ of two nonzero rings.
\end{itemize}
\end{exercise}
\section{First properties of schemes}
\begin{exercise}
Show that a morphism $f:X\to Y$ is locally of finite type if and only if for every open affine subset $V=\Spec(B)$ of $Y$, $f^{-1}(V)$ can be covered by open affine subsets $U_i=\Spec(A_i)$, where each $A_i$ is a finitely generated $B$-algebra.
\end{exercise}
\begin{proof}
One direction is clear. Conversely, assume that $f$ is locally of finite type and $V_i=\Spec(B_i)$ is an affine open cover of $Y$ such that each $f^{-1}(V_i)$ can be covered by affine subsets $U_{ij}=\Spec(A_{ij})$ such that each map $B_i\to A_{ij}$ is of finite type. Let $V=\Spec(B)$ be an open affine subset of $Y$. Then each $V\cap V_i$ is open in $V_i=\Spec(B_i)$ and so is a union of principal open sets $\Spec((B_i)_{f_{ik}})$ of $V_i$ with $f_{ik}\in B_i$. Considering the morphism $B_i\to A_{ij}$; the preimage of $\Spec((B_i)_{f_{ik}})$ is $\Spec((A_{ij})_{f_{ik}})$, and the induced ring morphisms make each $(A_{ij})_{f_{ik}}$ a finitely generated $(B_i)_{f_{ik}}$-algebra.\par
So we can cover $\Spec(B)$ with open affines $\Spec(C_i)$ whose preimages are covered with open affines $\Spec(D_{ij})$ such that each $D_{ij}$ is a finitely generated $C_i$-algebra. Now given a point $\p\in\Spec(B)$, $\p$ is contained in some $\Spec(C_i)$. Since these are open, there is a principal open affine $\Spec(B_{g_\p})\sub\Spec(C_i)$ that contains $\p$. If $\iota:\Spec(C_i)\to\Spec(B)$ is the inclusion map, then
\[\Spec((C_i)_{g_\p})=\iota^{-1}(\Spec(B_{g_\p}))=\Spec(C_i)\cap\Spec(B_{g_\p})=\Spec(B_{g_\p}).\] 
The preimage of this sets is $\Spec((D_{ij})_{g_\p})$, and $(D_{ij})_{g_\p}$ is a finitely generated $B_{g_\p}$-algebra. $\Spec((D_{ij})_{g_\p})$ cover the preimage of $\Spec(B)$, and since $(D_{ij})_{g_\p}$ is a finitely generated $B_{g_\p}$-algebra, $(D_{ij})_{g_\p}$ is a finitely generated $B$-algebra (adding $g_\p$ to the generating set). Hence the preimage of $\Spec(B)$ can be covered by open affine $\Spec(A_i)$ such that each $A_i$ is a finitely generated $B$-algebra.
\end{proof}
\begin{exercise}
A morphism $f:X\to Y$ of schemes is quasi-compact if there is a cover of $Y$ by open affines $V_i$ such that $f^{-1}(V_i)$ is quasi-compact for each $i$. Show that $f$ is quasi-compact if and only if for every open affine subset $V\sub Y$, $f^{-1}(V)$ is quasi-compact.
\end{exercise}
\begin{proof}
Let $f$ be quasi-compact and $\{V_i\}_{i\in I}$ is an affine open cover satisfying the given condition. First, let $V\sub Y$ be any affine open. For any $y\in V$ we can find an index $i(y)\in I$ such that $y\in V_{i(y)}$. As principal opens form a basis for the topology on $V_{i(y)}$, we can find $W_y\sub V\cap V_{i(y)}$ which is principal open in $V_{i(y)}$. By the quasi-compactness of $V$, we can find finitely many points $y_1,\dots,y_n\in V$ such that $V=\bigcup_{j=1}^{n}W_{y_j}$. For each $j$, by hypothesis, we can write $f^{-1}(V_{i(y_j)})=\bigcup_kV_{jk}$ as a finite union of affine opens. Since $W_{y_j}\sub V_{i(y_j)}$ is a principal open we see that $f^{-1}(W_{y_j})\cap V_{jk}$ is a principal open of $V_{jk}$. Hence $f^{-1}(W_{y_j})\cap V_{jk}$ is affine and so $f^{-1}(W_{y_j})$ is a finite union of affines. This proves that the inverse image of any affine open is a finite union of affine opens.
\end{proof}
\begin{exercise}\label{scheme morphism finite type iff}
\mbox{}
\begin{itemize}
\item[(a)] Show that a morphism $f:X\to Y$ is of finite type if and only if it is locally of finite type and quasi-compact.
\item[(b)] Conclude from this that $f$ is of finite type if and only if for every open affine subset $V=\Spec(B)$ of $Y$, $f^{-1}(V)$ can be covered by a finite number of open affines $U_i=\Spec(A_i)$, where each $A_i$ is a finitely generated $B$-algebra.
\item[(c)] Show also if $f$ is of locally finite type, then for every open affine subset $V=\Spec(B)\sub Y$ and for every open affine subset $U=\Spec(A)\sub f^{-1}(V)$, $A$ is a finitely generated $B$-algebra.
\end{itemize}
\end{exercise}
\begin{proof}
By definition, a locally finite type and quasi-compact morphism is of finite type. Conversely, it is clear that finite type is locally finite type. To see it is quasi-compact, we note that if $f^{-1}(V_i)$ can be covered by finitely many $U_{ij}$ which are affine, then $f^{-1}(V_i)$ is quasi-compact, since affines are quasi-compact. This proves (a). Now (b) follows from (a) and the previous exercises.\par
Let $f$ be of locally finite type. Cover $f^{-1}(V)$ by affines $U_i=\Spec(A_i)$ such that each $A_i$ is a finitely generated $B$-algebra. We can cover each of the intersections $U_i\cap U$ with principal open sets in both $U$ and $U_i$. Let $\Spec(A_{f_i})=\Spec((A_i)_{g_i})$ be a cover of $U$ by these principal open sets (with $f_i\in A$, $g_i\in A_i$), which we can choose to be finite since $U$ is quasi-compact. Since each $A_i$ is a finitely generated $B$-algebra, $(A_i)_{g_i}=A_{f_i}$ is a finitely generated $B$ algebra, and therefore, since the $\Spec(A_{f_i})$ form a finite cover of $U$, the ring $A$ is a finitely generated $B$-algebra.
\end{proof}
\begin{exercise}
Show that a morphism $f:X\to Y$ is finite if and only if for erery open affine subset $V=\Spec(B)$ of $Y$, $f^{-1}(V)$ is affine, equal to $\Spec(A)$, where $A$ is a finite $B$-module.
\end{exercise}
\begin{proof}
One sider is clear. Let $V_i=\Spec(B_i)$ be an affine cover of $Y$ such that each preimage $U_i=f^{-1}(V_i)=\Spec(A_i)$ is affine, with each $A_i$ a finitely generated $B_i$-module. Cover each intersection $V\cap V_i$ by principal opens $V_{ij}=\Spec((B_i)_{f_{ij}})$, with $f_{ij}\in B_i$. Then the preimage of $V_{ij}$ is $\Spec((A_i)_{f_{ij}})$. Since $A_i$ is a finite $B_i$-moduel, each $(A_i)_{f_{ij}}$ is a finite $(B_i)_{f_{ij}}$-module.\par
Now we have a cover of $V=\Spec(B)$ by opens $\Spec(B_{g_i})$ that are principal in $V$ and each of the preimages is $\Spec(C_i)$, with each $C_i$ a finitely $B_{g_i}$-module. Since $\Spec(B)$ is quasi-compact, we can assume that $\Spec(B_{g_i})$ is finite in number, so $g_1,\dots,g_n$ generate the unit ideal. This mean their image in $\Gamma(U,\mathscr{O}_U)$, where $U=f^{-1}(V)$ also generate the unit ideal. Furthermore, the preimage of each $\Spec(B_{g_i})$ is in fact $U_{g_i}$, where we associated $g_i$ with its image in $\Gamma(U,\mathscr{O}_U)$. So by the affine criterion, $U$ is affine.\par
Now let $U=\Spec(A)$. Then the preimage of $\Spec(B_{g_i})$ is $\Spec(A_{g_i})$, and by hypothesis $A_{g_i}$ is a finite $B_{g_i}$-module. It then follows that $A$ is a finite $B$-module.
\end{proof}
\begin{exercise}
A morphism $f:X\to Y$ is quasi-finite if for every point $y\in Y$, $f^{-1}(y)$ is a finite set.
\begin{itemize}
\item[(a)] Show that a finite morphism is quasi-finite.
\item[(b)] Show that a finite morphism is closed, i.e., the image of any closed subset is closed.
\item[(c)] Show by example that a surjective, finite-type, quasi-finite morphism need not be finite.
\end{itemize}
\end{exercise}
\begin{proof}
If $f$ is finite and $y\in Y$, choose affine open $V=\Spec(B)$ in $Y$ such that $y\in V$, then $f^{-1}(y)\sub f^{-1}(V)$ and $f^{-1}(V)=\Spec(A)$, where $A$ is a finite $B$-algebra. Then $A$ is integral over $B$, thus the fiber $f^{-1}(y)$ is finite.\par
Let $f:X\to Y$ be a finite morphism between affine schemes. Then $f$ is closed. The general case follows since being closed is a local property.
\end{proof}
\begin{exercise}
Let $X$ be an integral scheme. Show that the local ring $\mathscr{O}_{X,\eta}$ of the generic point $\eta$ of $X$ is a field. It is called the \textbf{function field} of $X$, and is denoted by $K(X)$. Show also that if $U=\Spec(A)$ is any open affine subset of $X$, then $K(X)$ is isomorphic to the quotient field of $A$.
\end{exercise}
\begin{proof}
Let $s\in\mathscr{O}_{X,\eta}$. Then $s=(U,s_U)$ for an affine open $U=\Spec(A)$ with $\eta\in U$. Then $\eta$ is the generic point of $\Spec(A)$, which is $V(0)$ since $A$ is an integral domain. Then $\mathscr{O}_{X,\eta}\cong A_{(0)}$, which is a field.
\end{proof}
\begin{exercise}
A morphism $f:X\to Y$, with $Y$ irreducible, is generically finite if $f^{-1}(\eta)$ is a finite set, where $\eta$ is the generic point of $Y$. A morphism $f:X\to Y$ is dominant if $f(X)$ is dense in $Y$. Now let $f:X\to Y$ be a dominant, generically finite morphism of finite type of integral schemes. Show that there is an open dense subset $U\sub Y$ such that the induced morphism $f^{-1}(U)\to U$ is finite.
\end{exercise}
\begin{proof}
Let $f:X\to Y$ be a dominant, generically finite morphism of finite type of integral schemes. Let $\xi$ be the generic point of $X$ and $\eta$ that of $Y$. Then since $f(X)$ is dense in $Y$, we must have $f(\xi)=\eta$. Thus we have a map $K(Y)\to K(X)$. We first show that $K(X)$ is a finite extension of $K(Y)$. Choose $V=\Spec(B)$ contains $\eta$, and $U=\Spec(A)\sub f^{-1}(V)$ contains $\xi$. Then $A$ is a finitely generated $B$-algebra by Exercise~\ref{scheme morphism finite type iff}. Then $A$ and $B$ are integral domains, whose fraction fields are $K(X)$ and $K(Y)$. Now $A$ is finitely generated over $B$ and therefore so is $\kappa(B)\otimes_BA=B^{-1}A$. By Noether Normalization, there is an integer $n$ and an integral morphism $\kappa(B)[x_1,\dots,x_n]\to B^{-1}A$. Since $B^{-1}A$ is integral over $k(B)[x_1,\dots,x_n]$, the induced morphism of affine schemes is surjective. But $\Spec(B^{-1}A)=\Spec(\kappa(B)\otimes_BA)$ has the same underlying topological space as $f^{-1}(\eta)\cap U$, which is finite by assumption. So we see that $n=0$ and moreover, $B^{-1}A$ is integral over $\kappa(B)$. Since it is also of finite type, this implies that it is finite over $\kappa(B)$. By clearing the denominators from elements of $A$ we get that $\kappa(B^{-1}A)=\kappa(A)$ is finite over $\kappa(B)$.\par
Let $X=\Spec(A)$, and $Y=\Spec(B)$ and consider a set of generators $\{a_i\}$ for $A$ over $B$. Considered as an element of $K(A)$, each generator satisfies some polynomial in $K(B)$ since it is a finite field extension. Clearing denominators, we get a set of polynomials with coefficients in $B$. Let $b$ be the product of the leading coefficients in these polynomials. Replacing $B$ and $A$ with $B_b$ and $A_b$, all these leading coefficients become units, and so after multiplying by their inverses, we can assume that the polynomials are monic. That is, $A_b$ is finitely generated over $B_b$ and there is a set of generators that satisfy monic polynomials with coefficients in $B_b$. Hence, $A_b$ is integral over $B_b$ and therefore a finitely generated $B_b$-module (it is of finite type).
\end{proof}
\begin{exercise}
A scheme is \textbf{normal} if all of its local rings are integrally closed domains. Let $X$ be an integral scheme. For each open affine subset $U=\Spec(A)$ of $X$, let $\tilde{A}$ be the integral closure of $A$ in its quotient field, and let $\tilde{U}=\Spec(\tilde{A})$. Show that one can glue the schemes $\tilde{U}$ to obtain a normal integral scheme $\tilde{X}$, called the normalization of $X$. Show also that there is a morphism $\tilde{X}\to X$, having the following universal property: for every normal integral scheme $Z$, and for every dominant morphism $f:Z\to X$, $f$ factors uniquely through $\tilde{X}$. If $X$ is of finite type over a field $k$, then the morphism $\tilde{X}\to X$ is a finite morphism.
\end{exercise}
\begin{proof}
Let $U=\Spec(A)$ and $V=\Spec(B)$ be affine opens of $X$. Then we can write $U\cap V=\bigcup_iW_i$ where
\[W_i=\Spec(A_{f_i})=\Spec(B_{g_i}).\]
Then we conclude that $\tilde{W}_i=\Spec(\tilde{A}_{f_i})=\Spec(\tilde{B}_{g_i})$. Thus $\tilde{W}_i$ are principal opens in $\tilde{U}$ and $\tilde{V}$, and we can consider the sets
\[\tilde{Z}_W=\bigcup_i\Spec(\tilde{A}_{f_i})\sub\tilde{U},\quad\tilde{Z}_U=\bigcup_i\Spec(\tilde{B}_{g_i})\sub\tilde{V}.\]
Since the intersection of two principal opens is a principal open, we get isomomorphisms $\Spec(\tilde{A}_{f_i})\to\Spec(\tilde{B}_{g_i})$ which coincide on overlaps, whence a unique isomomorphism $\tilde{Z}_W\to\tilde{Z}_U$. This shows we can glue the $\tilde{U}$ to obtain a new scheme $\tilde{X}$. The second claim is proved in the similar way, using the universal property for the affine case.
\end{proof}
\begin{exercise}
Recall that in the category of varieties, the Zariski topology on the product of two varieties is not equal to the product topology. Now we see that in the category of schemes, the underlying point set of a product of schemes is not even the product set.
\begin{itemize}
\item[(a)] Let $k$ be a field, and let $\A^1=\Spec(k[x])$ be the affine line over $k$. Show that $\A^1\times_{\Spec(k)}\A^1\cong\A^2$, and show that the underlying point set of the product is not the product of the underlying point sets of the factors (even if $k$ is algebraically closed).
\item[(b)] Let $k$ be a field, let $s$ and $t$ be indeterminates over $k$. Then $\Spec(k(s))$, $\Spec(k(t))$, and $\Spec(k)$ are all one-point spaces. Describe the product scheme $\Spec(k(s))\times_{\Spec(k)}\Spec(k(t))$.
\end{itemize}
\end{exercise}
\begin{proof}
We have $k[x]\otimes_kk[y]=k[x,y]$, so the first claim is clear. Now to see $\Spec(k[x,y])$ is not the product of $\Spec(k[x])$ and $\Spec(k[y])$, we observe that the points of $\A^1$ consist of the maximal ideals $\m_a$ and the generic point $(0)$. The points of $\A^1\times\A^1$ thus contains
\[(\m_a,\m_b),\quad (\m_a,(0)),\quad ((0),\m_b),\quad (0).\]
Let $f(x,y)$ be a nonzero irreducible polynomial in $k[x,y]$ not belongs to $k[x]$ or $k[y]$. Then $(f)$ is a prime in $k[x,y]$ not in this product.\par
Now consider $k(s)\otimes_kk(t)$. This is a subring of $k(s,y)$, and is unequal to it since
\[\sum_i\frac{f_i(s)\tilde{f}_i(t)}{g_i(s)\tilde{g}_i(t)}=\frac{F(s,t)}{\prod_ig_i(s)\tilde{g}_i(t)}\]
and there are polynomials in $k[s,t]$ not of the form $\prod_ig_i(s)\tilde{g}_i(t)$. Each irreducible polynomial not in this form is prime in $k(s)\otimes_kk(t)$, hence generates a prime ideal.
\end{proof}
\begin{exercise}[\textbf{Fibres of a Morphism}]
\mbox{}
\begin{itemize}
\item[(a)] If $f:X\to Y$ is a morphism, and $y\in Y$ a point, show that $\text{sp}(X_y)$ is homeomorphic to $f^{-1}(y)$ with the induced topology.
\item[(b)] Let $X=\Spec(k[s,t]/(s-t^2))$, let $Y=\Spec(k[s])$, and let $f:X\to Y$ be the morphism defined by sending $s$ to $s$. If $y\in Y$ is the point $a\in k$ with $a\neq 0$, show that the fibre $X_y$ consists of two points, with residue field $k$. If $y\in Y$ corresponds to $0\in k$, show that the fibre $X_y$ is a nonreduced one-point scheme. If $\eta$ is the generic point of $Y$, show that $X_\eta$ is a one-point scheme, whose residue field is an extension of degree two of the residue field of $\eta$. (Assume $k$ algebraically closed.) 
\end{itemize}
\end{exercise}
\begin{proof}
We first note that, if $X=\Spec(A)$ and $Y=\Spec(B)$ are affine, then
\[X_y=\Spec(A\otimes\kappa(y))\]
is homeomorphic to the fiber $f^{-1}(y)$. Now let $V=\Spec(A)$ be an affine in $Y$ containing $y$, then
\[X_y=X\times_Y\Spec(\kappa(y))=f^{-1}(V)\times_{V}\Spec(k(Y))=f^{-1}(V)\times_{\Spec(A)}\Spec(\kappa(y)).\]
Where the first equality follows since any morphism $Z\to\Spec(\kappa(y))\to Y$ has image $y$, so if it is equal to $Z\to X\to Y$ then $Z$ has image in $f^{-1}(y)\sub f^{-1}(V)$. The second equality follows since $V=\Spec(A)$ is open in $Y$ and $f^{-1}(V)$, $\Spec(\kappa(y))$ has both image in $V$. If we write $f^{-1}(V)=\bigcup_iU_i=\bigcup_i\Spec(B_i)$, then
\begin{align*}
f^{-1}(V)\times_{\Spec(A)}\Spec(k(y))&=\bigcup_i\Spec(B_i)\times_{\Spec(A)}\Spec(\kappa(y))\\
&=\bigcup_i\Spec(B_i\otimes_{A}\kappa(y))=\bigcup_i(f|_{U_i})^{-1}(y)=f^{-1}(y).
\end{align*}
Thus the first claim follows.\par
Let $f:\Spec(k[s,t]/(s-t^2))\to\Spec(k[s])$ be the projection. Then if $a\neq 0$, we have
\begin{align*}
X_a&=\Spec(k[s,t]/(s-t^2)\otimes_k\kappa(a))=\Spec(k[s,t]/(s-t^2)\otimes_k(k[s]/\m_a))\\
&=\Spec(k[t]/(a-t^2))
\end{align*}
Thus $X_a$ has two points, corresponds to $(0)$ and $(t)$. Now if $a=0$, then
\begin{align*}
X_0&=\Spec(k[s,t]/(s-t^2)\otimes_k\kappa(0))=\Spec(k[s,t]/(s-t^2)\otimes_k(k[s]/(s)))\\
&=\Spec(k[t]/(t^2)).
\end{align*}
Thus $X_0$ is a nonreduced scheme with one point, corresponds to $(t)$. If $\eta$ is the generic point of $Y$, then
\begin{align*}
X_\eta&=\Spec(k[s,t]/(s-t^2)\otimes_k\kappa(0))=\Spec(k[s,t]/(s-t^2)\otimes_kk(s))\\
&=\Spec(k(s)[\sqrt{s}])=\Spec(k(\sqrt{s})).
\end{align*}
Thus $X_\eta$ is a single point, with residue field $k(\sqrt{s})$, and the residue field of $\eta$ is $k(s)$.
\end{proof}
\begin{exercise}[\textbf{Closed Subschemes}]
\mbox{}
\begin{itemize}
\item[(a)] Closed immersions are stable under base extension: if $f:Y\to X$ is a closed immersion, and if $X'\to X$ is any morphism, then $f':Y\times X'\to X'$ is also a closed immersion.
\[\begin{tikzcd}
Y\times_XX'\ar[d]\ar[r,"f'"]&X'\ar[d]\\
Y\ar[r,"f"]&X
\end{tikzcd}\]
\item[(b)] If $Y$ is a closed subscheme of an affine scheme $X=\Spec(A)$, then $Y$ is also affine, and in fact $Y$ is the closed subscheme determined by a suitable ideal $\a\sub A$ as the image of the closed immersion $\Spec(A/\a)\to\Spec(A)$.
\item[(c)] Let $Y$ be a closed subset of a scheme $X$, and give $Y$ the reduced induced subscheme structure. If $Y'$ is any other closed subscheme of $X$ with the same underlying topological space, show that the closed immersion $Y\to X$ factors through $Y'$. We express this property by saying that the reduced induced structure is the smallest subscheme structure on a closed subset.
\item[(d)] Let $f:Z\to X$ be a morphism. Then there is a unique closed subscheme $Y$ of $X$ with the following property: the morphism $f$ factors through $Y$, and if $Y'$ is any other closed subscheme of $X$ through which $f$ factors, then $Y\to X$ factors through $Y'$ also. We call $Y$ the \textbf{scheme-theoretic image} of $f$. If $Z$ is a reduced scheme, then $Y$ is just the reduced induced structure on the closure of the image $f(Z)$. 
\end{itemize}
\end{exercise}
\begin{proof}
Let $Y$ be a closed subscheme of a affine scheme $X=\Spec(A)$. Then by definition $\text{sp}(Y)=V(\a)$ for some ideal $\a$ of $A$, whence $Y$ is quasi-compact (since $V(\a)=\Spec(A/\a)$ is quasi-compact). Now $Y$ can be covered by a finite number of open affine subsets of the form $D(f_i)\cap Y$, with $f_i\in A$. By adding some more $f_i$ ith $D(f_i)\cap Y=0$, if necessary, we may assume that the $D(f_i)$ cover $X$. Then $f_1,\dots,f_r$ generate the unit ideal of $A$, so their image in $\Gamma(\mathscr{O}_Y,Y)$ generates it. Moreover, each $Y_{f_i}=D(f_i)\cap Y$ is affine, so $Y$ is affine.\par
Now let $Y=V(\a)$ be a closed subset. Then we give the reduced scheme structure $\Spec(A/\sqrt{\a})$. If $Y'=V(\a')=Y=V(\a)$ then $\sqrt{a'}=\sqrt{\a}$, so the quotient map $A\to A/\sqrt{\a}$ factors through $A/\a'$:
\[A\to A/\a'\to A/\sqrt{\a}\]
which shows the map $Y'\to X$ factors through $Y$.\par
Let $f:Z\to X$ be a morphism and consider the reduced scheme structure on $\widebar{f(Z)}$. If $Y'$ is a subscheme of $X$ and $f$ factors through $Y'$, then $f(Z)\sub Y'$, hence we get a closed immersion $\widebar{f(Z)}\to Y'$ by (c).
\end{proof}
\begin{exercise}[\textbf{Properties of Morphisms of Finite Type}]
\mbox{}
\begin{itemize}
\item[(a)] A closed immersion is a morphism of finite type.
\item[(b)] A quasi-compact open immersion is of finite type.
\item[(c)] A composition of two morphisms of finite type is of finite type.
\item[(d)] Morphisms of finite type are stable under base extension.
\item[(e)] If $X$ and $Y$ are schemes of finite type over $S$, then $X\times_SY$ is of finite type over $S$.
\item[(f)] If $f:X\to Y$, $g:Y\to Z$ are two morphisms, and if $f$ is quasi-compact, and $g\circ f$ is of finite type, then $f$ is of finite type.
\item[(g)] If $f:X\to Y$ is a morphism of finite type, and if $Y$ is noetherian, then $X$ is noetherian.
\end{itemize}
\end{exercise}
\begin{proof}
Part (a) is true since a ring map $A\to A/\a$ is of finite type. Let $f:X\to Y$ be quasi-compact open. Then for $V=\Spec(B)\sub Y$ affine, we can cover $f^{-1}(V)$ by finitely many affines, so we reduces to the affine case. Let $Y=\Spec(B)$ be an quasi-compact open affine in a spectra $X=\Spec(A)$. Then there exist $g_1,\dots,g_r\in B$ such that $A\to B_{g_i}$ is of finite type and $g_1,\dots,g_r$ generates $B$. Then $B$ is of finite type over $A$, so the claim follows. Part (c) is clear.\par
If $f:X\to Y$, $g:Y\to Z$ are two morphisms, and if $f$ is quasi-compact, and $g\circ f$ is of finite type, then for any $W=\Spec(C)\sub Z$, let $g^{-1}(W)=\bigcup_iV_i$ where $V_i=\Spec(B_i)$. Then
\[f^{-1}g^{-1}(W)=\bigcup_if^{-1}(V_i)=\bigcup_jU_j\]
where $U_j=\Spec(A_j)$. Since $g\circ f$ is of finite type, $C\to A_j$ is of finite type, whence $B_i\to A_j$ is of finite type. Then take $V_i$ when $W$ varies, we get an open cover for $Y$, which shows $f$ is of finite type.\par
Let $f:X\to Y$ be finite type and $Y$ noetherian. Since $Y$ is noetherian, it is quasi-compact, so we can cover it with finitely many open affines $\Spec(B_i)$. Then each $f^{-1}(\Spec(B_i))$ can be covered by finitely many open affines $\Spec(A_{ij})$ each of which is quasi-compact and such that $f^{-1}(\Spec(B_i))$ cover $X$. So $X$ is a finite union of quasi-compact sets, so $X$ is quasi-compact. Also, each $A_{ij}$ is a finitely generated $B_i$-algebra. Since $Y$ is noetherian, $B_i$ is a noetherian ring, and so $A_{ij}$ is noetherian. Since homomorphic images of noetherian rings are again noetherian, we have covered $X$ by noetherian rings and have shown it to be quasi-compact. Thus $X$ is a noetherian scheme.
\end{proof}
\begin{exercise}
If $X$ is a scheme of finite type over a field $k$, show that the closed points of $X$ are dense.
\end{exercise}
\begin{proof}
This holds locally, since every affine $\Spec(A)$ in $X$, $A$ is a finitely generated $k$-algebra, hence Jacobson.
\end{proof}
\begin{exercise}
Let $X$ be a scheme of finite type over a field $k$ (not necessarily algebraically closed).
\begin{itemize}
\item[(a)] Show that the following three conditions are equivalent (in which case we say that $X$ is \textbf{geometrically irreducible}).
\begin{itemize}
\item[(\rmnum{1})] $X\times_k\bar{k}$ is irreducible, where $\bar{k}$ denotes the algebraic closure of $k$.
\item[(\rmnum{2})] $X\times_kk_s$ is irreducible, where $k_s$ denotes the separable closure of $k$.
\item[(\rmnum{3})] $X\times_kK$ is irreducible for every extension field $K$ of $k$.
\end{itemize} 
\item[(b)] Show that the following three conditions are equivalent (in which case we say $X$ is geometrically reduced).
\begin{itemize}
\item[(\rmnum{1})] $X\times_k\bar{k}$ is reduced.
\item[(\rmnum{2})] $X\times_kk_p$ is reduced where $k_p$ is the perfect closure of $k$.
\item[(\rmnum{3})] $X\times_kK$ is reduced for all extension fields $K$ of $k$.
\end{itemize} 
\item[(c)] We say that $X$ is geometrically integral if $X\times_k\bar{k}$ is integral. Give examples of integral schemes which are neither geometrically irreducible nor geometrically reduced.
\end{itemize}
\end{exercise}
\begin{proof}

\end{proof}
\begin{exercise}
Let $X$ be a noetherian topological space, and let $\mathcal{P}$ be a property of closed subsets of $X$. Assume that for any closed subset $Y$ of $X$, if $\mathcal{P}$ holds for every proper closed subset of $Y$, then $\mathcal{P}$ holds for $Y$. (In particular, $\mathcal{P}$ must hold for the empty set.) Then $\mathcal{P}$ holds for $X$.
\end{exercise}
\begin{proof}
Let $\mathscr{Z}$ be the set of closed subsets of $X$ that do not satisfy $\mathcal{P}$. Then since $X$ is noetherian, $\mathscr{Z}$ has a minimal element $Z$. Then every proper subset of $Z$ must satisfies $\mathcal{P}$, whence $Z$ satisfies $\mathcal{P}$, contradiction.
\end{proof}
\begin{exercise}
A topological space $X$ is a Zariski space if it is noetherian and every (nonempty) closed irreducible subset has a unique generic point.\par
For example, let $R$ be a discrete valuation ring, and let $T=\Spec(R)$. Then $T$ consists of two points $t_0=$ the maximal ideal, $t_1=$ the zero ideal. The open subsets are $\emp,\{t_i\}$, and $T$. This is an irreducible Zariski space with generic point $t_1$.
\begin{itemize}
\item[(a)] Show that if $X$ is a noetherian scheme, then $\text{sp}(X)$ is a Zariski space.
\item[(b)] Show that any minimal nonempty closed subset of a Zariski space consists of one point. We call these \textbf{closed points}.
\item[(c)] Show that a Zariski space $X$ satisfies the axiom $T_0$: given any two distinct points of $X$, there is an open set containing one but not the other.
\item[(d)] If $X$ is an irreducible Zariski space, then its generic point is contained in every nonempty open subset of $X$.
\item[(e)] If $x_0,x_1$ are points of a topological space $X$, and if $x_0\in\widebar{\{x_1\}}$, then we say that $x_1$ specializes to $x_0$, written $x_1\rightsquigarrow x_0$. We also say $x_0$ is a specialization of $x_1$, or $x_1$ is a generalization of $x_0$. Now let $X$ be a Zariski space. Show that the minimal points, for the partial ordering determined by $x_1\succeq x_0$ if $x_1\rightsquigarrow x_0$, are the closed points, and the maximal points are the generic points of the irreducible components of $X$. Show also that a closed subset contains every specialization of any of its points. (We say closed subsets are stable under specialization.) Similarly, open subsets are stable under generization. 
\item[(f)] Let $t$ be the functor on topological spaces. If $X$ is a noetherian topological space, show that $t(X)$ is a Zariski space. Furthermore $X$ itself is a Zariski space if and only if the map $t:X\to t(X)$ is a homeomorphism. 
\end{itemize}
\end{exercise}
\begin{proof}
We know a scheme is sober so if it is noetherian then it is Zariski. Let $X$ be a Zariski space and $Z$ a minimal nonempty closed subset. Then every point in $Z$ is a generic point of $Z$, whence $Z$ is a singleton.\par
Let $X$ be a Zariski space. Note that $x_0\in\widebar{\{x_1\}}$ iff for every neighborhood $U$ of $x_0$, $U$ contains $x_1$. Thus the pair $(x_0,x_1)$ do not satisfy the $T_0$ condition iff $x_0\in\widebar{\{x_1\}}$ and $x_1\in\widebar{\{x_0\}}$. Therefore it suffices to show that $x_1\rightsquigarrow x_0$ is a partial order on $X$, since then we have $x_0=x_1$. To this end, we note that if $x_0\in\widebar{\{x_1\}}$ and $x_1\in\widebar{\{x_2\}}$, then $x_0\in\widebar{\{x_1\}}\sub\widebar{\{x_2\}}$, whence $x_2\rightsquigarrow x_0$. This shows the transtivity. On the other hand, if $x_0\in\widebar{\{x_1\}}$ and $x_1\in\widebar{\{x_0\}}$, then $\widebar{\{x_0\}}=\widebar{\{x_1\}}$. Since genetic points are unique, we deduce that $x_0=x_1$.\par
Now we consider the partial order $x_0\rightsquigarrow x_1$. Since $x_0\preceq x_1$ iff $x_0\in\widebar{\{x_1\}}$. Thus $x_1$ is minimal iff $\widebar{\{x_1\}}$ is a singleton, iff $x_1$ is a closed point. Also, $x_0$ is maximal iff $\widebar{\{x_0\}}$ is maximal among closures of singletons. Since $X$ is Zariski, this is equivalent to $\widebar{\{x_0\}}$ being an irreducible component.\par
We observe that if $Z$ is closed, $x_0\in Z$ and $x_0\rightsquigarrow x_1$, then $x_1\in\widebar{\{x_0\}}\sub Z$, whence $Z$ is stable under specialization. Similarly, if $U$ is open, $x_1\in U$ and $x_0\rightsquigarrow x_1$, then $x_1\in\widebar{\{x_0\}}$. Since $U$ is a neighborhood of $x_1$, we see $U\cap\{x_0\}\neq\emp$, whence $x_0\in U$. Thus open sets are stable under generalizations.
\end{proof}
\begin{exercise}
Let $X$ be an integral scheme of finite type over a field $k$ (not necessarily algebraically closed).
\begin{itemize}
\item[(a)] For any closed point $p\in X$, $\dim(X)=\dim(\mathscr{O}_{X,p})$, where for rings, we always mean the Krull dimension.
\item[(b)] Let $K(X)$ be the function field of $X$. Then $\dim(X)=\tr.\deg(K(X)/k)$.
\item[(c)] If $Y$ is a closed subset of $X$, then $\codim(Y,X)=\inf_{p\in Y}\dim(\mathscr{O}_{X,p})$.
\item[(d)] If $Y$ is a closed subset of $X$, then $\dim(Y)+\codim(Y,X)=\dim(X)$.
\item[(e)] If $U$ is a nonempty open subset of $X$, then $\dim(U)=\dim(X)$.
\item[(f)] If $k\sub k'$ is a field extension, then every irreducible component of $X'=X\times_kk'$ has dimension $\dim(X)$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $X_0$ be the set of closed points in $X$. Let $v:X_0\to\N$ be defined by $v(p)=\dim(\mathscr{O}_{X,p})$. Then for each affine open $U=\Spec(A)$, since $A$ is a finitely generated $k$-algebra, we have $\dim(A_\m)=\dim(A)$ for all maximal ideal of $A$. Therefore the function $v$ is constant on $U\cap X_0$. Since affine opens form a basis for $X$ and $X$ is connected, we conclude that $v$ is constant on $X$. Finally, since $\dim(X)=\sup_U\dim(U)$ for opens $U$ of $X$, we conclude that $v(p)=\dim(X)$ for all $X$.\par
For (b), let $\eta$ be the generic point of $X$ and $\Spec(A)$ an affine scheme containing it. Then $\dim(X)=\dim(A)=\tr.\deg(\mathrm{Frac}(A)/k)=\tr.\deg(K(X)/k)$.\par
If $Y$ is a closed subset of $X$, then $\codim(Y,X)$ is defined to be $\inf_{Z\sub Y}\codim(Z,X)$, where $Z$ is irreducible closed. Thus to prove (c) we may assume $Y$ to be irreducible.
\end{proof}
\begin{exercise}
Let $X$ be a scheme, then $\dim(\mathscr{O}_{X,x})=\codim(\widebar{\{x\}})$ for any $x\in X$.
\end{exercise}
\begin{proof}
Let's first consider the affine case. Let $X=\Spec(A)$ be an affine scheme and $\p\in X$. Then $\widebar{\{\p\}}=V(\p)$ so
\[\codim(\widebar{\{x\}})=\codim(V(\p))=\height(\p)=\dim(A_\p).\]
Note that $\dim(\mathscr{O}_{X,x})=\dim(A_\p)$, so the claim follows in this case.\par
Now we see how to reduce the general case to affine case. Consider an affine open $U=\Spec(A)$ containing $x$, for each irreducible closed set $Z$ of $X$ containing $x$, we obtain an irreducible closed set of $U$ containing $x$ by $Z\mapsto Z\cap U$. For each irreducible closed set $C$ of $U$ containing $x$, we obtain an irreducible closed set of $X$ containing $x$ by $C\mapsto\widebar{C}$, with closure taken inside $X$. We show this establishes a bijection. Clearly $\widebar{C}\cap U=C$ if $C$ is closed in $U$, we have one sided inverse. For the other side, we need to show that $\widebar{Z\cap U}=Z$. Observe that $Z\setminus U$ and $\widebar{Z\cap U}$ are two closed sets of $X$ whose union is $Z$, and $\widebar{Z\cap U}$ contains $x$ which is non-empty, we are thus done by irreducibility of $Z$. (In fact this bijection works with same proof for any open set of $X$ containing $x$.)
\end{proof}
\section{Separated and proper morphisms}
\begin{exercise}
Show that a finite morphism is proper.
\end{exercise}
\begin{proof}
A finite morphism is separated since it is affine, and is finite type. Thus we can apply the valuation criterion. By the affineness of the morphism, we can even consider only affine schemes. Let $R$ be a valuation ring of a field $K$, and consider the following diagram:
\[\begin{tikzcd}
\Spec(K)\ar[r]\ar[d,"i"]&X=\Spec(A)\ar[d,"f"]\\
\Spec(R)\ar[r]\ar[ru,dashed]&Y=\Spec(B)
\end{tikzcd}\]
Sicne every schemes are affine, we can consider the homomorphisms of rings:
\[\begin{tikzcd}
K&A\ar[l]\ar[ld,dashed]\\
R\ar[u]&B\ar[l]\ar[u]
\end{tikzcd}\]
We may identify $A$ and $B$ with their images in $K$. Then since $f$ is finite, the ring $A$ is integral over $B$. Recall that the integral closure of $B$ is the intersection of valuation rings of $K$ containing $B$, so we conclude that $R$ contains the integral closure of $B$, whence contains $A$. Thus we get the unique morphism $A\to R$.
\end{proof}
\begin{exercise}
Let $S$ be a scheme, let $X$ be a reduced scheme over $S$, and let $Y$ be a separated scheme over $S$. Let $f$ and $g$ be two $S$-morphisms of $X$ to $Y$ which agree on an open dense subset of $X$. Show that $f=g$. Give examples to show that this result fails if either (a) $X$ is nonreduced, or (b) $Y$ is nonseparated.
\end{exercise}
\begin{proof}
Let $U$ be the open dense subset on which $f$ and $g$ agree. Consider the following pullback square, we we write $V=X\times_{X\times_SY}Y$:
\[\begin{tikzcd}
V\ar[r]\ar[d]&Y\ar[d,"\Delta_{Y/S}"]\\
X\ar[r,"(f\times_Sg)"]&Y\times_SY
\end{tikzcd}\]
Since $Y$ is separated, $\Delta_{Y/S}$ is a closed immersion, whence $V\to X$ is a closed immersion (since closed immersions are stable under base change). The image of $V$ is a closed subscheme containing $U$, so $V\to X$ is a closed immersion which has set-theoretic image all of $X$. But the only such closed immersion into a reduced scheme is an isomorphism.
\end{proof}
\begin{exercise}
Let $X$ be a separated scheme over an affine scheme $S$. Let $U$ and $V$ be open affine subsets of $X$. Then $U\cap V$ is also affine. Give an example to show that this fails if $X$ is not separated.
\end{exercise}
\begin{proof}
Let $\Delta_{X/S}$ be the diagonal map. The fiber product $U\times_SV$ is identified with an open subset of $X\times_SX$, which is affine since $U,V,S$ are all affine. Consider the diagram
\[\begin{tikzcd}
U\cap V\ar[r]\ar[d]&U\times_SV\ar[d]\\
X\ar[r,"\Delta_{X/S}"]&X\times_SX
\end{tikzcd}\]
Since $X$ is separated over $S$, $\Delta$ is a closed immersions. Closed immersions are stable under base extensions and so $U\cap V\to U\times_SV$ is a closed immersion. Since $U\times_SV$ is affine, we conclude that $U\cap V$ is affine.\par
For an example when $X$ is not separated, consider the affine plane with two origins and the two copies $U,V$ of the usual affine plane inside it as open affines. Then $U\cap V$ is $\A^2\setminus\{0\}$, which is not affine.
\end{proof}
\begin{exercise}
Let $f:X\to Y$ be a morphism of separated schemes of finite type over a noetherian scheme $S$. Let $Z$ be a closed subscheme of $X$ which is proper over $S$. Show that $f(Z)$ is closed in $Y$, and that $f(Z)$ with its image subscheme structure is proper over $S$. We refer to this result by saying that "the image of a proper scheme is proper."
\end{exercise}
\begin{proof}
Since $Z\to S$ is proper and $Y\to S$ is separated, $Z\to Y$ is proper. Proper morphisms are closed by definition and so $f(Z)$ is closed in $Y$.\par
Since $f(Z)$ is a closed subscheme of a scheme $Y$ of finite type over $S$, we see $f(Z)$ is of finite type over $S$. Also, it follows from the change of base square and the fact that closed immersions are preserved under base extensions that $f(Z)$ is separated:
\[\begin{tikzcd}
f(Z)\ar[r]\ar[d,"\Delta_{f(Z)/S}"]&Y\ar[d,"\Delta_{Y/S}"]\\
f(Z)\times_Sf(Z)\ar[r]&Y
\end{tikzcd}\]
Let $S'\to S$ be some other morphism and consider the following diagram:
\[\begin{tikzcd}
S'\times_SZ\ar[d,"f'"]\ar[r]&Z\ar[d,"f"]\\
S'\times_Sf(Z)\ar[r]\ar[d,"s'"]&f(Z)\ar[d,"s"]\\
S'\ar[r]&S
\end{tikzcd}\]
Since $f$ is surjective, we see $f'$ is surjective: in fact, let $x\in S'\times_Sf(Z)$ be a point with residue field $\kappa(x)$. Following it horizontally we obtain a point $y\in f(Z)$ with residue field $\kappa(y)\sub\kappa(x)$ and this lifts to a point $z\in Z$ with residue field $\kappa(y)\sub\kappa(z)$. Let $k$ be a field containing both $\kappa(x)$ and $\kappa(z)$. The inclusions $\kappa(x),\kappa(z)\sub k$ give morphisms $\Spec(k)\to S'\times_Sf(Z)$ and $\Spec(k)\to Z$ which agree on $f(Z)$ and therefore lift to a morphism $\Spec(k)\to S'\times_SZ$ (note that the up rectangle is cartesian), giving a point in the preimage of $x$. Therefore $f'$ is surjective.\par
With this observation, suppose that $W\sub S'\times_Sf(Z)$ is a closed subset. Its vertical preimage $V=(f')^{-1}(W)$ is a closed subset of $S'\times_SZ$ and since $Z\to S$ is universally closed, the image $(s'\circ f')(V)$ in $S'$ is closed. As $f'$ is surjective, this image is $s'(W)$ and $s'(W)$ is therefore closed in $S'$. This shows $f(Z)\to S$ is universally closed. Thus $f(Z)\to S$ is proper.
\end{proof}
\begin{exercise}
Let $X$ be an integral scheme of finite type over a field $k$, having function field $K$. We say that a valuation of $K/k$ has \textbf{center} $x$ on $X$ if its valuation ring $R$ dominates the local ring $\mathscr{O}_{X,x}$.
\begin{itemize}
\item[(a)] If $X$ is separated over $k$, then the center of any valuation of $K/k$ on $X$ (if it exists) is unique.
\item[(b)] If $X$ is proper over $k$, then every valuation of $K/k$ has a unique center on $X$.
\item[(c)] Prove the converses of(a) and (b).
\item[(d)] If $X$ is proper over $k$, and if $k$ is algebraically closed, show that $\Gamma(X,\mathscr{O}_X)=k$.
\end{itemize}
\end{exercise}
\begin{proof}
Note that any local ring $\mathscr{O}_{X,x}$ is contained in $K$. In fact, let $x\in X$ and $U=\Spec(A)$ an affine open of $X$ containing $x$. Then $U$ contains the unique generic point $\eta$ of $X$, which corresponds to the zero ideal $(0)$ in $A$ since $A$ is an integral domain. Then $\mathscr{O}_{X,x}=A_\p$ where $x$ corresponds to the point $\p$ in $\Spec(A)$, and $K=A_{(0)}$; therefore $\mathscr{O}_{X,x}\sub K$.\par
Now assume $X$ is separated over $k$. Then for a valuation ring $R$ to be the center of $x$, it is necessary and sufficient that we have a diagram
\[\begin{tikzcd}
\Spec(K)\ar[r]&X\ar[d]\\
\Spec(R)\ar[u]\ar[ru]\ar[r]&\Spec(k)
\end{tikzcd}\]
where the map $\Spec(R)\to X$ is induced by the points $\eta$ and $x$ (since $R$ dominates $\mathscr{O}_{X,x}$). Then we see (a) and (b) follows from the valuative criterion.\par
To prove the converses of (a) and (b), we'll show that the conditions about centers of valuations on $K/k$ give the appropriate conditions for the valuative criteria for separatedness and properness. We start by explaining how to connect the left side of the diagram in the valuative criteria to valuations of $K/k$. Let $R$ be a valuation ring with field of fractions $L$ and suppose we have the standard commutative diagram:
\[\begin{tikzcd}
\Spec(L)\ar[r]\ar[d]&X\ar[d]\\
\Spec(R)\ar[r]&\Spec(k)
\end{tikzcd}\]
Let $x_0$ denote the unique point in the image of $\Spec(L)\to X$, and let $Z$ be the closure of $\{x_0\}$ equipped with the reduced induced subscheme structure. Then $Z$ is an integral subscheme of $X$ with generic point $x_0$ and function field $K(Z)=\kappa(x_0)$. The map $\Spec(L)\to X$ gives us an inclusion $\kappa(x_0)\sub L$, and we let $S=\kappa(x_0)\cap R$. It is straightforward to check that $S$ is a valuation ring for $\kappa(x_0)$: for any element $a\in\kappa(x_0)$, we have that considering $a$ as an element of $L$, we have that either $a\in R$ or $a^{-1}\in R$, so either $a\in S$ or $a^{-1}\in S$. So our diagram can be rewritten as follows:
\[\begin{tikzcd}
\Spec(L)\ar[r]\ar[d]&\Spec(\kappa(x_0))\ar[d]\ar[r]&X\ar[d]\\
\Spec(R)\ar[r]&\Spec(S)\ar[r]&\Spec(k)
\end{tikzcd}\]
and therefore it's enough to check the valuative criteria on valuation rings $R$ with fields of fractions $L$ the residue field of a point $x_0$ in $X$.\par
In the case where $x_0$ is the generic point of $X$, this gives the answer immediately: $R$ is a valuation ring of $K$, so by assumption it has at most one (respectively, a unique) center $x\in X$, which means that there exists at most one (respectively, a unique) lifting $\Spec(R)\to X$ making the relevant diagram commute. To show the result in general, we will prove that if $X$ is an integral scheme of finite type over a field so that every valuation on $K/k$ has at most one (respectively, a unique) center on X, then the same is true for every integral closed subscheme $Z\sub X$. We can reduce this further to proving that if $X$ satisfies the condition on valuations, then every closed integral subscheme $Z\sub X$ of codimension one does as well by downward induction. See https://math.stackexchange.com/q/3905228.\par
Now assume $X\to k$ is proper and $k$ is algebraically closed. Let $a\in\Gamma(X,\mathscr{O}_X)$ and assume that $a\notin k$. Then $a$ must be transcendental over $k$, so the ring $k[a^{-1}]$ is a polynomial ring. Consider the ring $k[a^{-1}]_{(a^{-1})}$, it is a local ring over $k$ and contained in $K$, so there must be a valuation ring $R$ of $K/k$ dominating it. In particular, we see $a^{-1}\in\m_R$. Let $v:K\to G$ be the valuation of $R$. By the valuative criteria, we have a unique lifting:
\[\begin{tikzcd}
\Spec(K)\ar[r]&X\ar[d]\\
\Spec(R)\ar[u]\ar[ru]\ar[r]&\Spec(k)
\end{tikzcd}\]
taking global sections, we get
\[\begin{tikzcd}
K&\Gamma(X,\mathscr{O}_X)\ar[l]\ar[ld]\\
R\ar[u]&k\ar[l]\ar[u]
\end{tikzcd}\]
This shows $a\in R$, which is a contradiction since $a^{-1}\in\m_R$.
\end{proof}
\begin{exercise}
Let $f:X\to Y$ be a proper morphism of affine varieties. Then $f$ is a finite morphism.
\end{exercise}
\begin{proof}
Since $f$ is proper, it satisfies the valuative criterion:
\[\begin{tikzcd}
\Spec(K)\ar[r]\ar[d]&X=\Spec(B)\ar[d]\\
\Spec(R)\ar[r]\ar[ru,dashed]&Y=\Spec(A)
\end{tikzcd}\]
This gives homomorphisms of rings:
\[\begin{tikzcd}
K&B\ar[l]\ar[ld,dashed]\\
R\ar[u]&A\ar[l]\ar[u]
\end{tikzcd}\]
We can set $K=\mathrm{Frac}(B)$ and $R$ be any valuation ring containing $A$. Then we see $B$ is contained in $R$, whence $B$ is integral over $A$. But since $B$ is of finite type over $A$, we conclude that $B$ is finite over $A$.
\end{proof}
\begin{exercise}[\textbf{Schemes Over $\R$}]
For any scheme $X_0$ over $\R$, let $X=X_0\times_\R\C$. Let $\alpha:\C\to\C$ be the complex conjugation, and let $\sigma:X\to X$ be the automorphism obtained by keeping $X_0$ fixed and applying $\alpha$ to $\C$. Then $X$ is a scheme over $\C$, and $\sigma$ is a semi-linear automorphism, in the sense that we have a commutative diagram
\[\begin{tikzcd}
X\ar[d]\ar[r,"\sigma"]&X\ar[d]\\
\Spec(\C)\ar[r,"\alpha"]&\Spec(\C)
\end{tikzcd}\]
Since $\sigma^2=\id$, we call $\sigma$ an involution.
\begin{itemize}
\item[(a)] Now let $X$ be a separated scheme of finite type over $\C$, let $\sigma$ be a semilinear involution on $X$, and assume that for any two points $x_1,x_2\in X$, there is an open affine subset containing both of them. (This last condition is satisfied for example if $X$ is quasi-projective.) Show that there is a unique separated scheme $X_0$ of finite type over $\R$ such that $X_0\times_\R\C=X$, and such that this isomorphism identifies the given involution of $X$ with the one on $X_0\times_\R\C$ described above.
\end{itemize}
For the following statements, $X_0$ will denote a separated scheme of finite type over $\R$, and $X$ will denote the corresponding scheme with involution over $\C$.
\begin{itemize}
\item[(b)] Show that $X_0$ is affine if and only if $X$ is.
\item[(c)] If $X_0,Y_0$ are two such schemes over $\R$, then to give a morphism $f_0:X_0\to Y_0$ is equivalent to giving a morphism $f:X\to Y$ which commutes with the involutions, i.e., $f\circ\sigma_X=\sigma_Y\circ f$.
\item[(d)] If $X\cong\A_\C^1$, then $X_0\cong\A_\R^1$.
\item[(e)] If $X\cong\P_\C^1$, then either $X_0\cong\P_\R^1$ or $X_0$ is isomorphic to the conic in $\P_\R^2$ given by the homogeneous equation $x_0^2+x_1^2+x_2^2=0$.
\end{itemize}
\end{exercise}
\begin{proof}

\end{proof}
\begin{exercise}
Let $\mathcal{P}$ be a property of morphisms of schemes such that:
\begin{itemize}
\item[(a)] a closed immersion has $\mathcal{P}$;
\item[(b)] a composition of two morphisms having $\mathcal{P}$ has $\mathcal{P}$;
\item[(c)] $\mathcal{P}$ is stable under base extension.
\end{itemize}
Then show that:
\begin{itemize}
\item[(d)] a product of morphisms having $\mathcal{P}$ has $\mathcal{P}$;
\item[(e)] if $f:X\to Y$ and $g:Y\to Z$ are two morphisms, and if $g\circ f$ has $\mathcal{P}$ and $g$ is separated, then $f$ has $\mathcal{P}$;
\item[(f)] If $f:X\to Y$ has $\mathcal{P}$, then $f_{\red}:X_{\red}\to Y_{\red}$ has $\mathcal{P}$.
\end{itemize}
\end{exercise}
\begin{proof}
Let $f:X\to Z$ and $g:Y\to Z$ be two morphisms having $\mathcal{P}$. Then consider the product $f\times g:X\times_ZY\to Z$ which is given by
\[\begin{tikzcd}
X'\ar[r,"f'"]&Y'&\\
X'\times X=X'\times_{Y'}X\times Y'\ar[r]\ar[u]&X\times Y'=X\times_YY\times Y'\ar[r]\ar[u]\ar[d]&Y\times Y'\ar[d]\\
&X\ar[r,"f"]&Y
\end{tikzcd}\]
Thus by (b) and (c), we see (d) follows.\par
Now if $f:X\to Y$ and $g:Y\to Z$ are two morphisms, and if $g\circ f$ has $\mathcal{P}$ and $g$ is separated, consider the following diagram:
\[\begin{tikzcd}
Y\times_{Y\times_ZY}(X\times_ZY)=X\times_{Y\times_ZY}(Y\times_ZY)=X\ar[d]\ar[r,"\Gamma_f"]&X\times_Y(Y\times_ZY)=X\times_ZY\ar[r]\ar[d,"f'"]&X\ar[d,"f"]\\
Y\ar[r,"\Delta_{Y/Z}"]&Y\times_ZY\ar[d,"g'"]\ar[r]&Y\ar[d,"g"]\\
&Y\ar[r,swap,"g"]&Z
\end{tikzcd}\]
Since $g\circ f$ has $\mathcal{P}$ and $\Delta_{Y/Z}$ has $\mathcal{P}$ (it is a closed immersion), by (c) we see $\Gamma_f$ and $g'\circ f'$ has $\mathcal{P}$, whence (e) follows.\par
For (f), recall that $X_{\red}\to X$ is a closed immersion. Consider the diagram
\[\begin{tikzcd}
X_{\red}\ar[rrd,bend left=20pt]\ar[rdd,bend right=20pt]\ar[rd,dashed]&&\\
&X\times_YY_{\red}\ar[d]\ar[r]&X\ar[d]\\
&Y_{\red}\ar[r]&Y
\end{tikzcd}\]
We see $X_{\red}\to X$ has $\mathcal{P}$, thus $X_{\red}\to Y_{\red}\to Y$ has $\mathcal{P}$. Since $Y_{\red}\to Y$ is separated, by (e) we see $X_{\red}\to Y_{\red}$ has $\mathcal{P}$.
\end{proof}
\begin{exercise}
Show that a composition of projective morphisms is projective.
\end{exercise}
\begin{proof}
Note that the Segre embedding is a closed immersion $\P^r\times\P^s\to\P^{rs+r+s}$. Let $f:X\to Y$ and $g:Y\to Z$ be two projective morphisms. This gives rise to a commutative diagram:
\[\begin{tikzcd}
X\ar[r,"f'"]\ar[rd,swap,"f"]&\P^r\times Y=(\P^r\times\P^s\times Z)\times_{\P^r\times Z}Y\ar[d]\ar[r,"1\times g'"]&\P^r\times\P^s\times Z\ar[d]\ar[r]&\P^{rs+r+s}\times Z\ar[ldd]\\
&Y\ar[r,"g'"]\ar[rd,swap,"g"]&\P^s\times Z\ar[d]&\\
&&Z&
\end{tikzcd}\]
where $f'$ and $g'$, and therefore $1\times g'$ are closed immersions. Now using the Segre embedding, the projection $\P^r\times\P^s\times Z\to\P^s\times Z$ factors as
\[\P^r\times\P^s\times Z\to \P^{rs+r+s}\times Z\to Z.\]
So since the Segre embedding is a closed immersion, we are done since we have a closed immersion $X\to \P^{rs+r+s}\times Z$ which factors $g\circ f$.
\end{proof}
\section{Sheaves of Modules}
\begin{exercise}
Let $(X,\mathscr{O}_X)$ be a ringed space, and let $\mathscr{E}$ be a locally free $\mathscr{O}_X$-module of finite rank. We define the dual of $\mathscr{E}$, denoted $\mathscr{E}^*$, to be the sheaf $\sHom(\mathscr{F},\mathscr{O}_X)$.
\begin{itemize}
\item[(a)] Show that $\mathscr{E}^{**}=\mathscr{E}$.
\item[(b)] For any $\mathscr{O}_X$-module $\mathscr{F}$, $\sHom_{\mathscr{O}_X}(\mathscr{E},\mathscr{F})\cong\mathscr{E}^*\otimes_{\mathscr{O}_X}\mathscr{F}$.
\item[(c)] For any $\mathscr{O}_X$-modules $\mathscr{F},\mathscr{G}$, $\Hom_{\mathscr{O}_X}(\mathscr{E}\otimes\mathscr{F},\mathscr{G})\cong\Hom(\mathscr{F},\sHom_{\mathscr{O}_X}(\mathscr{E},\mathscr{G}))$.
\item[(d)] If $f:(X,\mathscr{O}_X)\to (Y,\mathscr{O}_Y)$ is a morphism of ringed spaces, if $\mathscr{F}$ is an $\mathscr{O}_X$-module, and if $\mathscr{E}$ is a locally free $\mathscr{O}_Y$-module of finite rank, then there is a natural isomorphism $f_*(\mathscr{F}\otimes_{\mathscr{O}_X}f^*\mathscr{E})\cong f_*(\mathscr{F})\otimes_{\mathscr{O}_Y}\mathscr{E}$. 
\end{itemize}
\end{exercise}
\begin{proof}
We can cover $X$ with open sets $U_\alpha$ with $\mathscr{E}|_{U_\alpha}$ free of rank $n_\alpha$. First consider $X=U_\alpha$. An element of $\sHom_{\mathscr{O}_X}(\mathscr{O}_X^n,\mathscr{O}_X)$ is determined by where it takes the standard basis elements in $\mathscr{O}_X^n(X)$, and similarly
for any subset $U$ of $X$. So $\sHom_{\mathscr{O}_X}(\mathscr{O}_X^n,\mathscr{O}_X^n)\cong\mathscr{O}_X^n$. Taking the dual is equivalent to applying $\Hom$ again, which is again isomorphic to $\mathscr{O}_X^n$. But the isomorphism with the double dual is canonical, so we can patch these isomorphisms on each $U_\alpha$ together to get an isomorphism $\mathscr{E}^{**}\cong\mathscr{E}$.\par
For (b), define a map on any open set $U$ where $\mathscr{E}$ is free:
\[\phi_U:\Hom_{\mathscr{O}_X}(\mathscr{E}|_U,\mathscr{O}_X|_U)\otimes_{\mathscr{O}_X(U)}\mathscr{F}(U)\to\Hom_{\mathscr{O}_X}(\mathscr{E}|_U,\mathscr{F}|_U)\]
by taking $e_i^*\otimes a_i$ to the map sending $e_i^*$ to $a_i$ from $\mathscr{E}(U)$ to $\mathscr{F}(U)$. This determines the whole morphism. It is injective and surjective, so thus an isomorphism. Now glue all the maps and take the sheafification to get the desired isomorphism. Then part (c) can be done similarly.\par
If $\mathscr{E}$ is free of finite rank, write $\mathscr{E}=\mathscr{O}_Y^n$. Then
\begin{align*}
f_*(\mathscr{F}\otimes_{\mathscr{O}_X}f^*\mathscr{E})&=f_*(\mathscr{F}\otimes_{\mathscr{O}_X}f^*\mathscr{O}_Y^n)=f_*(\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{O}_X^n)\\
&=f_*(\mathscr{F}^{\otimes n})=f_*(\mathscr{F})\otimes_{\mathscr{O}_Y}\mathscr{O}_Y^n=f_*(\mathscr{F})\otimes_{\mathscr{O}_Y}\mathscr{E}.
\end{align*}
If $\mathscr{E}$ is locally free, then do the same argument as above on an open cover $\{U_\alpha\}$ and glue on intersections.
\end{proof}
\begin{exercise}
Let $R$ be a discrete valuation ring with quotient field $K$, and let $X=\Spec(R)$.
\begin{itemize}
\item[(a)] To give an $\mathscr{O}_X$-module is equivalent to giving an $R$-module $M$, a $K$-vector space $L$, and a homomorphism $\rho:M\otimes_RK\to L$.
\item[(b)] That $\mathscr{O}_X$-module is quasi-coherent if and only if $\rho$ is an isomorphism.
\end{itemize}
\end{exercise}
\begin{proof}
Let $X=\Spec(R)=\{x_0,x_1\}$, where $x_0=(0)$, $x_1=\m_R=(t)$ (where $t$ is a uniformizor). Then the open sets are $X=\{x_0,x_1\}$ and $U=\{x_0\}$. Thus given an $\mathscr{O}_X$-module $\mathscr{F}$ is equivalent to given an $R$-module $M=\mathscr{F}(X)$ and a $K$-vector space $L=\mathscr{F}(U)$, with a homomorphism $M\to L$ compactible with the ring map $R\to K$. In other words, we have a homomorphism $M\otimes_RK\to L$.\par
Since $x_1$ has a unique neighborhood $X$, the sheaf $\mathscr{F}$ is quasi-coherent iff $\mathscr{F}\cong\widetilde{M}$ for some $R$-module $M$. In this case, the vector space $L$ is given by $M\otimes_RR_{t}=M\otimes_RK$.
\end{proof}
\begin{exercise}
Let $f:X\to Y$ be a morphism of schemes.
\begin{itemize}
\item[(a)] Show by example that if $\mathscr{F}$ is coherent on $X$, then $f_*\mathscr{F}$ need not be coherent on $Y$, even if $X$ and $Y$ are varieties over a field $k$.
\item[(b)] Show that a closed immersion is a finite morphism.
\item[(c)] If $f$ is a finite morphism of Noetherian schemes, and if $\mathscr{F}$ is coherent on $X$, then $f_*\mathscr{F}$ is coherent on $Y$.
\end{itemize}
\end{exercise}
\begin{proof}
Consider the projection $f:\A_k^2\to\A_k^1$. Then $f_*\mathscr{O}_{\A_k^2}$ is $\widetilde{k[x,y]}$, which is not coherent over $\widetilde{k[x]}$.\par
Let $f:X\to Y$ be a closed immersion. Let $X=\bigcup_iU_i$ be an affne open cover of $Y$, where $V_i=\Spec(A_i)$. Then $f:f^{-1}(V_i)\to V_i$ is a closed immersion, so these are of the form $\Spec(A_i/\a_i)\to\Spec(A_i)$ for some ideal $\a_i$. Since $A_i/\a_i$ is a finite $A_i$-module, $f$ is finite.\par
Let $f:X\to Y$ be a finite morphism of Noetherian schemes and let $\mathscr{F}$ be coherent on $X$. Pick an affine open cover for $Y=\bigcup_iV_i$ where $V_i=\Spec(A_i)$. It is enough to show this locally by restricting $f$ to one of these covers. We get a map $f:\Spec(B)\to\Spec(A)$, where $B$ is a finite $A$-module and $\mathscr{F}=\widetilde{M}$ for some $A$-module $M$. Then $f_*\mathscr{F}=\widetilde{M\otimes_AB}$ is just the extension of scalars. Since both $B$ and $M$ are finite $A$-modules, so is their tensor product. Thus $f_*(\mathscr{F})$ is coherent.
\end{proof}
\begin{exercise}
Let $X$ be a noetherian scheme, and let $\mathscr{F}$ be a coherent sheaf.
\begin{itemize}
\item[(a)] If the stalk $\mathscr{F}_x$ is a free $\mathscr{O}_X$-module for some point $x\in X$, then there is a neighborhood $U$ of $x$ such that $\mathscr{F}|_U$ is free.
\item[(b)] $\mathscr{F}$ is locally free if and only if its stalks $\mathscr{F}_x$ are free $\mathscr{O}_X$-modules for all $x\in X$.
\item[(c)] $\mathscr{F}$ is invertible (i.e., locally free of rank $1$) if and only if there is a coherent sheaf $\mathscr{G}$ such that $\mathscr{F}\otimes\mathscr{G}\cong\mathscr{O}_X$.
\end{itemize}
\end{exercise}
\begin{proof}
For (a), since the question is local, let $X=\Spec(A)$ where $A$ is Noetherian, and $\mathscr{F}=\widetilde{M}$ where $M$ is a finitely generated $A$-module. Then the hypotheses is that $M_\p$ is free of rank $n$ for some $\p\in X$. Then there exists $x_1,\dots,x_n$ such that $x_i/1$ form a basis for $M_\p$. Consider the homomorphism $\phi:A^n\to M$ such that $\phi(e_i)=x_i$, $(e_i)$ being the canonical basis of $A^n$. As $\phi_\p$ is bijective by hypothesis, there exists $f\in A-\p$ such that $\phi_f$ is bijective. Since $\p\in D(f)$, this shows $\mathscr{F}|_{D(f)}$ is free of rank $n$. 
\end{proof}
\begin{exercise}
Again let $X$ be a Noetherian scheme, and $\mathscr{F}$ a coherent sheaf on $X$. We will consider the function
\[\phi(x)=\dim_{\kappa(x)}\mathscr{F}_x\otimes_{\mathscr{O}_{X,x}}\kappa(x).\]
where $\kappa(x)$ is the residue field at the point x. Use Nakayama's lemma to prove the following results.
\begin{itemize}
\item[(a)] The function $\phi$ is upper semi-continuous, i.e., for any $n\in\Z$, the set $\{x:\phi(x)\geq n\}$ is closed.
\item[(b)] If $\mathscr{F}$ is locally free, and $X$ is connected, then $\phi$ is a constant function.
\item[(c)] Conversely, if $X$ is reduced, and $\phi$ is constant, then $\mathscr{F}$ is locally free.
\end{itemize}
\end{exercise}
\begin{proof}
To show that the set $\{x:\phi(x)\geq n\}$ is closed, we will show that its compliment $\{x:\phi(x)<n\}$ is open. Since these are all local properties, we can assume that $X=\Spec(A)$ is affine, $\mathscr{F}=\widetilde{M}$ for some finite $A$-module $M$, generated by $x_1,\dots,x_r$. Let $\p$ be the prime ideal corresponding to $x\in X$. Let $\n\in\Z$. Then $\phi(x)=[M_\p/\p M_\p:\kappa(\p)]$. By Nakayama's Lemma, this number is equal to the minimal number of generators of $N_\p$ as an $A_\p$ module. Let $M_\p$ be minimally generated by $m_1,\dots,m_r$, with $r<n$. Then by Proposition~\ref{}, there is a surjective map $(A^r)_f\to M_f$ for some $f\in A-\p$. This shows $M$ is generated by $r$ elements on $D(f)\ni\p$, so $\phi(y)\leq r<n$ for all $y\in D(f)$. Therefore $\{x:\phi(x)<n\}$ is open.\par
If $\mathscr{F}$ is locally free then $\phi$ is locally constant, so if $X$ is connected, we have $\phi$ is constant. Conversely, assume that $X$ is reduced and $\phi$ is constant. Let $X=\Spec(A)$ and $\mathscr{F}=\widetilde{M}$. We show that $M_\p$ is free for every $\p$. For this, let $x_1,\dots,x_r$ be elements of $M_\p$ whose image form a basis for $M_\p/\p M_\p$. Then by Nakayama's lemma, this set generates $M$. It suffices to show that they are linearly independent. For this, write $x_i=m_i/f$ for $f\in A-\p$ and let $a_i/b_i$ be elements in $A_\p$ such that
\[\sum_ia_i/b_i\cdot x_i=\sum_i(a_i/b_i)\cdot(m_i/f)=0.\]
Then by clearing denominators, there exist $g\in A-\p$ such that
\[\sum_iga_im_i=0.\]
This shows $\sum_ia_im_i=0$ in $A_g$. Now by Proposition~\ref{}, we can choose $e\in A$ such that $D(e)\sub D(g)$ and for every $\q\in D(e)$, the module $M_\q$ is generated by the image of $m_i$. From our choice of $e$, if $\q\in D(e)$, then the images of the $m_i$ in $M_\q/\q M_\q$ are generators. Since $\phi$ is locally constant, their images are in fact basis. In particular, they are linearly independent. Then since $\sum_ia_im_i=0$ holds in $M_\q$, we conclude that $a_i=0$ in every $\q\in D(e)$, and thus $a_i$ is in the intersection of all prime ideals not containing $e$. This is just the nilradical of $A_e$, which is $0$ by assumption. Thus $a_i=0$ in $A_e$, and hence zero in $A_\p$. Then $\mathscr{F}_x$ is a free $\mathscr{O}_X$-module for all $x\in X$ and thus $\mathscr{F}$ is locally free.
\end{proof}
\begin{exercise}[\textbf{Affine Morphisms}]
A morphism $f:X\to Y$ of schemes is affine if there is an open affine cover $\{V_i\}$ of $Y$ such that $f^{-1}(V_i)$ is affine for each $i$.
\begin{itemize}
\item[(a)] Show that $f:X\to Y$ is an affine morphism if and only if for every open affine $V\sub Y$, $f^{-1}(V)$ is affine.
\item[(b)] An affine morphism is quasi-compact and separated. Any finite morphism is affine.
\item[(c)] Let $Y$ be a scheme, and let $\mathscr{A}$ be a quasi-coherent sheaf of $\mathscr{O}_Y$-algebras (i.e., a sheaf of rings which is at the same time a quasi-coherent sheaf of $\mathscr{O}_X$-modules). Show that there is a unique scheme $X$, and a morphism $f:X\to Y$, such that for every open affine $V\sub Y$, $f^{-1}(V)\cong\Spec(\mathscr{A}(V))$, and for every inclusion $U\rightarrow V$ of open affines of $Y$, the morphism $f^{-1}(U)\rightarrow f^{-1}(V)$ corresponds to the restriction homomorphism $\mathscr{A}(V)\to\mathscr{A}(U)$. The scheme $X$ is called $\Spec(\mathscr{A})$.
\item[(d)] If $\mathscr{A}$ is a quasi-coherent $\mathscr{O}_Y$-algebra, then $f:\Spec(\mathscr{A})\to Y$ is an affine morphism, and $\mathscr{A}=f_*\mathscr{O}_X$. Conversely, if $f:X\to Y$ is an affine morphism, then $\mathscr{A}=f_*\mathscr{O}_X$ is a quasi-coherent sheaf of $\mathscr{O}_Y$-algebras, and $X\cong\Spec(\mathscr{A})$.
\item[(e)] Let $f:X\to Y$ be an affine morphism, and let $\mathscr{A}=f_*\mathscr{O}_X$. Show that $f_*$ induces an equivalence of categories from the category of quasi-coherent $\mathscr{O}_X$-modules to the category of quasi-coherent $\mathscr{A}$-modules (i.e., quasi-coherent (l)y-modules
having a structure of d-module).
\end{itemize}
\end{exercise}
\begin{exercise}[\textbf{Vector bundles}]
Let $Y$ be a scheme. A (geometric) vector bundle of rank $n$ over $Y$ is a scheme $X$ and a morphism $f:X\to Y$, together with additional data consisting of an open covering $\{U_i\}$ of $Y$, and isomorphisms $\psi_i:f^{-1}(U_i)\to\A_{U_i}^n$ such that for any $i,j$, and for any open affine subset $V=\Spec(A)\sub U_i\cap U_i$, the automorphism $\psi=\psi_i\circ\psi_j^{-1}$ of $\A^n_V=\Spec(A[x_1,\dots,x_n])$ is given by a linear automorphism $\theta$ of $A[x_1,\dots,x_n]$, i.e., $\theta(a)=a$ for any $a\in A$, and $\theta(x_i)=\sum a_{ij}x_j$ for suitable $a_{ij}\in A$.\par
An isomorphism $g:(X,f,\{U_i\},\{\psi_i\})\to(X',f',\{U_i'\},\{\psi'_i\})$ of one vector bundle of rank $n$ to another one is an isomorphism $g:X\to X'$ of the underlying schemes, such that $f=f'\circ g$, and such that $X,f$, together with the covering of $Y$ consisting of all the $U_i$ and $\psi_i$, and the isomorphisms $\psi_i$ and $\psi'_i\circ g$, is also a vector bundle structure on $X$.
\begin{itemize}
\item[(a)] Let $\mathscr{E}$ be a locally free sheaf of rank $n$ on a scheme $Y$. Let $S(\mathscr{E})$ be the symmetric algebra on $\mathscr{E}$, and let $X=\Spec(S(\mathscr{E}))$, with projection morphism $f:X\to Y$. For each open affine subset $U\sub Y$ for which $\mathscr{E}|_U$ is free, choose a basis of $\mathscr{E}$, and let $\psi:f^{-1}(U)\to\A_U^n$ be the isomorphism resulting from the identification of $S(\mathscr{E}(U))$ with $\mathscr{O}_U[x_1,\dots,x_n]$. Then $(X,f,\{U\},\{\psi\})$ is a vector bundle of rank $n$ over $Y$, which (up to isomorphism) does not depend on the bases of $\mathscr{E}|_U$ chosen. We call it the geometric vector bundle associated to $\mathscr{E}$, and denote it by $V(\mathscr{E})$.
\item[(b)] For any morphism $f:X\to Y$, a \textbf{section} of $f$ over an open set $U\sub Y$ is a morphism $s:U\to X$ such that $f\circ s=\id_U$. It is clear how to restrict sections to smaller open sets, or how to glue them together, so we see that the presheaf $U\mapsto\{\text{sections of $f$ over $U$}\}$ is a sheaf of sets on $Y$, which we denote by $\mathscr{S}(X/Y)$. Show that if $f:X\to Y$ is a vector bundle of rank $n$, then the sheaf of sections $\mathscr{S}(X/Y)$ has a natural structure of $\mathscr{O}_Y$-module, which makes it a locally free $\mathscr{O}_Y$-module of rank $n$.
\item[(c)] Again let $\mathscr{E}$ be a locally free sheaf of rank $n$ on $Y$, let $X=V(\mathscr{E})$, and let $\mathscr{S}=\mathscr{S}(X/Y)$ be the sheaf of sections of $X$ over $Y$. Show that $\mathscr{S}\cong\mathscr{E}^*$, as follows: Given a sections $s\in\Gamma(V,\mathscr{E}^*)$ over any open set $V$, we think of $s$ as an element of $\Hom(\mathscr{E}|_V,\mathscr{O}_V)$. So $s$ determines an $\mathscr{O}_V$-algebra homomorphism $S(\mathscr{E}|_V)\to\mathscr{O}_V$. This determines a morphism of spectra $V=\Spec(\mathscr{O}_V)\to\Spec(S(\mathscr{E}|_V))=f^{-1}(V)$, which is a section of $X/Y$. Show that this construction gives an isomorphism
of $\mathscr{E}^*$ to $\mathscr{S}$.
\item[(d)] Summing up, show that we have established a one-to-one correspondence between isomorphism classes of locally free sheaves of rank $n$ on $Y$, and isomorphism classes of vector bundles of rank $n$ over $Y$. Because of this, we sometimes use the words "locally free sheaf" and "vector bundle" interchangeably, if no confusion seems likely to result.
\end{itemize}
\end{exercise}
\section{Divisors}
\begin{exercise}
Let $X$ be a scheme satisfying (*). Then $X\times\P^n$ also satisfies (*),and $Cl(X\times\P^n)=(Cl X)\times\Z$.
\end{exercise}
\begin{proof}
We have a projection $X\times\P^n\to X\times\A^n$, where $Cl(X\times\A^n)=Cl(X)$. Also we have a projection $X\times\P^n\to\{*\}\times\P^n$, where $Cl(\P^n)=\Z$. Let $Y=X\times\{*\}$, then $X\setminus Y=X\times\A^n$, and
\[\begin{tikzcd}
\Z\ar[r]&Cl(X\times\P^n)\ar[r]&Cl(X\times\A^n)\ar[r]&0
\end{tikzcd}\]
The first map send $n$ to $nY$. 
\end{proof}
\begin{exercise}[\textbf{Varieties in Projective Space}]
Let $k$ be an algebraically closed field, and let $X$ be a closed subvariety of $\P^n_k$ which is nonsingular in codimension one (hence satisfies (*)). For any divisor $D=\sum n_iY_i$ on $X$, we define the degree of $D$ to be $\sum n_i\deg(Y_i)$, where $\deg(Y_i)$ is the degree of $Y_i$, considered as a projective variety itself.
\begin{itemize}
\item[(a)] Let $V$ be an irreducible hypersurface in $\P^n$ which does not contain $X$, and let $Y_i$ be the irreducible components of $V\cap X$. They all have codimension $1$ in $X$. For each $i$, let $f_i$ be a local equation for $V$ on some open set $U_i$ of $\P^n$ for which $Y_i\cap U_i\neq\emp$, and let $n_i=v(\bar{f}_i)$, where $\bar{f}_i$ is the restriction of $f_i$ to $U_i\cap X$. Then we define the divisor $V\cdot X$ to be $\sum n_iY_i$. Extend by linearity, and show that this gives a well-defined homomorphism from the subgroup of $\Div\P^n$ consisting of divisors, none of whose components contain $X$, to $\Div X$.
\item[(b)] If $D$ is a principal divisor on $\P^n$, for which $D\cdot X$ is defined as in (a), show that $D\cdot X$ is principal on $X$. Thus we get a homomorphism $\Cl\P^n\to\Cl X$.
\item[(c)] Show that the integer $n_i$ defined in (a) is the same as the intersection multiplicity $i(X,V;Y_i)$. Then use the generalized Bezout theorem to show that for any divisor $D$ on $\P^n$, none of whose components contain $X$,
\[\deg(D\cdot X)=\deg(D)\cdot\deg(X).\] 
\item[(d)] If $D$ is a principal divisor on $X$, show that there is a rational function $f$ on $\P^n$ such that $D=(f)\cdot X$. Conclude that $\deg(D)=0$. Thus the degree function defines a homomorphism $\deg:\Cl X\to\Z$. Finally, there is a commutative diagram
\[\begin{tikzcd}
\Cl\P^n\ar[r]\ar[d,"\deg"]&\Cl X\ar[d,"\deg"]\\
\Z\ar[r,"\cdot\deg(X)"]&\Z
\end{tikzcd}\]
\end{itemize}
\end{exercise}
\begin{exercise}

\end{exercise}
\begin{exercise}
Let $k$ be a field of characteristic $\neq 2$. Let $f\in k[x_1,\dots,x_n]$ be a squarefree nonconstant polynomial, i.e., in the unique factorization off into irreducible polynomials, there are no repeated factors. Let $A=k[x_1,\dots,x_n,z]/(z^2-f)$. Show that $A$ is an integrally closed ring.
\end{exercise}

\end{document}